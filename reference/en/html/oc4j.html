<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;26.&nbsp;Seam on OC4J</title><link rel="stylesheet" href="../shared/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Seam - Contextual Components"><link rel="up" href="index.html" title="Seam - Contextual Components"><link rel="previous" href="configuration.html" title="Chapter&nbsp;25.&nbsp;Configuring Seam and packaging Seam applications"><link rel="next" href="annotations.html" title="Chapter&nbsp;27.&nbsp;Seam annotations"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;26.&nbsp;Seam on OC4J</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="configuration.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="annotations.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="oc4j"></a>Chapter&nbsp;26.&nbsp;Seam on OC4J</h2></div></div><div></div></div><p>
      OC4J (Oracle Containers for Java) 11g (currently a "Technology Preview" 
      release) is Oracle's JEE 5 application server. We will will start by 
      looking at the building and deploying the Hotel Booking example 
      application which comes with Seam, and then at deploying a project 
      generated by seam-gen. This project will integrate Seam, RichFaces Ajax 
      and components, Seam Security (with Drools), Facelets and JPA provided 
      by Hibernate.
    </p><p>
      This section requires you to use OC4J 11g Technology Preview (not OC4J 
      10g). You can download OC4J 11g from 
      <a href="http://www.oracle.com/technology/tech/java/oc4j/11/" target="_top">http://www.oracle.com/technology/tech/java/oc4j/11/</a>.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e14142"></a>26.1.&nbsp;The <tt class="literal">jee5/booking</tt> example</h2></div></div><div></div></div><p>
        The <tt class="literal">jee5/booking</tt> example is based on the Hotel 
        Booking example (which runs on JBoss AS). Out of the box it is designed 
        to run on Glassfish, but it's easy to build it for OC4J.
      </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e14153"></a>26.1.1.&nbsp;Booking Example Dependencies</h3></div></div><div></div></div><p>
          First, lets look at the dependencies of the booking example. Armed 
          with this knowledge we can look at the extra dependencies requirements 
          that OC4J adds.
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <tt class="literal">jboss-seam.jar</tt> &#8212; We declare this as an 
              EJB3 module (why? well Seam needs to be able to interact with 
              container managed transactions; this is implemented as an EJB3 
              Stateful Session Bean)
            </p></li><li><p>
              <tt class="literal">jboss-el.jar</tt>
            </p></li><li><p>
              <tt class="literal">jboss-seam-ui.jar</tt> &#8212; Seam's JSF controls 
              depend on Apache's commons-beanutils
            </p></li><li><p>
              <tt class="literal">jboss-seam-debug.jar</tt>
            </p></li><li><p>
              <tt class="literal">jsf-facelets.jar</tt>
            </p></li><li><p>
              <tt class="literal">richfaces-api.jar</tt> &#8212; which requires Apache 
              commons-digester and commons-beanutils
            </p></li><li><p>
              <tt class="literal">richfaces-impl.jar</tt> and <tt class="literal">richfaces-ui.jar</tt> &#8212;
              which requires Apache commons-digester and commons-beanutils
            </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e14204"></a>26.1.2.&nbsp;Extra dependencies required by OC4J</h3></div></div><div></div></div><div class="itemizedlist"><ul type="disc"><li><p>
              Hibernate &#8212; of course, we decided to use Hibernate as the 
              JPA provider (rather than TopLink Essentials which ships with 
              OC4J).
            </p><p>
              To use Hibernate as your JPA provider you need three jars 
              (<tt class="literal">hibernate3.jar</tt>, <tt class="literal">hibernate-annotations.jar</tt>,
              <tt class="literal">hibernate-entitymanager.jar</tt>) and their 
              dependencies (<tt class="literal">jboss-common.jar</tt>, 
              <tt class="literal">jboss-archive-browsing.jar</tt> and
              <tt class="literal">ejb3-persistence.jar</tt>). You can find these 
              in the <tt class="literal">hibernate/lib</tt> directory in the Seam 
              distribution. 
            </p></li><li><p>
              <tt class="literal">thirdparty-all.jar</tt> &#8212; a selection of 
              third party libraries on which Seam depends (like javassist).
            </p></li></ul></div><p>
          Running Seam on most application servers (such as JBoss AS or 
          Glassfish) you only need to include the dependencies for those bits 
          of Seam you actually use (e.g. if you use Seam Text you need to 
          include ANTLR); but, on OC4J, due to its "interesting" classloading 
          you must always include them:
        </p><div class="itemizedlist"><ul type="disc"><li><p>
              <tt class="literal">antlr-2.7.6.jar</tt> &#8212; needed for Seam Text 
              (not used in the example).
            </p></li><li><p>
              <tt class="literal">jbpm-jpdl.jar</tt> &#8212; needed for Seam's JBPM 
              integration (not used in the example).
            </p></li><li><p>
              Drools &#8212; needed for Seam Security. We aren't using Seam 
              security with Drools, but have to include it. Drools consists 
              of 5 jars - <tt class="literal">drools-core-4.0.0.jar</tt>,
              <tt class="literal">drools-compiler-4.0.0.jar</tt>,
              <tt class="literal">janino-2.5.7.jar</tt>,
              <tt class="literal">mvel14-1.2rc1.jar</tt> and
              <tt class="literal">antlr-runtime-3.0.jar</tt>. Drools integration 
              is not used in the example.
            </p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e14273"></a>26.1.3.&nbsp;Configuration file changes</h3></div></div><div></div></div><p>There are just a few changes to be made:</p><div class="variablelist"><dl><dt><span class="term">
              <tt class="literal">web.xml</tt>
            </span></dt><dd><p>
                you need to declare all your ejb's in the 
                <tt class="literal">web.xml</tt>. This is a silly requirement of a 
                number of JEE 5 application servers - for example OC4J and 
                Glassfish.
              </p><pre class="programlisting">&lt;ejb-local-ref&gt;
   &lt;ejb-ref-name&gt;
      jboss-seam-jee5/AuthenticatorAction/local
   &lt;/ejb-ref-name&gt;
   &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;
   &lt;local-home/&gt;
   &lt;local&gt;
      org.jboss.seam.example.booking.Authenticator
   &lt;/local&gt;
   &lt;ejb-link&gt;AuthenticatorAction&lt;/ejb-link&gt;
&lt;/ejb-local-ref&gt;</pre></dd><dt><span class="term">
              <tt class="literal">persistence.xml</tt>
            </span></dt><dd><p>
                you need to provide the correct configuration for your JPA 
                implementation. We are using Hibernate and due to OC4J 
                bundling an old ANTLR, we need to use an alternative query 
                factory, we also want to use the OC4J transaction manager:
              </p><pre class="programlisting">&lt;property 
   name="hibernate.query.factory_class"
   value="org.hibernate.hql.classic.ClassicQueryTranslatorFactory" /&gt;
&lt;property
   name="hibernate.transaction.manager_lookup_class"
   value="org.hibernate.transaction.OrionTransactionManagerLookup" /&gt;</pre></dd></dl></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e14304"></a>26.1.4.&nbsp;Building the <tt class="literal">jee5/booking</tt> example</h3></div></div><div></div></div><div class="orderedlist"><ol type="1"><li><p>Modify the following files in the project:</p><div class="itemizedlist"><ul type="disc"><li><p>
                  <tt class="literal">build.xml</tt> &#8212; Un-comment the 
                  OC4J-related libraries
               </p></li><li><p>
                  <tt class="literal">resources/META-INF/persistence.xml</tt> &#8212;
                  Comment out the Glassfish properties and un-comment the OC4J 
                  properties.
                </p></li></ul></div></li><li><p>
              Build the demo app by running <tt class="literal">ant</tt>. The build 
              target is <tt class="literal">dist/jboss-seam-jee5.ear</tt>
            </p></li><li><p>
                Copy <tt class="literal">hsqldb.jar</tt> to OC4J:
                <tt class="literal">cp ../../seam-gen/lib/hsqldb.jar $ORACLE_HOME/j2ee/home/applib/</tt>
                (OC4J doesn't come with an embedded database so we decided to 
                use HSQLDB)
              </p></li></ol></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e14345"></a>26.2.&nbsp;Deploying a Seam application to OC4J</h2></div></div><div></div></div><p>
        This mini-tutorial describes the (fairly tedious) steps required to 
        deploy a JEE 5 application to OC4J. It assumes you are deploying the 
        <tt class="literal">jee5/booking</tt> example, using the embedded hsqldb 
        database. To deploy another application you would need to alter the 
        datasource and application name.
      </p><div class="orderedlist"><ol type="1"><li><p>
            Download and unzip OC4J
          </p></li><li><p>
            Make sure you have <tt class="literal">$JAVA_HOME</tt> and
            <tt class="literal">$ORACLE_HOME</tt> set as environment variables 
            (<tt class="literal">$ORACLE_HOME</tt> is the directory to which you 
            unzip OC4J). For further information on installing OC4J, consult 
            the <tt class="literal">Readme.txt</tt> distributed with OC4J
          </p></li><li><p>
            Edit the OC4J datasource
            <tt class="literal">$ORACLE_HOME/j2ee/home/config/data-sources.xml</tt>
            and, inside <tt class="literal">&lt;data-sources&gt;</tt>, add
          </p><pre class="programlisting">&lt;managed-data-source
   connection-pool-name="jee5-connection-pool"
   jndi-name="jdbc/__default"
   name="jee5-managed-data-source" /&gt;
&lt;connection-pool name="jee5-connection-pool"&gt;
   &lt;connection-factory
      factory-class="org.hsqldb.jdbcDriver" 
      user="sa"
      password="" 
      url="jdbc:hsqldb:." /&gt;
&lt;/connection-pool&gt;</pre><p>
            The <tt class="literal">jndi-name</tt> is used as the
            <tt class="literal">jta-data-source</tt> in 
            <tt class="literal">persistence.xml</tt>.
          </p></li><li><p>
            Edit <tt class="literal">$ORACLE_HOME/j2ee/home/config/server.xml</tt>
           and, inside <tt class="literal">&lt;application-server&gt;</tt>, add
          </p><pre class="programlisting">&lt;application name="jboss-seam-jee5"
 path="../../home/applications/jboss-seam-jee5.ear"
 parent="default" 
 start="true" /&gt;</pre><p>
            To keep things simple use the same names as you used for project.
          </p></li><li><p>
            Edit <tt class="literal">$ORACLE_HOME/j2ee/home/config/default-web-site.xml</tt>,
            and, inside <tt class="literal">&lt;web-site&gt;</tt>, add
          </p><pre class="programlisting">&lt;web-app application="jboss-seam-jee5"
 name="jboss-seam-jee5" 
 load-on-startup="true"
 root="/seam-jee5" /&gt;</pre><p>
            The <tt class="literal">root</tt> is the context path you will put into 
            your web browser to access the application.
          </p></li><li><p>
            Copy the application to OC4J: 
            <tt class="literal">cp dist/jboss-seam-jee5.ear $ORACLE_HOME/j2ee/home/applications/</tt>
           </p></li><li><p>
            Start OC4J:
            <tt class="literal">$ORACLE_HOME/bin/oc4j -start</tt>
          </p><p>
            You will be asked to set the admin password if this is
            the first time you've started OC4J
          </p></li><li><p>
            Checkout the app at:
            <tt class="literal">http://localhost:8888/seam-jee5</tt>
          </p></li><li><p>
            You can stop the server by pressing <tt class="literal">CTRL-C</tt> in 
            the console on which the server is running.
          </p></li></ol></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e14449"></a>26.3.&nbsp;
        Deploying an application created using <tt class="literal">seam-gen</tt>
        to OC4J
      </h2></div></div><div></div></div><p>
        The following explanation assumes you are using the command line and 
        a simple text editor, but of course you can use your favourite IDE - 
        <tt class="literal">seam-gen</tt> projects come with support for Eclipse 
        and Netbeans.
      </p><p>
        We start by creating a pretty simple application using
        <tt class="literal">seam-gen</tt>.  <tt class="literal">seam-gen</tt> uses 
        Hibernate Tools to reverse engineer a database schema to JPA entity 
        beans; it also genereates Seam Application Framework components and 
        JSF views for CRUD. This tutorial uses MySQL (but of course you 
        could use any database, altering the SQL as appropriate); install, 
        configure and run MySQL, then create a database with some sample 
        data.
      </p><p>
        Next, run <tt class="literal">./seam setup</tt> in the seam directory. 
      </p><pre class="programlisting">&gt; ./seam setup
Buildfile: build.xml

setup:
    [echo] Welcome to seam-gen :-)
    [input] Enter your Java project workspace (the directory that contains your Seam projects) [/home/pmuir/workspace] [/home/pmuir/workspace]

    [input] Enter your JBoss home directory [/home/pmuir/java/jboss-4.2.1.GA] [/home/pmuir/java/jboss-4.2.1.GA]

    [input] Enter the project name [oc4j-example] [oc4j-example]

    [input] Is this project deployed as an EAR (with EJB components) or a WAR (with no EJB support) [ear]  ([ear], war, )

    [input] Enter the Java package name for your session beans [org.jboss.seam.tutorial.oc4j.action] [org.jboss.seam.tutorial.oc4j.action]

    [input] Enter the Java package name for your entity beans [org.jboss.seam.tutorial.oc4j.model] [org.jboss.seam.tutorial.oc4j.model]

    [input] Enter the Java package name for your test cases [org.jboss.seam.tutorial.oc4j.test] [org.jboss.seam.tutorial.oc4j.test]

    [input] What kind of database are you using? [mysql]  (hsql, [mysql], oracle, postgres, mssql, db2, sybase, enterprisedb, )

    [input] Enter the Hibernate dialect for your database [org.hibernate.dialect.MySQLDialect] [org.hibernate.dialect.MySQLDialect]

    [input] Enter the filesystem path to the JDBC driver jar [lib/mysql.jar] [lib/mysql.jar]

    [input] Enter JDBC driver class for your database [com.mysql.jdbc.Driver] [com.mysql.jdbc.Driver]

    [input] Enter the JDBC URL for your database [jdbc:mysql:///oc4j] [jdbc:mysql:///oc4j]

    [input] Enter database username [user] [user]

    [input] Enter database password [password] [password]

    [input] skipping input as property hibernate.default_schema.new has already been set.
    [input] Enter the database catalog name (it is OK to leave this blank) [] []

    [input] Are you working with tables that already exist in the database? [y]  ([y], n, )

    [input] Do you want to drop and recreate the database tables and data in import.sql each time you deploy? [n]  (y, [n], )

    [propertyfile] Updating property file: /home/pmuir/workspace/jboss-seam/seam-gen/build.properties
    [echo] Installing JDBC driver jar to JBoss server
    [echo] Type 'seam new-project' to create the new project

BUILD SUCCESSFUL</pre><p>
        Type <tt class="literal">./seam new-project</tt> to create your project and
        <tt class="literal">cd</tt> to the newly created project.
      </p><p>
        Type <tt class="literal">./seam generate-entities</tt> to run create the 
        entities, the Seam Application Framework classes and the relevant 
        views.
      </p><p>
        We now need to make some changes to the generated project. Let's 
        start with the configuration files:
      </p><div class="variablelist"><dl><dt><span class="term">
            <tt class="literal">resources/META-INF/persistence-dev.xml</tt>
          </span></dt><dd><div class="itemizedlist"><ul type="disc"><li><p>
                  Alter the <tt class="literal">jta-data-source</tt> to be 
                  <tt class="literal">jdbc/__oc4jExample</tt> (and use this as the
                  <tt class="literal">jndi-name</tt> when creating the data source 
                  in <tt class="literal">data-sources.xml</tt>).
                </p></li><li><p>Add the properties (described above):</p><pre class="programlisting">&lt;property name="hibernate.query.factory_class"
   value="org.hibernate.hql.classic.ClassicQueryTranslatorFactory" /&gt;
&lt;property name="hibernate.transaction.manager_lookup_class"
   value="org.hibernate.transaction.OrionTransactionManagerLookup" /&gt;
&lt;property name="hibernate.transaction.flush_before_completion" 
   value="true"/&gt;
&lt;property name="hibernate.cache.provider_class" 
   value="org.hibernate.cache.HashtableCacheProvider"/&gt;</pre></li><li><p>
                  Remove the JBoss AS specific method of exposing the
                  EntityManagerFactory:
                </p><pre class="programlisting">&lt;property 
 name="jboss.entity.manager.factory.jndi.name" 
 value="java:/oc4j-exampleEntityManagerFactory"&gt;</pre></li><li><p>
                  You'll need to alter <tt class="literal">persistence-prod.xml</tt>
                  as well if you want to deploy to OC4J using the prod profile.
                </p></li></ul></div></dd><dt><span class="term">
            <tt class="literal">resources/META-INF/jboss-app.xml</tt>
          </span></dt><dd><p>
              You can delete this file as we aren't deploying to JBoss AS 
              (<tt class="literal">jboss-app.xml</tt> is used to enable 
              classloading isolation in JBoss AS)
            </p></dd><dt><span class="term">
            <tt class="literal">resources/*-ds.xml</tt>
          </span></dt><dd><p>
              You can delete these file as we aren't deploying to JBoss AS 
              (these files define datasources in JBoss AS, in OC4J you have 
              to edit the master <tt class="literal">data-sources.xml</tt> file)
            </p></dd><dt><span class="term">
            <tt class="literal">resources/WEB-INF/components.xml</tt>
          </span></dt><dd><div class="itemizedlist"><ul type="disc"><li><p>
                  Enable container managed transaction integration - add the 
                  <tt class="literal">&lt;transaction:ejb-transaction /&gt;</tt>
                  component, and it's namespace declaration
                  <tt class="literal">xmlns:transaction="http://jboss.com/products/seam/transaction"</tt>
                </p></li><li><p>
                  Alter the <tt class="literal">jndi-pattern</tt> to 
                  <tt class="literal">java:comp/env/oc4j-example/#{ejbName}/local</tt>
                </p></li><li><p>
                  We want to use a Seam Managed Persistence Context in our 
                  application. Unfortunately OC4J doesn't expose the 
                  EntityManagerFactory in JNDI, but Seam provides a built-in
                  manager component:
                </p><pre class="programlisting">&lt;persistence:entity-manager-factory
 auto-create="true" 
 name="oc4jEntityManagerFactory"
 persistence-unit-name="oc4j-example" /&gt;</pre><p>
                  We then need to tell Seam to use it, so we alter the 
                  <tt class="literal">managed-persistence-context</tt> injecting 
                  the Entity Manager Factory:
                </p><pre class="programlisting">&lt;persistence:managed-persistence-context
 name="entityManager"
 auto-create="true"
 entity-manager-factory="#{oc4jEntityManagerFactory}" /&gt;
                </pre></li></ul></div></dd><dt><span class="term">
            <tt class="literal">resources/WEB-INF/web.xml</tt>
          </span></dt><dd><p>
              You need to declare all your EJBs here. Remember to include 
              the Seam container managed transaction integration:
            </p><pre class="programlisting">&lt;ejb-local-ref&gt;
   &lt;ejb-ref-name&gt;
      oc4j-example/EjbSynchronizations/local
   &lt;/ejb-ref-name&gt;
   &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;
   &lt;local&gt;
      org.jboss.seam.transaction.LocalEjbSynchronizations
   &lt;/local&gt;
   &lt;ejb-link&gt;EjbSynchronizations&lt;/ejb-link&gt;
&lt;/ejb-local-ref&gt;</pre></dd><dt><span class="term">
            <tt class="literal">build.xml</tt>
          </span></dt><dd>
            Change the default target to archive (we aren't going to cover 
            automatic deployment to OC4J).
          </dd></dl></div><p>Now, lets add in the extra dependencies:</p><div class="itemizedlist"><ul type="disc"><li><p>
            Hibernate &#8212;
          </p><div class="itemizedlist"><ul type="circle"><li><p>
                Copy the jars from <tt class="literal">hibernate/lib</tt> directory 
                in the Seam distribution <tt class="literal">oc4j-example/lib</tt>:
                <tt class="literal">cp ../jboss-seam/hibernate/lib/*.jar lib/</tt>
              </p></li><li><p>
                Alter the build.xml to include them in the ear - add these 
                includes underneath the other libraries being copies:
              </p><pre class="programlisting">&lt;include name="lib/hibernate-annotations.jar" /&gt;
&lt;include name="lib/hibernate-entitymanager.jar" /&gt;
&lt;include name="lib/hibernate3.jar" /&gt;
&lt;include name="ejb3-peristence.jar" /&gt;
&lt;include name="lib/jboss-archive-browsing.jar" /&gt;
&lt;include name="lib/jboss-common.jar" /&gt;</pre></li></ul></div></li><li><p>
            <tt class="literal">thirdparty-all.jar</tt> &#8212; alter the 
            <tt class="literal">build.xml</tt> to include it - add this include:
          </p><pre class="programlisting">&lt;include name="lib/thirdparty-all.jar" /&gt;</pre></li><li><p>
            <tt class="literal">antlr-2.7.6.jar</tt> &#8212; alter the build.xml to 
            include it - add this include:
          </p><pre class="programlisting">&lt;include name="lib/antlr-*.jar" /&gt;</pre></li><li><p>
            As we are using Drools to provide Seam Security rules, we need 
            to add in Eclipse JDT compiler (you don't need this on JBoss AS; 
            again this is due to OC4J's classloading):
          </p><div class="itemizedlist"><ul type="circle"><li><pre class="programlisting">cp ../jboss-seam/seam-gen/lib/org.eclipse.jdt.core*.jar lib/</pre></li><li><p>
                Alter the build.xml to include them in the ear:
              </p><pre class="programlisting">&lt;include name="lib/org.eclipse.jdt.core*.jar" /&gt;</pre></li></ul></div></li></ul></div><p>You should end up with something like:</p><pre class="programlisting">&lt;fileset dir="${basedir}"&gt;
   &lt;!-- other libraries added by seam-gen --&gt;
   &lt;include name="lib/hibernate-annotations.jar" /&gt;
   &lt;include name="lib/hibernate-entitymanager.jar" /&gt;
   &lt;include name="lib/hibernate3.jar" /&gt;
   &lt;include name="lib/jboss-archive-browsing.jar" /&gt;
   &lt;include name="lib/jboss-common.jar" /&gt;
   &lt;include name="lib/thirdparty-all.jar" /&gt;
   &lt;include name="lib/antlr-*.jar" /&gt;
   &lt;include name="lib/org.eclipse.jdt.core*.jar" /&gt;
&lt;/fileset&gt;</pre><p>
        Finally, lets link our <tt class="literal">User</tt> entity into Seam 
        Security (we have a <tt class="literal">User</tt> table with a 
        <tt class="literal">username</tt> column and a <tt class="literal">password</tt> 
        column). We're going to make our authentictor a Stateless Session 
        Bean (OC4J is a EJB3 container after all!):
      </p><div class="orderedlist"><ol type="1"><li><div class="itemizedlist"><ul type="disc"><li><p>
                Add the <tt class="literal">@Stateless</tt> annotation.
              </p></li><li><p>
                Rename the class to <tt class="literal">AuthenticatorAction</tt>
              </p></li><li><p>
                Create an interface called <tt class="literal">Authenticator</tt>
                which <tt class="literal">AuthenticatorAction</tt> implements (EJB3 
                requires session beans to have a local interface). Annotate 
                the interface with <tt class="literal">@Local</tt>, and add a 
                single method with same signature as the <tt class="literal">authenticate</tt>
                in <tt class="literal">AuthenticatorAction</tt>.
              </p></li></ul></div><pre class="programlisting">@Name("authenticator") @Stateless public class
            AuthenticatorAction implements Authenticator {</pre><pre class="programlisting">@Local public interface Authenticator { 
  public boolean authenticate(); 
}</pre></li><li><p>
            Use <tt class="literal">@PersistenceContext</tt> to inject an 
            EntityManager:
          </p><pre class="programlisting">@PersistenceContext private EntityManager entityManager;</pre></li><li><p>
            Implement authenticate:
          </p><pre class="programlisting">public boolean authenticate() {
   List &amp;lt;User&amp;gt; users = entityManager .createQuery("select u from User u where 
   u.username = #{identity.username} and 
   u.password = #{identity.password}") .getResultList();
   if (users.size() == 1) {
      identity.addRole("admin"); 
      return true; 
   } else {
      return false; 
   } 
}</pre></li><li><p>
             And then add the EJB3 reference to <tt class="literal">web.xml</tt>:
          </p><pre class="programlisting">&lt;ejb-local-ref&gt;
   &lt;ejb-ref-name&gt;
      oc4j-example/AuthenticatorAction/local
   &lt;/ejb-ref-name&gt;
   &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;
   &lt;local&gt;
      org.jboss.seam.tutorial.oc4j.action.Authenticator
   &lt;/local&gt;
   &lt;ejb-link&gt;AuthenticatorAction&lt;/ejb-link&gt;
&lt;/ejb-local-ref&gt;</pre></li></ol></div><p>
      Now you can go on and customize your application.
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e14744"></a>26.3.1.&nbsp;OC4J Deployment Descriptors for the seam-gen'd application</h3></div></div><div></div></div><p>
          To deploy your application use the deployment instructions above in 
          conjunction with these deployment descriptors:
        </p><div class="variablelist"><dl><dt><span class="term">
              <tt class="literal">$ORACLE_HOME/j2ee/home/config/data-sources.xml</tt>
            </span></dt><dd><pre class="programlisting">&lt;managed-data-source
   connection-pool-name="oc4j-example-connection-pool"
   jndi-name="jdbc/__oc4jExample"
   name="oc4j-example-managed-data-source" /&gt;
&lt;connection-pool
   name="oc4j-example-connection-pool"&gt;
   &lt;connection-factory
      factory-class="com.mysql.jdbc.Driver"
      user="username" 
      password="password"
      url="jdbc:mysql:///oc4j" /&gt;
&lt;/connection-pool&gt;</pre></dd><dt><span class="term">
              <tt class="literal">$ORACLE_HOME/j2ee/home/config/server.xml</tt>
            </span></dt><dd><pre class="programlisting">&lt;application name="oc4j-example"
 path="../../home/applications/oc4j-example.ear"
 parent="default"
 start="true" /&gt;</pre></dd><dt><span class="term">
              <tt class="literal">$ORACLE_HOME/j2ee/home/config/default-web-site.xml</tt>
            </span></dt><dd><pre class="programlisting">&lt;web-app application="oc4j-example"
 name="oc4j-example" 
 load-on-startup="true"
 root="/oc4j-example" /&gt;</pre></dd></dl></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="configuration.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="annotations.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;25.&nbsp;Configuring Seam and packaging Seam applications&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;27.&nbsp;Seam annotations</td></tr></table></div></body></html>