<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;8.&nbsp;Seam&#21644;&#23545;&#35937;/&#20851;&#31995;&#26144;&#23556;</title><link rel="stylesheet" href="../shared/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Seam - &#35821;&#22659;&#30456;&#20851;&#30340;&#32452;&#20214; [&#28385;&#27743;&#32418;20080327]"><link rel="up" href="index.html" title="Seam - &#35821;&#22659;&#30456;&#20851;&#30340;&#32452;&#20214; [&#28385;&#27743;&#32418;20080327]"><link rel="previous" href="jbpm.html" title="Chapter&nbsp;7.&nbsp;&#39029;&#38754;&#27969;&#21644;&#19994;&#21153;&#27969;&#31243;"><link rel="next" href="validation.html" title="Chapter&nbsp;9.&nbsp;Seam&#20013;&#30340;JSF&#34920;&#21333;&#39564;&#35777;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;8.&nbsp;Seam&#21644;&#23545;&#35937;/&#20851;&#31995;&#26144;&#23556;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="jbpm.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="validation.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="persistence"></a>Chapter&nbsp;8.&nbsp;Seam&#21644;&#23545;&#35937;/&#20851;&#31995;&#26144;&#23556;</h2></div></div><div></div></div><p>
        Seam&#32473;&#20004;&#20010;&#26368;&#27969;&#34892;&#30340;Java&#25345;&#20037;&#21270;&#26550;&#26500;&#65306;Hibernate3&#21644;&#30001;EJB 3.0&#24341;&#20837;&#30340;Java Persistence API&#25552;&#20379;&#20102;&#24191;&#27867;&#25903;&#25345;&#12290;
        Seam&#29420;&#26377;&#30340;&#29366;&#24577;&#31649;&#29702;&#26550;&#26500;&#20801;&#35768;&#20219;&#24847;web&#24212;&#29992;&#26694;&#26550;&#19982;&#22823;&#22810;&#25968;&#25104;&#29087;&#30340;ORM&#36827;&#34892;&#38598;&#25104;&#12290;
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6053"></a>8.1.&nbsp;&#31616;&#20171;</h2></div></div><div></div></div><p>
        Seam&#26159;&#20174;Hibernate&#22242;&#38431;&#35797;&#22270;&#29983;&#25104;&#20856;&#22411;&#30340;&#26080;&#29366;&#24577;Java&#24212;&#29992;&#26550;&#26500;&#30340;&#25387;&#25240;&#20013;&#25104;&#38271;&#36215;&#26469;&#30340;&#12290;
        &#19978;&#19968;&#20195;Java&#24212;&#29992;&#31243;&#24207;&#30340;&#26080;&#29366;&#24577;&#29305;&#24615;&#35753;Hibernate&#22242;&#38431;&#39281;&#21463;&#25387;&#25240;&#65292;Seam&#21560;&#21462;&#20102;&#20182;&#20204;&#30340;&#32463;&#39564;&#12290;
        Seam&#30340;&#29366;&#24577;&#31649;&#29702;&#26550;&#26500;&#26368;&#26089;&#26159;&#29992;&#26469;&#35299;&#20915;&#25345;&#20037;&#21270;&#20914;&#31361;&#30456;&#20851;&#38382;&#39064;&#30340;&#65292;&#29305;&#21035;&#26159; <span class="emphasis"><em>&#20048;&#35266;&#20107;&#21153;&#22788;&#29702;</em></span> &#30456;&#20851;&#30340;&#38382;&#39064;&#12290;&#21487;&#25193;&#23637;&#30340;&#22312;&#32447;&#24212;&#29992;&#32463;&#24120;&#20351;&#29992;&#20048;&#35266;&#20107;&#21153;&#12290;
        &#19968;&#20010;&#21407;&#23376;(database/JTA)&#32423;&#30340;&#20107;&#21153;&#19981;&#24212;&#35813;&#36328;&#29992;&#25143;&#20132;&#20114;&#65292;&#38500;&#38750;&#31995;&#32479;&#35774;&#35745;&#26102;&#23601;&#26159;&#21482;&#25903;&#25745;&#24456;&#23569;&#37327;&#30340;&#24182;&#21457;&#23458;&#25143;&#31471;&#12290;
        &#20294;&#20960;&#20046;&#25152;&#26377;&#28041;&#21450;&#21040;&#30340;&#24037;&#20316;&#37117;&#26159;&#20808;&#23558;&#25968;&#25454;&#23637;&#29616;&#32473;&#29992;&#25143;&#65292;&#27809;&#22810;&#20037;&#21518;&#26356;&#26032;&#36825;&#20010;&#25968;&#25454;&#12290;&#25152;&#20197;Hibernate&#26159;&#20381;&#25454;&#25903;&#25345;&#19968;&#31181;&#36328;&#20048;&#35266;&#20107;&#21153;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#30340;&#24605;&#24819;&#35774;&#35745;&#30340;&#12290;
    </p><p>
        &#19981;&#24184;&#30340;&#26159;&#36825;&#20010;&#20808;&#20110;Seam&#21644;EJB3.0&#20986;&#29616;&#30340;&#25152;&#35859;&#8220;&#26080;&#29366;&#24577;&#8221;&#26550;&#26500;&#24182;&#19981;&#23545;&#20048;&#35266;&#20107;&#21153;&#36827;&#34892;&#25903;&#25345;&#12290;&#32780;&#30456;&#21453;&#65292;&#36825;&#20123;&#26550;&#26500;&#25552;&#20379;&#23545;&#20110;&#21407;&#23376;&#20107;&#21153;&#32423;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#30340;&#25903;&#25345;&#12290;
        &#36825;&#24403;&#28982;&#32473;&#29992;&#25143;&#24102;&#26469;&#20102;&#24456;&#22810;&#40635;&#28902;&#65292;&#36825;&#20063;&#26159;&#29992;&#25143;&#25265;&#24616;&#25490;&#21517;&#31532;&#19968;&#30340;Hibernate&#30340; <tt class="literal">LazyInitializationException</tt> &#38382;&#39064;&#30340;&#21407;&#22240;&#12290;
        &#25105;&#20204;&#38656;&#35201;&#30340;&#26159;&#22312;&#24212;&#29992;&#23618;&#26500;&#24314;&#23545;&#20110;&#20048;&#35266;&#20107;&#21153;&#30340;&#25903;&#25345;&#12290;
    </p><p>
        EJB3.0&#35748;&#35782;&#21040;&#20102;&#27492;&#38382;&#39064;&#65292;&#24182;&#19988;&#20063;&#24341;&#20837;&#20102;&#26377;&#29366;&#24577;&#32452;&#20214;&#65288;&#26377;&#29366;&#24577;&#20250;&#35805;bean&#65289;&#30340;&#24605;&#24819;&#65292;&#23427;&#20351;&#29992;&#19968;&#20010; <span class="emphasis"><em>&#25193;&#23637;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;</em></span>&#26469;&#36319;&#36394;&#32452;&#20214;&#30340;&#29983;&#21629;&#21608;&#26399;&#12290;
        &#36825;&#26159;&#35813;&#38382;&#39064;&#30340;&#37096;&#20998;&#35299;&#20915;&#26041;&#26696;&#65288;&#23545;&#23427;&#33258;&#36523;&#32780;&#35328;&#20063;&#26159;&#19968;&#20010;&#26377;&#29992;&#30340;&#26500;&#24819;&#65289;&#65292;&#28982;&#32780;&#36824;&#26377;&#20004;&#20010;&#38382;&#39064;&#65306;
    </p><div class="itemizedlist"><ul type="disc"><li><p>
                &#26377;&#29366;&#24577;&#20250;&#35805;bean&#30340;&#29983;&#21629;&#21608;&#26399;&#24517;&#39035;&#22312;Web&#23618;&#36890;&#36807;&#20195;&#30721;&#25163;&#21160;&#31649;&#29702;&#65288;&#36825;&#26159;&#20010;&#40635;&#28902;&#30340;&#38382;&#39064;&#65292;&#32780;&#19988;&#23454;&#36341;&#36215;&#26469;&#27604;&#21548;&#19978;&#21435;&#26356;&#22797;&#26434;&#65289;&#12290;
            </p></li><li><p>
                &#22312;&#21516;&#19968;&#20010;&#20048;&#35266;&#20107;&#21153;&#30340;&#19981;&#21516;&#26377;&#29366;&#24577;&#32452;&#20214;&#38388;&#65292;&#20256;&#25773;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#26159;&#21487;&#34892;&#30340;&#65292;&#20294;&#24456;&#22256;&#38590;&#12290;
            </p></li></ul></div><p>
        Seam&#36890;&#36807;&#25552;&#20379;&#23545;&#35805;(Conversation)&#21644;&#23545;&#35805;&#26399;&#38388;&#30340;&#26377;&#29366;&#24577;Session Bean&#32452;&#20214;&#26469;&#35299;&#20915;&#31532;&#19968;&#20010;&#38382;&#39064;&#65288;&#22823;&#22810;&#25968;&#20250;&#35805;&#23454;&#38469;&#19978;&#22312;&#25968;&#25454;&#23618;&#25903;&#25345;&#20048;&#35266;&#20107;&#21153;&#65289;&#12290;
        &#36825;&#23545;&#20110;&#24456;&#22810;&#19981;&#38656;&#35201;&#20256;&#36882;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#30340;&#31616;&#21333;&#24212;&#29992;&#65288;&#27604;&#22914;Seam&#30340;&#35746;&#38405;&#28436;&#31034;&#31243;&#24207;&#65289;&#24050;&#32463;&#36275;&#22815;&#20102;&#12290;
        &#23545;&#20110;&#26356;&#22797;&#26434;&#30340;&#22312;&#27599;&#19968;&#20010;&#23545;&#35805;&#20013;&#30340;&#26377;&#24456;&#22810;&#26494;&#32806;&#21512;&#32452;&#20214;&#30340;&#24212;&#29992;&#26469;&#35828;&#65292;&#32452;&#20214;&#38388;&#20256;&#25773;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#23601;&#25104;&#20026;&#19968;&#20010;&#37325;&#35201;&#30340;&#38382;&#39064;&#20102;&#12290;
        &#25152;&#20197;Seam&#25193;&#23637;&#20102;EJB 3.0&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#31649;&#29702;&#27169;&#22411;&#65292;&#20197;&#27492;&#26469;&#25552;&#20379;&#23545;&#35805;&#20316;&#29992;&#22495;&#30340;&#25193;&#23637;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#12290;
    </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="persistence.seam-managed-transactions"></a>8.2.&nbsp;Seam&#31649;&#29702;&#30340;&#20107;&#21153;</h2></div></div><div></div></div><p>
            EJB&#20250;&#35805;Bean&#26377;&#22768;&#26126;&#24335;&#20107;&#21153;&#31649;&#29702;&#21151;&#33021;&#12290;&#24403;Bean&#34987;&#35843;&#29992;&#26102;&#65292;EJB&#23481;&#22120;&#33021;&#22815;&#36879;&#26126;&#22320;&#24320;&#22987;&#19968;&#20010;&#20107;&#21153;&#65292;&#22312;&#35843;&#29992;&#32467;&#26463;&#26102;&#20851;&#38381;&#27492;&#20107;&#21153;&#12290;
            &#22914;&#26524;&#25105;&#20204;&#20889;&#20102;&#19968;&#20010;&#20316;&#20026;JSF&#21160;&#20316;&#30417;&#21548;&#22120;&#30340;&#20250;&#35805;Bean&#26041;&#27861;&#65292;&#25105;&#20204;&#23601;&#21487;&#20197;&#22312;&#19968;&#20010;&#20107;&#21153;&#20869;&#22788;&#29702;&#25152;&#26377;&#19982;&#27492;action&#30456;&#20851;&#30340;&#24037;&#20316;&#65292;&#24182;&#19988;&#24403;&#25105;&#20204;&#23436;&#25104;&#27492;&#21160;&#20316;&#22788;&#29702;&#26102;&#20107;&#21153;&#24517;&#39035;&#34987;&#25552;&#20132;&#25110;&#22238;&#28378;&#12290;
           &#36825;&#26159;&#19968;&#20010;&#24456;&#26834;&#30340;&#21151;&#33021;&#65292;&#22312;&#24456;&#22810;Seam&#24212;&#29992;&#31243;&#24207;&#20013;&#36825;&#26159;&#24517;&#38656;&#30340;&#12290;
    	</p><p>
            &#20294;&#26159;&#65292;&#27492;&#26041;&#27861;&#36824;&#26159;&#26377;&#38382;&#39064;&#12290;Seam&#24212;&#29992;&#21487;&#33021;&#26080;&#27861;&#22312;&#23545;&#20250;&#35805;Bean&#30340;&#19968;&#27425;&#26041;&#27861;&#35843;&#29992;&#35831;&#27714;&#20013;&#23436;&#25104;&#25152;&#26377;&#30340;&#25968;&#25454;&#35775;&#38382;&#12290;
    	</p><div class="itemizedlist"><ul type="disc"><li><p>
                    &#27492;&#35831;&#27714;&#21487;&#33021;&#30001;&#20960;&#20010;&#26494;&#32806;&#21512;&#32452;&#20214;&#22788;&#29702;&#65292;Web&#23618;&#29420;&#31435;&#22320;&#35843;&#29992;&#27599;&#19968;&#20010;&#32452;&#20214;&#12290;&#22312;Seam&#20013;&#65292;Web&#23618;&#30340;&#19968;&#20010;&#35831;&#27714;&#23545;EJB&#32452;&#20214;&#21457;&#36215;&#20960;&#27425;&#29978;&#33267;&#22810;&#27425;&#35843;&#29992;&#30340;&#29616;&#35937;&#26159;&#24456;&#24120;&#35265;&#30340;&#12290;
    			</p></li><li><p>
                    &#35270;&#22270;&#28210;&#26579;&#21487;&#33021;&#38656;&#35201;&#24310;&#36831;&#20851;&#32852;&#33719;&#21462;&#65288;lazy fetching of associations&#65289;&#12290;
                </p></li></ul></div><p>
            &#27599;&#20010;&#35831;&#27714;&#30340;&#20107;&#21153;&#37327;&#36234;&#22810;&#65292;&#24403;&#25105;&#20204;&#30340;&#24212;&#29992;&#22788;&#29702;&#22823;&#37327;&#24182;&#21457;&#35831;&#27714;&#26102;&#36234;&#21487;&#33021;&#30896;&#21040;&#21407;&#23376;&#21644;&#38548;&#31163;&#38382;&#39064;&#12290;&#24403;&#28982;&#65292;&#25152;&#26377;&#30340;&#20889;&#25805;&#20316;&#35201;&#22312;&#19968;&#20010;&#20107;&#21153;&#20013;&#25191;&#34892;&#12290;
    	</p><p>
            Hibernate&#29992;&#25143;&#24320;&#21457;&#20102; <span class="emphasis"><em>"Open Session in View"</em></span> &#27169;&#24335;&#26469;&#35299;&#20915;&#35813;&#38382;&#39064;&#12290;
            &#22312;Hibernate&#31038;&#21306;&#65292;"Open Session in View"&#26366;&#32463;&#38750;&#24120;&#37325;&#35201;&#65292;&#36825;&#26159;&#22240;&#20026;&#20687;Spring&#36825;&#26679;&#30340;&#26694;&#26550;&#20351;&#29992;&#20102;&#20107;&#21153;&#20316;&#29992;&#22495;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#12290;
            &#25152;&#20197;&#24403;&#26410;&#33719;&#24471;&#30340;&#20851;&#32852;&#34987;&#35775;&#38382;&#26102;&#28210;&#26579;&#35270;&#22270;&#23558;&#24341;&#36215; <tt class="literal">LazyInitializationException</tt> &#24322;&#24120;&#12290;
    	</p><p>
            &#36825;&#20010;&#27169;&#24335;&#36890;&#24120;&#20316;&#20026;&#19968;&#20010;&#36328;&#36234;&#25972;&#20010;&#35831;&#27714;&#30340;&#20107;&#21153;&#26469;&#23454;&#29616;&#12290;
            &#27492;&#23454;&#29616;&#26041;&#24335;&#20250;&#26377;&#20960;&#20010;&#38382;&#39064;&#65292;&#20854;&#20013;&#26368;&#20005;&#37325;&#30340;&#26159;&#21482;&#26377;&#25105;&#20204;&#25552;&#20132;&#20102;&#20107;&#21153;&#25165;&#33021;&#30830;&#35748;&#23427;&#25104;&#21151;&#23436;&#25104;&#8212;&#8212;&#20294;&#22312;"Open Session in View"&#30340;&#20107;&#21153;&#25552;&#20132;&#26102;&#65292;&#35270;&#22270;&#24050;&#32463;&#23436;&#20840;&#28210;&#26579;&#20102;&#65292;&#29978;&#33267;&#28210;&#26579;&#22909;&#30340;&#24212;&#31572;&#21487;&#33021;&#24050;&#32463;&#21047;&#26032;&#21040;&#23458;&#25143;&#31471;&#12290;&#25105;&#20204;&#24590;&#26679;&#25165;&#33021;&#36890;&#30693;&#29992;&#25143;&#20182;&#20204;&#30340;&#20107;&#21153;&#24050;&#22833;&#36133;&#21602;&#65311;
    	</p><p>
            Seam&#22312;&#35299;&#20915;"Open Session in View"&#38382;&#39064;&#26102;&#65292;&#20063;&#35299;&#20915;&#20102;&#20107;&#21153;&#38548;&#31163;&#21644;&#20851;&#32852;&#33719;&#21462;&#38382;&#39064;&#12290;&#35813;&#26041;&#26696;&#26377;&#26377;&#20004;&#20010;&#37096;&#20998;&#65306;
    	</p><div class="itemizedlist"><ul type="disc"><li><p>
               &#20351;&#29992;&#20351;&#29992;&#24050;&#25193;&#23637;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#65292;&#21487;&#20197;&#35206;&#30422;&#19968;&#20010;&#20250;&#35805;&#20316;&#29992;&#22495;&#32780;&#19981;&#26159;&#21333;&#20010;&#20107;&#21153;&#20316;&#29992;&#22495;&#12290;
    			</p></li><li><p>
                    &#27599;&#27425;&#35831;&#27714;&#20351;&#29992;&#20004;&#20010;&#20107;&#21153;&#65307;&#31532;&#19968;&#20010;&#20174;&#26356;&#26032;&#27169;&#22411;&#20540;&#30340;&#36215;&#22987;&#38454;&#27573;&#21040;&#24212;&#29992;&#31243;&#24207;&#35843;&#29992;&#32467;&#26463;&#65307;&#31532;&#20108;&#20010;&#36328;&#36234;&#28210;&#26579;&#21709;&#24212;&#38454;&#27573;&#12290;
    			</p></li></ul></div><p>
            &#19979;&#19968;&#33410;&#65292;&#25105;&#20204;&#23558;&#20250;&#21578;&#35785;&#20320;&#22914;&#20309;&#23433;&#35013;&#19968;&#20010;&#20250;&#35805;&#20316;&#29992;&#22495;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#12290;&#20294;&#39318;&#20808;&#25105;&#20204;&#38656;&#35201;&#20320;&#30693;&#36947;&#22914;&#20309;&#21551;&#29992;Seam&#20107;&#21153;&#31649;&#29702;&#12290;
            &#27880;&#24847;&#20320;&#21487;&#20197;&#33073;&#31163;Seam&#30340;&#20107;&#21153;&#31649;&#29702;&#26469;&#20351;&#29992;&#20250;&#35805;&#20316;&#29992;&#22495;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#12290;&#24403;&#20320;&#19981;&#20351;&#29992;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#26102;&#65292;&#20320;&#20063;&#26377;&#24456;&#22810;&#20351;&#29992;Seam&#20107;&#21153;&#31649;&#29702;&#30340;&#29702;&#30001;&#12290;
            &#28982;&#32780;&#36825;&#20004;&#31181;&#21151;&#33021;&#34987;&#35774;&#35745;&#20026;&#19968;&#36215;&#20351;&#29992;&#30340;&#65292;&#19968;&#36215;&#20351;&#29992;&#26102;&#25928;&#26524;&#26368;&#22909;&#12290;
        </p><p>
            &#21363;&#20351;&#20320;&#20351;&#29992;EJB 3.0&#23481;&#22120;&#31649;&#29702;&#20107;&#21153;&#19978;&#19979;&#25991;&#65292;Seam&#20107;&#21153;&#31649;&#29702;&#20063;&#26159;&#24456;&#26377;&#29992;&#30340;&#12290;&#22914;&#26524;&#20320;&#22312;Java EE 5&#29615;&#22659;&#22806;&#20351;&#29992;Seam&#65292;&#25110;&#32773;&#22312;&#20219;&#20309;&#20320;&#24819;&#20351;&#29992;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#26102;&#65292;&#23427;&#21516;&#26679;&#24456;&#26377;&#29992;&#30340;&#12290;
    	</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6119"></a>8.2.1.&nbsp;&#20851;&#38381;Seam&#31649;&#29702;&#30340;&#20107;&#21153;</h3></div></div><div></div></div><p>
                &#25152;&#26377;&#30340;JSF&#35831;&#27714;&#40664;&#35748;&#24320;&#21551;Seam&#20107;&#21153;&#31649;&#29702;&#12290;&#22914;&#26524;&#20320;&#24819; <span class="emphasis"><em>&#20851;&#38381;</em></span> &#35813;&#21151;&#33021;&#65292;&#20320;&#33021;&#22312; <tt class="literal">components.xml</tt> &#25991;&#20214;&#20013;&#20570;&#22914;&#19979;&#35774;&#32622;&#65306;
    		</p><pre class="programlisting">&lt;core:init transaction-management-enabled="false"/&gt;

&lt;transaction:no-transaction /&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6132"></a>8.2.2.&nbsp;&#37197;&#32622;Seam&#20107;&#21153;&#31649;&#29702;&#22120;</h3></div></div><div></div></div><p>
                Seam&#20026;&#20107;&#21153;&#30340;&#24320;&#22987;&#65292;&#25552;&#20132;&#65292;&#22238;&#28378;&#65292;&#21516;&#27493;&#25552;&#20379;&#20102;&#19968;&#20010;&#20107;&#21153;&#31649;&#29702;&#25277;&#35937;&#12290;&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;Seam&#20351;&#29992;&#19968;&#20010;JTA&#20107;&#21153;&#32452;&#20214;&#65292;&#23427;&#21516;&#23481;&#22120;&#31649;&#29702;&#30340;EJB&#21644;&#32534;&#31243;&#24335;EJB&#20107;&#21153;&#38598;&#25104;&#12290;
    		</p><p>
				Seam&#36824;&#20026;&#20197;&#19979;&#20107;&#21153;API&#25552;&#20379;&#20107;&#21153;&#32452;&#20214;&#65306;
    		</p><div class="itemizedlist"><ul type="disc"><li><tt class="literal">javax.persistence.EntityTransaction</tt> &#25509;&#21475;&#25552;&#20379;&#30340;JPA RESOURCE_LOCAL&#20107;&#21153;&#12290;
    			</li><li><tt class="literal">org.hibernate.Transaction</tt> &#25509;&#21475;&#25552;&#20379;&#30340;Hibernate&#31649;&#29702;&#30340;&#20107;&#21153;&#12290;
    			</li><li><tt class="literal">org.springframework.transaction.PlatformTransactionManager</tt> &#25509;&#21475;&#25552;&#20379;&#30340;Spring&#31649;&#29702;&#30340;&#20107;&#21153;&#12290;
    			</li><li>
                    &#26174;&#24335;&#20851;&#38381;Seam&#31649;&#29702;&#30340;&#20107;&#21153;&#12290;
                </li></ul></div><p>
                &#21521;components.xml&#25991;&#20214;&#22686;&#21152;&#20197;&#19979;&#39033;&#26469;&#37197;&#32622;JPA RESOURCE_LOCAL&#20107;&#21153;&#65292;&#22312;&#37197;&#32622;&#25991;&#20214;&#20013;&#65292;<tt class="literal">#{entityManager}</tt> &#26159;
                <tt class="literal">persistence:managed-persistence-context</tt> &#32452;&#20214;&#30340;&#21517;&#31216;&#12290;&#65288;&#21442;&#32771;
                <a href="persistence.html#persistence.seam-managed-persistence-contexts" title="8.3.&nbsp;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;">Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;</a>&#12290;&#65289;
    		</p><pre class="programlisting">&lt;transaction:entity-transaction entity-manager="#{entityManager}"/&gt;</pre><p>
                &#21521;&#20320;&#30340;components.xml&#25991;&#20214;&#22768;&#26126;&#20197;&#19979;&#39033;&#26469;&#37197;&#32622;Hibernate&#31649;&#29702;&#30340;&#20107;&#21153;&#65292;&#22312;&#37197;&#32622;&#25991;&#20214;&#20013;&#65292;<tt class="literal">#{hiberanteSession}</tt> &#26159;&#39033;&#30446;&#20013;
                <tt class="literal">persistence:managed-hibernate-session</tt> &#32452;&#20214;&#30340;&#21517;&#31216;&#12290;&#65288;&#21442;&#32771;<a href="persistence.html#persistence.seam-managed-persistence-contexts" title="8.3.&nbsp;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;">Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;</a>&#65289;
    		</p><pre class="programlisting">&lt;transaction:hibernate-transaction session="#{hiberanteSession}"/&gt;</pre><p>
                &#22312;components.xml&#20013;&#22768;&#26126;&#20197;&#19979;&#20869;&#23481;&#26469;&#26174;&#24335;&#22320;&#20851;&#38381;Seam&#31649;&#29702;&#30340;&#20107;&#21153;&#65306;
            </p><pre class="programlisting">&lt;transaction:no-transaction /&gt;</pre><p>
    			&#21442;&#32771; <a href="spring.html#spring-transactions" title="23.5.&nbsp;&#20351;&#29992;Spring PlatformTransactionManagement">&#20351;&#29992;Spring PlatformTransactionManagement</a> &#26469;&#37197;&#32622;Spring&#31649;&#29702;&#30340;&#20107;&#21153;&#12290;
    		</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6189"></a>8.2.3.&nbsp;&#20107;&#21153;&#21516;&#27493;</h3></div></div><div></div></div><p>
                &#20107;&#21153;&#21516;&#27493;&#20026;&#21508;&#31181;&#21508;&#26679;&#30340;&#20107;&#21153;&#30456;&#20851;&#20107;&#20214;&#25552;&#20379;&#20102;&#22238;&#35843;&#21151;&#33021;&#65292;&#20363;&#22914; <tt class="literal">beforeCompletion()</tt> &#21644; <tt class="literal">afterCompletion()</tt> &#20107;&#20214;&#12290;
                &#40664;&#35748;&#24773;&#20917;&#19979;&#65292;Seam&#20351;&#29992;&#23427;&#33258;&#24049;&#30340;&#20107;&#21153;&#21516;&#27493;&#32452;&#20214;&#65292;&#19968;&#20010;&#20107;&#21153;&#34987;&#25552;&#20132;&#26102;&#65292;&#38656;&#35201;&#26174;&#24335;&#22320;&#20351;&#29992;Seam&#20107;&#21153;&#32452;&#20214;&#20197;&#30830;&#20445;&#21516;&#27493;&#22238;&#35843;&#34987;&#27491;&#30830;&#25191;&#34892;&#12290;
                &#22914;&#26524;&#22312;Java EE 5&#29615;&#22659;&#37324;&#65292;&#24212;&#35813;&#22312;components.xml&#25991;&#20214;&#20013;&#22768;&#26126; <tt class="literal">&lt;transaction:ejb-transaction/&gt;</tt>&#65292;&#20174;&#32780;&#20445;&#35777;&#23481;&#22120;&#22312;Seam&#30340;&#21487;&#39044;&#35265;&#33539;&#22260;&#22806;&#25552;&#20132;&#20107;&#21153;&#26102;&#65292;Seam&#21516;&#27493;&#22238;&#35843;&#34987;&#27491;&#30830;&#35843;&#29992;&#12290;
    		</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="persistence.seam-managed-persistence-contexts"></a>8.3.&nbsp;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;</h2></div></div><div></div></div><p>
            &#22914;&#26524;&#20320;&#26159;&#22312;Java EE 5&#29615;&#22659;&#22806;&#20351;&#29992;Seam&#65292;&#20320;&#19981;&#33021;&#20381;&#38752;&#23481;&#22120;&#26469;&#20026;&#20320;&#31649;&#29702;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#29983;&#21629;&#21608;&#26399;&#12290;
            &#21363;&#20351;&#22312;Java EE 5 &#29615;&#22659;&#20013;&#65292;&#20320;&#21487;&#33021;&#26377;&#19968;&#20010;&#24456;&#22810;&#26494;&#32806;&#21512;&#32452;&#20214;&#22312;&#20250;&#35805;&#20316;&#29992;&#22495;&#20869;&#30456;&#20114;&#21327;&#20316;&#30340;&#22797;&#26434;&#24212;&#29992;&#65292;&#36825;&#31181;&#24773;&#20917;&#19979;&#20320;&#21487;&#33021;&#21457;&#29616;&#22312;&#32452;&#20214;&#38388;&#20256;&#36882;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#26082;&#22256;&#38590;&#21448;&#23481;&#26131;&#20986;&#38169;&#12290;
        </p><p>
            &#22312;&#20219;&#20309;&#19968;&#31181;&#24773;&#20917;&#19979;&#65292;&#20320;&#37117;&#38656;&#35201;&#22312;&#20320;&#30340;&#32452;&#20214;&#20013;&#20351;&#29992;&#19968;&#20010; <span class="emphasis"><em>&#21463;&#31649;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;</em></span>&#65288;&#22312;JPA&#20013;&#65289;&#25110;&#32773;&#19968;&#20010;
            <span class="emphasis"><em>&#21463;&#31649;&#20250;&#35805;</em></span>&#65288;Hibernate&#20013;&#65289;&#12290;&#19968;&#20010;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#26159;&#22312;&#20250;&#35805;&#19978;&#19979;&#25991;&#20013;&#31649;&#29702;&#19968;&#20010;
            <tt class="literal">EntityManager</tt> &#23454;&#20363;&#25110;&#32773; <tt class="literal">Session</tt> &#23454;&#20363;&#30340;&#20869;&#32622;Seam&#32452;&#20214;&#12290;&#20320;&#21487;&#20197;&#20351;&#29992; <tt class="literal">@In</tt> &#27880;&#20837;&#23427;&#12290;
        </p><p>
            Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#22312;&#38598;&#32676;&#29615;&#22659;&#20013;&#23588;&#20854;&#26377;&#25928;&#12290;EJB 3.0&#35268;&#33539;&#20013;&#19981;&#20801;&#35768;&#23481;&#22120;&#20351;&#29992;&#23481;&#22120;&#31649;&#29702;&#30340;&#25193;&#23637;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#65292;Seam&#33021;&#22815;&#23545;&#27492;&#36827;&#34892;&#20248;&#21270;&#12290;
            Seam&#25903;&#25345;&#25193;&#23637;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#30340;&#36879;&#26126;&#25925;&#38556;&#24674;&#22797;&#65292;&#32780;&#26080;&#38656;&#22312;&#33410;&#28857;&#38388;&#22797;&#21046;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#29366;&#24577;&#12290;&#65288;&#25105;&#20204;&#24076;&#26395;&#22312;EJB&#35268;&#33539;&#30340;&#19979;&#20010;&#29256;&#26412;&#20013;&#20462;&#22797;&#27492;&#28431;&#27934;&#12290;&#65289;
        </p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6227"></a>8.3.1.&nbsp;&#22312;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#20013;&#20351;&#29992;JPA</h3></div></div><div></div></div><p>
            &#37197;&#32622;&#19968;&#20010;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#24456;&#31616;&#21333;&#65292;&#22312; <tt class="literal">components.xml</tt> &#20013;&#21152;&#19978;&#65306;
        </p><pre class="programlisting">&lt;persistence:managed-persistence-context name="bookingDatabase"
                                  auto-create="true"
                   persistence-unit-jndi-name="java:/EntityManagerFactories/bookingData"/&gt;</pre><p>
            &#36825;&#20010;&#37197;&#32622;&#21019;&#24314;&#20102;&#19968;&#20010;&#21517;&#20026; <tt class="literal">bookingDatabase</tt> &#30340;&#23545;&#35805;&#20316;&#29992;&#33539;&#22260;Seam&#32452;&#20214;&#65292;&#23427;&#31649;&#29702;&#32473;&#25345;&#20037;&#21270;&#21333;&#20803;&#65288;<tt class="literal">EntityManagerFactory</tt> &#23454;&#20363;&#65289;&#20351;&#29992;&#30340; <tt class="literal">EntityManager</tt> &#23454;&#20363;&#30340;&#29983;&#21629;&#21608;&#26399;&#12290;
            &#20854;JNDI&#21517;&#20026; <tt class="literal">java:/EntityManagerFactories/bookingData</tt>&#12290;
        </p><p>
            &#24403;&#28982;&#65292;&#20320;&#38656;&#35201;&#30830;&#35748;&#24050;&#32463;&#22312;JNDI&#20013;&#32465;&#23450;&#20102; <tt class="literal">EntityManagerFactory</tt>&#12290;
            &#22312;JBoss&#20013;&#65292;&#20320;&#33021;&#22312; <tt class="literal">persistence.xml</tt> &#20013;&#36890;&#36807;&#22686;&#21152;&#20197;&#19979;&#23646;&#24615;&#35774;&#32622;&#26469;&#32465;&#23450;&#23427;&#12290;
        </p><pre class="programlisting">&lt;property name="jboss.entity.manager.factory.jndi.name"
          value="java:/EntityManagerFactories/bookingData"/&gt;</pre><p>
            &#29616;&#22312;&#25105;&#20204;&#33021;&#29992;&#20197;&#19979;&#26041;&#24335;&#26469;&#27880;&#20837; <tt class="literal">EntityManager</tt> &#20102;&#65306;
        </p><pre class="programlisting">@In EntityManager bookingDatabase;</pre><p>
        	&#22914;&#26524;&#20320;&#27491;&#22312;&#20351;&#29992;EJB3&#65292;&#24182;&#19988;&#20320;&#30340;&#31867;&#25110;&#32773;&#26041;&#27861;&#19978;&#21152;&#20102; <tt class="literal">@TransactionAttribute(REQUIRES_NEW)</tt>&#65292;&#37027;&#20040;&#20107;&#21153;&#21644;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#19981;&#24212;&#35813;&#34987;&#20256;&#25773;&#21040;&#36825;&#20010;&#23545;&#35937;&#30340;&#26041;&#27861;&#35843;&#29992;&#19978;&#12290;
        	&#20294;&#26159;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#20250;&#34987;&#20256;&#25773;&#21040;&#20250;&#35805;&#20869;&#30340;&#25152;&#26377;&#32452;&#20214;&#19978;&#65292;&#23427;&#20063;&#20250;&#34987;&#20256;&#25773;&#21040;&#26631;&#26377;<tt class="literal">REQUIRES_NEW</tt>&#30340;&#26041;&#27861;&#19978;&#12290;
        	&#22240;&#27492;&#65292;&#22914;&#26524;&#20320;&#26631;&#35760;&#20102;&#19968;&#20010;<tt class="literal">REQUIRES_NEW</tt>&#26041;&#27861;&#65292;&#37027;&#20040;&#23601;&#24212;&#35813;&#29992;@PersistenceContext&#26469;&#35775;&#38382;&#23454;&#20307;&#31649;&#29702;&#22120;&#12290;
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6279"></a>8.3.2.&nbsp;&#20351;&#29992;Seam&#31649;&#29702;&#30340;Hibernate&#20250;&#35805;</h3></div></div><div></div></div><p>
            Seam&#31649;&#29702;&#30340;Hibernate sessions&#21644;&#21069;&#32773;&#24456;&#30456;&#20284;&#12290;&#22312; <tt class="literal">components.xml</tt> &#20013;&#21152;&#20837;&#22914;&#19979;&#20869;&#23481;&#65306;
        </p><pre class="programlisting">&lt;persistence:hibernate-session-factory name="hibernateSessionFactory"/&gt;

&lt;persistence:managed-hibernate-session name="bookingDatabase"
                                auto-create="true"
                  session-factory-jndi-name="java:/bookingSessionFactory"/&gt;</pre><p>
            <tt class="literal">java:/bookingSessionFactory</tt> &#26159;&#22312; <tt class="literal">hibernate.cfg.xml</tt> &#20013;&#37197;&#32622;&#30340;&#20250;&#35805;&#24037;&#21378;&#21517;&#12290;
        </p><pre class="programlisting">&lt;session-factory name="java:/bookingSessionFactory"&gt;
    &lt;property name="transaction.flush_before_completion"&gt;true&lt;/property&gt;
    &lt;property name="connection.release_mode"&gt;after_statement&lt;/property&gt;
    &lt;property name="transaction.manager_lookup_class"&gt;org.hibernate.transaction.JBossTransactionManagerLookup&lt;/property&gt;
    &lt;property name="transaction.factory_class"&gt;org.hibernate.transaction.JTATransactionFactory&lt;/property&gt;
    &lt;property name="connection.datasource"&gt;java:/bookingDatasource&lt;/property&gt;
    ...
&lt;/session-factory&gt;</pre><p>
            &#27880;&#24847;&#65306;Seam&#24182;&#27809;&#26377;&#28165;&#31354;&#27492;&#20250;&#35805;&#65292;&#25152;&#20197;&#20320;&#24212;&#21551;&#29992; <tt class="literal">hibernate.transaction.flush_before_completion</tt>&#65292;&#30830;&#20445;&#22312;JTA&#20107;&#21153;&#25552;&#20132;&#21069;&#20250;&#35805;&#34987;&#33258;&#21160;&#22320;&#28165;&#31354;&#32531;&#23384;&#12290;
        </p><p>
            &#29616;&#22312;&#25105;&#20204;&#21487;&#20197;&#29992;&#20197;&#19979;&#20195;&#30721;&#21521;JavaBean&#32452;&#20214;&#20013;&#27880;&#20837;&#19968;&#20010;&#21463;&#31649;Hibernate <tt class="literal">Session</tt>&#20102;&#65306;
        </p><pre class="programlisting">@In Session bookingDatabase;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e6311"></a>8.3.3.&nbsp;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#21644;&#21407;&#23376;&#20250;&#35805;</h3></div></div><div></div></div><p>
            &#20250;&#35805;&#26399;&#38388;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#35753;&#20320;&#33021;&#32534;&#20889;&#36328;&#36234;&#22810;&#20010;&#26381;&#21153;&#22120;&#35831;&#27714;&#30340;&#20048;&#35266;&#20107;&#21153;&#65292;&#32780;&#19988;&#26080;&#38656;&#20351;&#29992;<tt class="literal">merge()</tt>&#25805;&#20316;&#65292;&#20063;&#19981;&#38656;&#35201;&#22312;&#27599;&#27425;&#35831;&#27714;&#24320;&#22987;&#26102;&#37325;&#36733;&#25968;&#25454;&#65292;&#20063;&#19981;&#38656;&#35201;&#22788;&#29702; <tt class="literal">LazyInitializationException</tt> &#24322;&#24120;&#25110; <tt class="literal">NonUniqueObjectException</tt> &#24322;&#24120;&#12290;
        </p><p>
            &#23545;&#20219;&#20309;&#20048;&#35266;&#20107;&#21153;&#31649;&#29702;&#26469;&#35828;&#65292;&#20107;&#21153;&#38548;&#31163;&#24615;&#21644;&#19968;&#33268;&#24615;&#21487;&#20197;&#20351;&#29992;&#20048;&#35266;&#38145;&#26469;&#33719;&#24471;&#12290;
            &#24184;&#36816;&#30340;&#26159;&#65292;Hibernate&#21644;EJB 3.0&#37117;&#36890;&#36807;&#20351;&#29992; <tt class="literal">@Version</tt> &#27880;&#35299;&#26469;&#20351;&#29992;&#20048;&#35266;&#38145;&#12290;
        </p><p>
            &#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#22312;&#27599;&#20010;&#20107;&#21153;&#32467;&#26463;&#26102;&#20250;&#28165;&#31354;&#32531;&#23384;&#65288;&#19982;&#25968;&#25454;&#24211;&#21516;&#27493;&#65289;&#12290;&#26377;&#26102;&#36825;&#26159;&#25105;&#20204;&#26399;&#26395;&#30340;&#26041;&#24335;&#12290;
            &#20294;&#32463;&#24120;&#25105;&#20204;&#24076;&#26395;&#25152;&#26377;&#30340;&#25913;&#21464;&#22312;&#20869;&#23384;&#20013;&#20445;&#23384;&#65292;&#19988;&#21482;&#26377;&#22312;&#20250;&#35805;&#25104;&#21151;&#32467;&#26463;&#26102;&#20889;&#22238;&#25968;&#25454;&#24211;&#12290;&#36825;&#23545;&#20110;&#27491;&#30495;&#30340;&#21407;&#23376;&#20250;&#35805;&#26469;&#35828;&#26159;&#20801;&#35768;&#30340;&#12290;
            &#20316;&#20026;&#38750;JBoss&#65292;&#38750;Sun&#65292;&#38750;Sybase&#30340;EJB 3.0&#19987;&#23478;&#32452;&#25104;&#21592;&#30340;&#24858;&#34850;&#21644;&#30701;&#35270;&#20915;&#31574;&#30340;&#32467;&#26524;&#65292;&#20351;&#29992;EJB 3.0&#25345;&#20037;&#21270;&#36824;&#19981;&#33021;&#31616;&#21333;&#12289;&#26377;&#25928;&#21644;&#26041;&#20415;&#30340;&#23454;&#29616;&#21407;&#23376;&#20250;&#35805;&#12290;
            &#20294;&#26159;Hibernate&#36890;&#36807;&#25193;&#23637;&#35268;&#33539;&#23450;&#20041;&#30340; <tt class="literal">FlushModeType</tt> &#25552;&#20379;&#20102;&#36825;&#20010;&#21151;&#33021;&#65292;&#25105;&#20204;&#20063;&#26399;&#26395;&#20854;&#23427;&#30340;&#21378;&#21830;&#33021;&#23613;&#24555;&#25552;&#20379;&#31867;&#20284;&#25193;&#23637;&#12290;
        </p><p>
            Seam&#20801;&#35768;&#20320;&#22312;&#24320;&#22987;&#20250;&#35805;&#26102;&#25351;&#23450;<tt class="literal">FlushModeType.MANUAL</tt>&#21442;&#25968;&#12290;
            &#30446;&#21069;&#65292;&#21482;&#26377;Hibernate&#20316;&#20026;&#25345;&#20037;&#21270;&#24213;&#23618;&#25552;&#20379;&#32773;&#26102;&#23427;&#25165;&#33021;&#27491;&#24120;&#24037;&#20316;&#65292;&#20294;&#26159;&#25105;&#20204;&#35745;&#21010;&#25903;&#25345;&#20854;&#23427;&#21516;&#31867;&#35745;&#31639;&#26426;&#21378;&#21830;&#25193;&#23637;&#12290;
        </p><pre class="programlisting">@In EntityManager em; //a Seam-managed persistence context

@Begin(flushMode=MANUAL)
public void beginClaimWizard() {
    claim = em.find(Claim.class, claimId);
}</pre><p>
            &#29616;&#22312; <tt class="literal">claim</tt> &#23545;&#35937;&#20173;&#28982;&#22312;&#20854;&#20313;&#20250;&#35805;&#20013;&#34987;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#31649;&#29702;&#12290;&#25105;&#20204;&#33021;&#23545;&#27492;claim&#36827;&#34892;&#19968;&#20123;&#20462;&#25913;&#65306;
        </p><pre class="programlisting">public void addPartyToClaim() {
    Party party = ....;
    claim.addParty(party);
}</pre><p>
            &#38500;&#38750;&#25105;&#20204;&#36827;&#34892;&#26174;&#24335;&#30340;&#24378;&#21046;&#25552;&#20132;&#65292;&#21542;&#21017;&#36825;&#20123;&#25913;&#21464;&#19981;&#20250;&#34987;&#20889;&#21040;&#25968;&#25454;&#24211;&#20013;&#12290;
        </p><pre class="programlisting">@End
public void commitClaim() {
    em.flush();
}</pre><p>
            &#24403;&#28982;&#20320;&#21487;&#20197;&#22312;pages.xml&#25991;&#20214;&#20013;&#23558; <tt class="literal">flushMode</tt> &#20540;&#35774;&#32622;&#20026; <tt class="literal">MANUAL</tt>&#65292;&#20363;&#22914;&#22312;&#19968;&#20010;&#23548;&#33322;&#35268;&#21017;&#20013;&#20889;&#20837;&#65306;
        </p><pre class="programlisting">&lt;begin-conversation flush-mode="MANUAL" /&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6363"></a>8.4.&nbsp;&#20351;&#29992;JPA &#8220;&#20195;&#29702;&#65288;delegate&#65289;&#8221;</h2></div></div><div></div></div><p>
            <tt class="literal">EntityManager</tt> &#25509;&#21475;&#33021;&#35753;&#20320;&#36890;&#36807;&#20351;&#29992; <tt class="literal">getDelegate()</tt> &#26041;&#27861;&#35775;&#38382;&#26576;&#20010;&#21378;&#21830;&#29305;&#23450;&#30340;API&#12290;
            &#24456;&#33258;&#28982;&#22320;&#65292;&#26368;&#35753;&#20154;&#24863;&#20852;&#36259;&#30340;&#21378;&#21830;&#26159;Hibernate&#65292;&#20854;&#26368;&#24378;&#22823;&#30340;&#20195;&#29702;&#25509;&#21475;&#26159; <tt class="literal">org.hibernate.Session</tt>&#12290;
            &#20320;&#19981;&#24517;&#20877;&#29992;&#21035;&#30340;&#19996;&#35199;&#65292;&#30456;&#20449;&#25105;&#65292;&#25105;&#27809;&#26377;&#20219;&#20309;&#20559;&#35265;&#12290;
        </p><p>
            &#19981;&#31649;&#20320;&#20351;&#29992;Hibernate&#65288;&#26126;&#26234;&#65281;&#65289;&#36824;&#26159;&#20854;&#20182;&#30340;&#19996;&#35199;&#65288;&#21463;&#34384;&#29378;&#65292;&#25110;&#32773;&#35828;&#19981;&#22826;&#32874;&#26126;&#65289;&#65292;&#20320;&#24403;&#28982;&#24819;&#22312;&#20320;&#30340;Seam&#32452;&#20214;&#20013;&#32463;&#24120;&#20351;&#29992;&#20195;&#29702;&#12290;&#19979;&#38754;&#26159;&#19968;&#20010;&#26041;&#27861;&#65306;
        </p><pre class="programlisting">@In EntityManager entityManager;

@Create
public void init() {
    ( (Session) entityManager.getDelegate() ).enableFilter("currentVersions");
}</pre><p>
             &#20294;&#31867;&#22411;&#36716;&#21270;&#27627;&#26080;&#30097;&#38382;&#26159;Java&#35821;&#35328;&#20013;&#26368;&#38590;&#30475;&#30340;&#35821;&#27861;&#12290;&#22240;&#27492;&#22823;&#23478;&#37117;&#24212;&#23613;&#21487;&#33021;&#36991;&#20813;&#20351;&#29992;&#23427;&#20204;&#12290;&#36825;&#26377;&#21478;&#19968;&#20010;&#33719;&#24471;&#20195;&#29702;&#30340;&#26041;&#27861;&#12290;
             &#39318;&#20808;&#23558;&#19979;&#21015;&#35821;&#21477;&#21152;&#21040; <tt class="literal">components.xml</tt> &#25991;&#20214;&#20013;&#65306;
        </p><pre class="programlisting">&lt;factory name="session"
         scope="STATELESS"
         auto-create="true"
         value="#{entityManager.delegate}"/&gt;</pre><p>
            &#29616;&#22312;&#25105;&#20204;&#21487;&#20197;&#30452;&#25509;&#27880;&#20837;&#27492;&#20250;&#35805;&#65306;
        </p><pre class="programlisting">@In Session session;

@Create
public void init() {
    session.enableFilter("currentVersions");
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6392"></a>8.5.&nbsp;&#22312;EJB-QL/HQL&#20013;&#20351;&#29992;EL</h2></div></div><div></div></div><p>
            &#26080;&#35770;&#20320;&#20351;&#29992;&#19968;&#20010;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#36824;&#26159;&#29992; <tt class="literal">@PersistenceContext</tt> &#27880;&#20837;&#19968;&#20010;&#23481;&#22120;&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#12290;
            Seam&#37117;&#20195;&#29702; <tt class="literal">EntityManager</tt> &#25110;&#32773; <tt class="literal">Session</tt> &#23545;&#35937;&#65292;&#36825;&#20351;&#20320;&#33021;&#22312;&#26597;&#35810;&#35821;&#21477;&#20013;&#23433;&#20840;&#26377;&#25928;&#22320;&#20351;&#29992;EL&#34920;&#36798;&#24335;&#12290;&#20363;&#22914;&#36825;&#20010;&#20363;&#23376;&#65306;
        </p><pre class="programlisting">User user = em.createQuery("from User where username=#{user.username}")
         .getSingleResult();</pre><p>&#21644;&#19979;&#38754;&#31561;&#20215;&#65306;</p><pre class="programlisting">User user = em.createQuery("from User where username=:username")
         .setParameter("username", user.getUsername())
         .getSingleResult();</pre><p>
            &#24403;&#28982;&#20320;&#19981;&#35201;&#20889;&#25104;&#19979;&#38754;&#36825;&#26679;&#65306;
        </p><pre class="programlisting">User user = em.createQuery("from User where username=" + user.getUsername()) //BAD!
         .getSingleResult();</pre><p>
            &#65288;&#36825;&#22312;&#36973;&#21463;SQL&#27880;&#20837;&#25915;&#20987;&#26102;&#20250;&#21464;&#24471;&#20302;&#25928;&#19988;&#19981;&#22570;&#19968;&#20987;&#12290;&#65289;
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6418"></a>8.6.&nbsp;&#20351;&#29992;Hibernate&#36807;&#28388;&#22120;</h2></div></div><div></div></div><p>
            Hibernate&#26368;&#37239;&#26368;&#29420;&#29305;&#30340;&#21151;&#33021;&#23601;&#26159; <span class="emphasis"><em>&#36807;&#28388;&#22120;&#65288;filter&#65289;</em></span>&#12290;&#36807;&#28388;&#22120;&#33021;&#35753;&#20320;&#25552;&#20379;&#19968;&#20010;&#25968;&#25454;&#24211;&#20013;&#25968;&#25454;&#30340;&#21463;&#38480;&#35270;&#22270;&#12290;
            &#20294;&#26159;&#24212;&#35813;&#26377;&#19968;&#20010;&#23558;&#36807;&#28388;&#22120;&#21512;&#24182;&#21040;Seam&#24212;&#29992;&#20013;&#30340;&#31616;&#20415;&#26041;&#27861;&#65292;&#35753;&#23427;&#21644;Seam&#24212;&#29992;&#26694;&#26550;&#33021;&#24037;&#20316;&#24471;&#24456;&#22909;&#12290;
        </p><p>
            Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#21487;&#20197;&#23450;&#20041;&#19968;&#31995;&#21015;&#30340;&#36807;&#28388;&#22120;&#65292;&#36825;&#20123;&#36807;&#28388;&#22120;&#22312;&#19968;&#20010; <tt class="literal">EntityManager</tt> &#25110;&#32773; Hibernate <tt class="literal">Session</tt> &#34987;&#21019;&#24314;&#26102;&#21551;&#29992;&#12290;&#65288;&#24403;&#28982;&#65292;&#23427;&#20204;&#21482;&#33021;&#22312;Hibernate&#20570;&#25345;&#20037;&#21270;&#24213;&#23618;&#26102;&#20351;&#29992;&#65289;
        </p><pre class="programlisting">&lt;persistence:filter name="regionFilter"&gt;
    &lt;persistence:name&gt;region&lt;/persistence:name&gt;
    &lt;persistence:parameters&gt;
        &lt;key&gt;regionCode&lt;/key&gt;
        &lt;value&gt;#{region.code}&lt;/value&gt;
    &lt;/persistence:parameters&gt;
&lt;/persistence:filter&gt;

&lt;persistence:filter name="currentFilter"&gt;
    &lt;persistence:name&gt;current&lt;/persistence:name&gt;
    &lt;persistence:parameters&gt;
        &lt;key&gt;date&lt;/key&gt;
        &lt;value&gt;#{currentDate}&lt;/value&gt;
    &lt;/persistence:parameters&gt;
&lt;/persistence:filter&gt;

&lt;persistence:managed-persistence-context name="personDatabase"
    persistence-unit-jndi-name="java:/EntityManagerFactories/personDatabase"&gt;
    &lt;core:filters&gt;
        &lt;value&gt;#{regionFilter}&lt;/value&gt;
        &lt;value&gt;#{currentFilter}&lt;/value&gt;
    &lt;/core:filters&gt;
&lt;/persistence:managed-persistence-context&gt;</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="jbpm.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="validation.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;7.&nbsp;&#39029;&#38754;&#27969;&#21644;&#19994;&#21153;&#27969;&#31243;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;9.&nbsp;Seam&#20013;&#30340;JSF&#34920;&#21333;&#39564;&#35777;</td></tr></table></div></body></html>