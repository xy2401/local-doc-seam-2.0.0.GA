<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;12.&nbsp;Seam&#21644;JBoss&#35268;&#21017;</title><link rel="stylesheet" href="../shared/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Seam - &#35821;&#22659;&#30456;&#20851;&#30340;&#32452;&#20214; [&#28385;&#27743;&#32418;20080327]"><link rel="up" href="index.html" title="Seam - &#35821;&#22659;&#30456;&#20851;&#30340;&#32452;&#20214; [&#28385;&#27743;&#32418;20080327]"><link rel="previous" href="framework.html" title="Chapter&nbsp;11.&nbsp;Seam&#24212;&#29992;&#31243;&#24207;&#26694;&#26550;"><link rel="next" href="security.html" title="Chapter&nbsp;13.&nbsp;&#23433;&#20840;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;12.&nbsp;Seam&#21644;JBoss&#35268;&#21017;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="framework.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="security.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="drools"></a>Chapter&nbsp;12.&nbsp;Seam&#21644;JBoss&#35268;&#21017;</h2></div></div><div></div></div><p>
        Seam&#31616;&#21270;&#20102;&#22312;Seam&#32452;&#20214;&#25110;jBPM&#36807;&#31243;&#23450;&#20041;&#20013;&#23545;JBoss Rules&#65288;Drools&#65289;&#35268;&#21017;&#24211;&#30340;&#35843;&#29992;&#12290;
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6981"></a>12.1.&nbsp;&#23433;&#35013;&#35268;&#21017;</h2></div></div><div></div></div><p>
            &#31532;&#19968;&#27493;&#26159;&#20351;&#19968;&#20010; <tt class="literal">org.drools.RuleBase</tt> &#30340;&#23454;&#20363;&#22312;Seam&#30340;&#19978;&#19979;&#25991;&#21464;&#37327;&#20013;&#21487;&#29992;&#12290;
            &#22522;&#20110;&#27979;&#35797;&#30446;&#30340;&#65292;Seam&#25552;&#20379;&#20102;&#19968;&#20010;&#20869;&#32622;&#32452;&#20214;&#29992;&#26469;&#32534;&#35793;&#26469;&#33258;class&#25628;&#32034;&#36335;&#24452;&#30340;&#19968;&#32452;&#38745;&#24577;&#35268;&#21017;&#12290;&#20320;&#21487;&#20197;&#36890;&#36807; <tt class="literal">components.xml</tt> &#25991;&#20214;&#23433;&#35013;&#27492;&#32452;&#20214;:
        </p><pre class="programlisting">&lt;drools:rule-base name="policyPricingRules"&gt;
    &lt;drools:rule-files&gt;
        &lt;value&gt;policyPricingRules&lt;/value&gt;
    &lt;/drools:rule-files&gt;
&lt;/drools:rule-base&gt;</pre><p>
             &#36825;&#20010;&#32452;&#20214;&#32534;&#35793;&#26469;&#33258;&#19968;&#32452; <tt class="literal">.drl</tt> &#25991;&#20214;&#20013;&#30340;&#35268;&#21017;&#24182;&#22312;Seam&#30340; <tt class="literal">APPLICATION</tt> &#19978;&#19979;&#25991; &#20013;&#32531;&#23384;&#19968;&#20010; <tt class="literal">org.drools.RuleBase</tt> &#23454;&#20363;&#12290;&#38656;&#35201;&#27880;&#24847;&#30340;&#26159;&#36825;&#21644;&#22312;&#35268;&#21017;&#39537;&#21160;&#30340;&#24212;&#29992;&#31243;&#24207;&#20013;&#38656;&#35201;&#23433;&#35013;&#22810;&#20010;&#35268;&#21017;&#24211;&#24456;&#30456;&#20284;&#12290;
         </p><p>
             &#22914;&#26524;&#20320;&#24819;&#35201;&#20351;&#29992;Drools DSL&#65292;&#20320;&#36824;&#38656;&#35201;&#25351;&#23450;DSL&#23450;&#20041;&#65306;
         </p><pre class="programlisting">&lt;drools:rule-base name="policyPricingRules" dsl-file="policyPricing.dsl"&gt;
    &lt;drools:rule-files&gt;
        &lt;value&gt;policyPricingRules&lt;/value&gt;
    &lt;/drools:rule-files&gt;
&lt;/drools:rule-base&gt;</pre><p>
          &#22312;&#22823;&#22810;&#25968;&#35268;&#21017;&#39537;&#21160;&#30340;&#24212;&#29992;&#31243;&#24207;&#20013;&#65292;&#35268;&#21017;&#38656;&#35201;&#26159;&#21487;&#34987;&#21160;&#24577;&#37096;&#32626;&#30340;&#65292;&#25152;&#20197;&#19968;&#20010;&#29983;&#20135;&#29615;&#22659;&#24212;&#29992;&#31243;&#24207;&#20250;&#38656;&#35201;&#29992;Drools&#35268;&#21017;&#20195;&#29702;&#26469;&#31649;&#29702;&#35268;&#21017;&#24211;&#12290;
          &#35268;&#21017;&#20195;&#29702;&#21487;&#20197;&#36830;&#25509;&#19968;&#20010;Drools&#35268;&#21017;&#26381;&#21153;&#22120;&#65288;BRMS&#65289;&#25110;&#32773;&#28909;&#37096;&#32626;&#26469;&#33258;&#26412;&#22320;&#25991;&#20214;&#20179;&#24211;&#30340;&#35268;&#21017;&#21253;&#12290;&#35268;&#21017;&#20195;&#29702;&#31649;&#29702;&#30340;&#35268;&#21017;&#24211;&#20063;&#22312; <tt class="literal">components.xml</tt> &#20013;&#37197;&#32622;:
        </p><pre class="programlisting">&lt;drools:rule-agent name="insuranceRules"
                    configurationFile="/WEB-INF/deployedrules.properties" /&gt;</pre><p>
        &#23646;&#24615;&#25991;&#20214;&#21253;&#21547;&#26377;&#35268;&#21017;&#20195;&#29702;RulesAgent&#25152;&#29305;&#26377;&#30340;&#23646;&#24615;&#12290;&#36825;&#37324;&#26159;&#19968;&#20010;&#26469;&#33258;Drools&#33539;&#20363;&#21457;&#22411;&#20013;&#30340;&#37197;&#32622;&#25991;&#20214;&#20363;&#23376;&#12290;
        </p><pre class="programlisting">newInstance=true
url=http://localhost:8080/drools-jbrms/org.drools.brms.JBRMS/package/org.acme.insurance/fmeyer
localCacheDir=/Users/fernandomeyer/projects/jbossrules/drools-examples/drools-examples-brms/cache
poll=30
name=insuranceconfig</pre><p>&#32469;&#36807;&#37197;&#32622;&#25991;&#20214;&#65292;&#30452;&#25509;&#37197;&#32622;&#32452;&#20214;&#30340;&#36873;&#39033;&#20063;&#26159;&#21487;&#34892;&#30340;&#12290;</p><pre class="programlisting">&lt;drools:rule-agent name="insuranceRules"
                   url="http://localhost:8080/drools-jbrms/org.drools.brms.JBRMS/package/org.acme.insurance/fmeyer"
                   local-cache-dir="/Users/fernandomeyer/projects/jbossrules/drools-examples/drools-examples-brms/cache"
                   poll="30"
                   configuration-name="insuranceconfig" /&gt;</pre><p>
             &#25509;&#19979;&#26469;&#65292;&#25105;&#20204;&#38656;&#35201;&#20351; <tt class="literal">org.drools.WorkingMemory</tt> &#23454;&#20363;&#23545;&#27599;&#20010;&#23545;&#35805;&#37117;&#21487;&#29992;&#12290;
             &#65288;&#27599;&#20010; <tt class="literal">WorkingMemory</tt> &#32047;&#31215;&#19982;&#24403;&#21069;&#23545;&#35805;&#30456;&#20851;&#30340;fact&#12290;&#65289;
         </p><pre class="programlisting">&lt;drools:managed-working-memory name="policyPricingWorkingMemory" auto-create="true" rule-base="#{policyPricingRules}"/&gt;</pre><p>
             &#35831;&#27880;&#24847;&#65292;&#25105;&#20204;&#36890;&#36807; <tt class="literal">ruleBase</tt> &#37197;&#32622;&#23646;&#24615;&#32473;&#20102; <tt class="literal">policyPricingWorkingMemory</tt> &#19968;&#20010;&#25351;&#22238;&#35268;&#21017;&#24211;&#30340;&#24341;&#29992;&#12290;
         </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7042"></a>12.2.&nbsp;&#22312;Seam&#32452;&#20214;&#20013;&#20351;&#29992;&#35268;&#21017;</h2></div></div><div></div></div><p>
             &#29616;&#22312;&#21487;&#20197;&#23558;&#25105;&#20204;&#30340; <tt class="literal">WorkingMemory</tt> &#27880;&#20837;&#36827;&#20219;&#24847;&#30340;Seam&#32452;&#20214;&#20013;&#20102;&#65292;&#36827;&#34892;&#21028;&#26029;&#24182;&#25191;&#34892;&#35268;&#21017;&#65306;
         </p><pre class="programlisting">@In WorkingMemory policyPricingWorkingMemory;

@In Policy policy;
@In Customer customer;

public void pricePolicy() throws FactException
{
    policyPricingWorkingMemory.assertObject(policy);
    policyPricingWorkingMemory.assertObject(customer);
    policyPricingWorkingMemory.fireAllRules();
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7052"></a>12.3.&nbsp;&#22312;jBPM&#27969;&#31243;&#23450;&#20041;&#20013;&#20351;&#29992;&#35268;&#21017;</h2></div></div><div></div></div><p>
             &#20320;&#29978;&#33267;&#21487;&#20197;&#29992;&#19968;&#20010;&#35268;&#21017;&#24211;&#26469;&#20805;&#24403;jBPM&#21160;&#20316;&#22788;&#29702;&#22120;&#12289;&#20915;&#23450;&#22788;&#29702;&#22120;&#25110;&#32773;&#20998;&#37197;&#22120;&#8212;&#26080;&#35770;&#26159;&#22312;&#39029;&#38754;&#27969;&#25110;&#32773;&#19994;&#21153;&#27969;&#31243;&#23450;&#20041;&#20013;&#12290;
         </p><pre class="programlisting">&lt;decision name="approval"&gt;

    &lt;handler class="org.jboss.seam.drools.DroolsDecisionHandler"&gt;
        &lt;workingMemoryName&gt;orderApprovalRulesWorkingMemory&lt;/workingMemoryName&gt;
        &lt;assertObjects&gt;
            &lt;element&gt;#{customer}&lt;/element&gt;
            &lt;element&gt;#{order}&lt;/element&gt;
            &lt;element&gt;#{order.lineItems}&lt;/element&gt;
        &lt;/assertObjects&gt;
    &lt;/handler&gt;

    &lt;transition name="approved" to="ship"&gt;
        &lt;action class="org.jboss.seam.drools.DroolsActionHandler"&gt;
            &lt;workingMemoryName&gt;shippingRulesWorkingMemory&lt;/workingMemoryName&gt;
            &lt;assertObjects&gt;
                &lt;element&gt;#{customer}&lt;/element&gt;
                &lt;element&gt;#{order}&lt;/element&gt;
                &lt;element&gt;#{order.lineItems}&lt;/element&gt;
            &lt;/assertObjects&gt;
        &lt;/action&gt;
    &lt;/transition&gt;

    &lt;transition name="rejected" to="cancelled"/&gt;

&lt;/decision&gt;</pre><p>
             <tt class="literal">&lt;assertObjects&gt;</tt> &#20803;&#32032;&#25351;&#23450;&#20102;&#29992;&#26469;&#36820;&#22238;&#35201;&#34987;&#20316;&#20026;fact&#35774;&#32473; <tt class="literal">WorkingMemory</tt> &#30340;&#23545;&#35937;&#25110;&#32773;&#23545;&#35937;&#38598;&#21512;&#30340;EL&#34920;&#36798;&#24335;&#12290;
         </p><p>
             &#38500;&#27492;&#20043;&#22806;&#65292;Seam&#36824;&#25903;&#25345;&#22312;jBPM&#20219;&#21153;&#20998;&#37197;&#20013;&#20351;&#29992;Drools&#65306;
         </p><pre class="programlisting">&lt;task-node name="review"&gt;
    &lt;task name="review" description="Review Order"&gt;
        &lt;assignment handler="org.jboss.seam.drools.DroolsAssignmentHandler"&gt;
            &lt;workingMemoryName&gt;orderApprovalRulesWorkingMemory&lt;/workingMemoryName&gt;
            &lt;assertObjects&gt;
                &lt;element&gt;#{actor}&lt;/element&gt;
                &lt;element&gt;#{customer}&lt;/element&gt;
                &lt;element&gt;#{order}&lt;/element&gt;
                &lt;element&gt;#{order.lineItems}&lt;/element&gt;
            &lt;/assertObjects&gt;
        &lt;/assignment&gt;
    &lt;/task&gt;
    &lt;transition name="rejected" to="cancelled"/&gt;
    &lt;transition name="approved" to="approved"/&gt;
&lt;/task-node&gt;</pre><p>
             &#36825;&#20123;&#23545;&#35937;&#20316;&#20026;Drools global&#25552;&#20379;&#32473;&#35268;&#21017;&#65292;&#21363;jBPM <tt class="literal">Assignable</tt> &#23545;&#35937;&#65288;<tt class="literal">assignable</tt>&#65289;&#21644;Seam <tt class="literal">Decision</tt>&#23545;&#35937;&#65288;<tt class="literal">decision</tt>&#65289;&#12290;
             &#22788;&#29702;&#20915;&#23450;&#30340;&#35268;&#21017;&#24212;&#35813;&#35843;&#29992; <tt class="literal">decision.setOutcome("result")</tt> &#26469;&#20915;&#23450;&#32467;&#26524;&#12290;&#25191;&#34892;&#20998;&#37197;&#30340;&#35268;&#21017;&#35201;&#35843;&#29992; <tt class="literal">Assignable</tt> &#35774;&#32622;&#21442;&#19982;&#32773;id&#12290;
         </p><pre class="programlisting">package org.jboss.seam.examples.shop

import org.jboss.seam.drools.Decision

global Decision decision

rule "Approve Order For Loyal Customer"
  when
    Customer( loyaltyStatus == "GOLD" )
    Order( totalAmount &lt;= 10000 )
  then
    decision.setOutcome("approved");
end</pre><pre class="programlisting">package org.jboss.seam.examples.shop

import org.jbpm.taskmgmt.exe.Assignable

global Assignable assignable

rule "Assign Review For Small Order"
  when
    Order( totalAmount &lt;= 100 )
  then
    assignable.setPooledActors( new String[] {"reviewers"} );
end</pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="framework.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="security.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;11.&nbsp;Seam&#24212;&#29992;&#31243;&#24207;&#26694;&#26550;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;13.&nbsp;&#23433;&#20840;</td></tr></table></div></body></html>