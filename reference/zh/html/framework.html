<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;11.&nbsp;Seam&#24212;&#29992;&#31243;&#24207;&#26694;&#26550;</title><link rel="stylesheet" href="../shared/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Seam - &#35821;&#22659;&#30456;&#20851;&#30340;&#32452;&#20214; [&#28385;&#27743;&#32418;20080327]"><link rel="up" href="index.html" title="Seam - &#35821;&#22659;&#30456;&#20851;&#30340;&#32452;&#20214; [&#28385;&#27743;&#32418;20080327]"><link rel="previous" href="groovy.html" title="Chapter&nbsp;10.&nbsp;Groovy&#38598;&#25104;"><link rel="next" href="drools.html" title="Chapter&nbsp;12.&nbsp;Seam&#21644;JBoss&#35268;&#21017;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;11.&nbsp;Seam&#24212;&#29992;&#31243;&#24207;&#26694;&#26550;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="groovy.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="drools.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="framework"></a>Chapter&nbsp;11.&nbsp;Seam&#24212;&#29992;&#31243;&#24207;&#26694;&#26550;</h2></div></div><div></div></div><p>
        Seam&#36890;&#36807;&#32534;&#20889;&#24102;&#26377;&#27880;&#35299;&#30340;&#31616;&#21333;Java&#31867;&#26469;&#35753;&#21019;&#24314;&#24212;&#29992;&#31243;&#24207;&#30340;&#24037;&#20316;&#21464;&#24471;&#38750;&#24120;&#31616;&#21333;&#65292;&#19981;&#38656;&#25193;&#23637;&#20219;&#20309;&#29305;&#23450;&#25509;&#21475;&#21644;&#29238;&#31867;&#12290;&#20294;&#24120;&#35265;&#30340;&#32534;&#31243;&#20219;&#21153;&#36824;&#33021;&#36827;&#19968;&#27493;&#31616;&#21270;&#65292;&#36825;&#26159;&#36890;&#36807;&#19968;&#32452;&#39044;&#20808;&#21019;&#24314;&#30340;&#32452;&#20214;&#36827;&#34892;&#30340;&#65292;&#23427;&#20204;&#33021;&#22815;&#30001; <tt class="literal">component.xml</tt> &#25991;&#20214;&#37197;&#32622;&#65288;&#26368;&#31616;&#21333;&#30340;&#24773;&#20917;&#65289;&#25110;&#32773;&#31867;&#25193;&#23637;&#32780;&#23454;&#29616;&#22797;&#29992;&#12290;
    </p><p>
        &#22312;&#19968;&#20010;Web&#24212;&#29992;&#31243;&#24207;&#20013;&#20351;&#29992;Hibernate&#25110;&#32773;JPA&#36827;&#34892;&#22522;&#26412;&#30340;&#25968;&#25454;&#24211;&#25805;&#20316;&#26102;&#65292;<span class="emphasis"><em>Seam Application Framework&#65288;Seam&#24212;&#29992;&#31243;&#24207;&#26694;&#26550;&#65289;</em></span> &#33021;&#22815;&#20943;&#23569;&#20320;&#38656;&#35201;&#20070;&#20889;&#30340;&#20195;&#30721;&#37327;&#12290;
    </p><p>
        &#25105;&#20204;&#38656;&#35201;&#24378;&#35843;&#30340;&#26159;&#65292;&#36825;&#20010;&#26694;&#26550;&#38750;&#24120;&#30340;&#31616;&#21333;&#65292;&#21482;&#26159;&#23569;&#37327;&#30340;&#26131;&#20110;&#29702;&#35299;&#21644;&#25193;&#23637;&#30340;&#31616;&#21333;&#31867;&#12290;
        &#8220;&#39764;&#21147;&#8221;&#26469;&#33258;&#20110;Seam&#33258;&#36523; &#8212; &#21363;&#20351;&#27809;&#26377;&#29992;&#36825;&#20010;&#26694;&#26550;&#26469;&#21019;&#24314;&#20219;&#20309;Seam&#24212;&#29992;&#31243;&#24207;&#30340;&#26102;&#20505;&#65292;&#20320;&#20063;&#21516;&#26679;&#29992;&#21040;&#36825;&#19968;&#8220;&#39764;&#21147;&#8221;&#12290;
    </p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6690"></a>11.1.&nbsp;&#31616;&#20171;</h2></div></div><div></div></div><p>
            &#26377;&#20004;&#31181;&#19981;&#21516;&#30340;&#26041;&#27861;&#20351;&#29992;Seam Application Framework&#25152;&#25552;&#20379;&#30340;&#32452;&#20214;&#12290;&#31532;&#19968;&#31181;&#26041;&#27861;&#26159;&#20687;&#22788;&#29702;&#20854;&#20182;&#31181;&#31867;&#30340;Seam&#20869;&#32622;&#32452;&#20214;&#19968;&#26679;&#65292;&#22312; <tt class="literal">components.xml</tt> &#20013;&#23433;&#35013;&#21644;&#37197;&#32622;&#32452;&#20214;&#30340;&#23454;&#20363;&#12290;
            &#20030;&#20363;&#26469;&#35828;&#65292;&#19979;&#21015; <tt class="literal">components.xml</tt> &#20013;&#30340;&#29255;&#27573;&#23433;&#35013;&#20102;&#19968;&#20010;&#33021;&#22815;&#20026; <tt class="literal">Person</tt> &#23454;&#20307;&#25191;&#34892;&#22522;&#26412;&#30340;CRUD&#65288;&#21019;&#24314;(Create)&#12289;&#35835;&#21462;(Retrieve) &#12289;&#26356;&#26032;(Update)&#21644;&#21024;&#38500;(Delete)&#65289;&#25805;&#20316;&#30340;&#32452;&#20214;&#65306;
        </p><pre class="programlisting">&lt;framework:entity-home name="personHome"
                       entity-class="eg.Person"
                       entity-manager="#{personDatabase}"&gt;
    &lt;framework:id&gt;#{param.personId}&lt;/framework:id&gt;
&lt;/framework:entity-home&gt;</pre><p>
            &#22914;&#26524;&#19978;&#38754;&#30340;&#20195;&#30721;&#25353;&#20320;&#30340;&#21475;&#21619;&#26469;&#35828;&#22826;&#20687;&#8220;&#29992;XML&#32534;&#31243;&#8221;&#65292;&#20320;&#21487;&#20197;&#25913;&#20026;&#20351;&#29992;&#25193;&#23637;&#65306;
        </p><pre class="programlisting">@Stateful
@Name("personHome")
public class PersonHome extends EntityHome&lt;Person&gt; implements LocalPersonHome {
    @RequestParameter String personId;
    @In EntityManager personDatabase;

    public Object getId() { return personId; }
    public EntityManager getEntityManager() { return personDatabase; }

}</pre><p>
            &#31532;&#20108;&#31181;&#26041;&#27861;&#26377;&#19968;&#20010;&#24456;&#22823;&#30340;&#20248;&#28857;&#65306;&#20320;&#33021;&#22815;&#26041;&#20415;&#22320;&#28155;&#21152;&#39069;&#22806;&#30340;&#21151;&#33021;&#65292;&#35206;&#30422;&#20869;&#32622;&#30340;&#21151;&#33021;&#65288;&#26694;&#26550;&#30340;&#31867;&#37117;&#31934;&#24515;&#35774;&#35745;&#20197;&#20415;&#20110;&#25193;&#23637;&#21644;&#23450;&#21046;&#65289;&#12290;
        </p><p>
           &#31532;&#20108;&#20010;&#20248;&#28857;&#26159;&#65306;&#22914;&#26524;&#20320;&#21916;&#27426;&#30340;&#35805;&#65292;&#20320;&#30340;&#31867;&#21487;&#20197;&#26159;&#26377;&#29366;&#24577;&#20250;&#35805;Bean&#65288;&#36825;&#19981;&#26159;&#24517;&#39035;&#30340;&#65292;&#20063;&#21487;&#20197;&#26159;&#26222;&#36890;&#30340;JavaBean&#32452;&#20214;&#65292;&#22914;&#26524;&#20320;&#21916;&#27426;&#30340;&#35805;&#65289;&#12290;&#22914;&#26524;&#20320;&#27491;&#22312;&#20351;&#29992;JBoss AS&#65292;&#20320;&#38656;&#35201;&#20351;&#29992;4.2.2.GA&#25110;&#26356;&#39640;&#30340;&#29256;&#26412;&#12290;
        </p><p>
			&#30446;&#21069;&#65292;Seam&#24212;&#29992;&#26694;&#26550;&#25552;&#20379;&#20102;&#22235;&#20010;&#20869;&#32622;&#30340;&#32452;&#20214;&#65306;&#29992;&#20110;CRUD&#25805;&#20316;&#30340; <tt class="literal">EntityHome</tt> &#21644; <tt class="literal">HibernateEntityHome</tt> &#20197;&#21450;&#29992;&#20110;&#26597;&#35810;&#30340; <tt class="literal">EntityQuery</tt> &#21644; <tt class="literal">HibernateEntityQuery</tt>&#12290;
        </p><p>
            &#20320;&#24471;&#32534;&#20889;Home&#21644;Query&#32452;&#20214;&#65292;&#23427;&#20204;&#33021;&#22312;session&#12289;event&#25110;conversation&#20316;&#29992;&#33539;&#22260;&#20013;&#36816;&#34892;&#65292;&#33267;&#20110;&#36873;&#25321;&#21738;&#20010;scope&#21462;&#20915;&#20110;&#20320;&#25152;&#24076;&#26395;&#22312;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#20013;&#20351;&#29992;&#30340;&#29366;&#24577;&#27169;&#22411;&#12290;
        </p><p>
            Seam&#24212;&#29992;&#26694;&#26550;&#20165;&#22312;Seam&#31649;&#29702;&#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#20013;&#24037;&#20316;&#12290;&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#36825;&#20123;&#32452;&#20214;&#20250;&#23547;&#25214;&#19968;&#20010;&#21483;&#20570; <tt class="literal">entityManager</tt> &#30340;&#25345;&#20037;&#21270;&#19978;&#19979;&#25991;&#12290;
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6735"></a>11.2.&nbsp;Home&#23545;&#35937;</h2></div></div><div></div></div><p>
            Home&#23545;&#35937;&#23545;&#29305;&#23450;&#30340;&#23454;&#20307;&#31867;&#25552;&#20379;&#25345;&#20037;&#21270;&#25805;&#20316;&#65292;&#20551;&#35774;&#25105;&#20204;&#26377;&#20010;&#21487;&#38752;&#30340; <tt class="literal">Person</tt> &#31867;&#65306;
        </p><pre class="programlisting">@Entity
public class Person {
    @Id private Long id;
    private String firstName;
    private String lastName;
    private Country nationality;

    //getters and setters...
}</pre><p>
         &#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#37197;&#32622;&#23450;&#20041;&#19968;&#20010; <tt class="literal">personHome</tt> &#32452;&#20214;&#65306;
        </p><pre class="programlisting">&lt;framework:entity-home name="personHome" entity-class="eg.Person" /&gt;</pre><p>
            &#20063;&#21487;&#20197;&#36890;&#36807;&#31867;&#30340;&#25193;&#23637;
        </p><pre class="programlisting">@Name("personHome")
public class PersonHome extends EntityHome&lt;Person&gt; {}</pre><p>
             Home&#23545;&#35937;&#25552;&#20379;&#20102;&#22914;&#19979;&#30340;&#25805;&#20316;&#65306;<tt class="literal">persist()</tt>&#12289;<tt class="literal">remove()</tt>&#12289;<tt class="literal">update()</tt> &#21644; <tt class="literal">getInstance()</tt>&#12290;
             &#22312;&#20320;&#33021;&#22815;&#35843;&#29992; <tt class="literal">remove()</tt> &#25110; <tt class="literal">update()</tt> &#25805;&#20316;&#20043;&#21069;&#65292;&#20320;&#24517;&#39035;&#39318;&#20808;&#20351;&#29992; <tt class="literal">setId()</tt> &#26041;&#27861;&#23450;&#20041;&#20320;&#24863;&#20852;&#36259;&#30340;&#23545;&#35937;&#30340;&#26631;&#35782;&#31526;&#12290;
        </p><p>
            &#25105;&#20204;&#21487;&#20197;&#30452;&#25509;&#20174;&#19968;&#20010;JSF&#39029;&#38754;&#20351;&#29992;&#19968;&#20010;Home&#65292;&#22914;&#19979;&#20363;&#65306;
        </p><pre class="programlisting">&lt;h1&gt;Create Person&lt;/h1&gt;
&lt;h:form&gt;
    &lt;div&gt;First name: &lt;h:inputText value="#{personHome.instance.firstName}"/&gt;&lt;/div&gt;
    &lt;div&gt;Last name: &lt;h:inputText value="#{personHome.instance.lastName}"/&gt;&lt;/div&gt;
    &lt;div&gt;
        &lt;h:commandButton value="Create Person" action="#{personHome.persist}"/&gt;
    &lt;/div&gt;
&lt;/h:form&gt;</pre><p>
            &#36890;&#24120;&#65292;&#21482;&#29992;<tt class="literal">person</tt> &#25351;&#26126;person&#28418;&#20142;&#24471;&#22810;&#65292;&#25152;&#20197;&#22312; <tt class="literal">components.xml</tt> &#20013;&#28155;&#21152;&#19968;&#34892;&#35821;&#21477;&#26469;&#23454;&#29616;&#12290;
        </p><pre class="programlisting">&lt;factory name="person"
         value="#{personHome.instance}"/&gt;

&lt;framework:entity-home name="personHome"
                       entity-class="eg.Person" /&gt;</pre><p>
            &#65288;&#22914;&#26524;&#25105;&#20204;&#20351;&#29992;&#37197;&#32622;&#30340;&#26041;&#27861;&#12290;&#65289;
            &#25110;&#32773;&#65292;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#21521; <tt class="literal">PersonHome</tt> &#20013;&#28155;&#21152;&#19968;&#20010; <tt class="literal">@Factory</tt> &#26041;&#27861;&#26469;&#23454;&#29616;&#65306;
        </p><pre class="programlisting">@Name("personHome")
public class PersonHome extends EntityHome&lt;Person&gt; {

    @Factory("person")
    public Person initPerson() { return getInstance(); }

}</pre><p>
            &#65288;&#22914;&#26524;&#25105;&#20204;&#20351;&#29992;&#31867;&#25193;&#23637;&#30340;&#26041;&#27861;&#65289;
            &#36825;&#20010;&#20462;&#25913;&#20351;&#25105;&#20204;&#30340;JSF&#39029;&#38754;&#31616;&#21270;&#22914;&#19979;&#65306;
        </p><pre class="programlisting">&lt;h1&gt;Create Person&lt;/h1&gt;
&lt;h:form&gt;
    &lt;div&gt;First name: &lt;h:inputText value="#{person.firstName}"/&gt;&lt;/div&gt;
    &lt;div&gt;Last name: &lt;h:inputText value="#{person.lastName}"/&gt;&lt;/div&gt;
    &lt;div&gt;
        &lt;h:commandButton value="Create Person" action="#{personHome.persist}"/&gt;
    &lt;/div&gt;
&lt;/h:form&gt;</pre><p>
            &#22909;&#65292;&#36825;&#23601;&#21487;&#20197;&#29992;&#26469;&#21019;&#24314;&#26032;&#30340; <tt class="literal">Person</tt> &#23454;&#20307;&#20102;&#12290;&#26159;&#30340;&#65292;&#36825;&#23601;&#26159;&#25152;&#38656;&#30340;&#20840;&#37096;&#20195;&#30721;&#65281;&#29616;&#22312;&#65292;&#22914;&#26524;&#25105;&#20204;&#24819;&#26174;&#31034;&#65292;&#26356;&#26032;&#65292;&#21024;&#38500;&#25968;&#25454;&#24211;&#20013;&#24050;&#32463;&#23384;&#22312;&#30340; <tt class="literal">Person</tt> &#23454;&#20307;&#65292;&#25105;&#20204;&#38656;&#35201;&#23558;&#23454;&#20307;&#26631;&#35782;&#31526;&#20256;&#36882;&#32473; <tt class="literal">PersonHome</tt>&#12290;&#39029;&#38754;&#21442;&#25968;&#26159;&#19968;&#31181;&#38750;&#24120;&#22909;&#30340;&#23454;&#29616;&#26041;&#24335;&#65306;
        </p><pre class="programlisting">&lt;pages&gt;
    &lt;page view-id="/editPerson.jsp"&gt;
        &lt;param name="personId" value="#{personHome.id}"/&gt;
    &lt;/page&gt;
&lt;/pages&gt;</pre><p>
            &#29616;&#22312;&#65292;&#25105;&#20204;&#21487;&#20197;&#21521;JSF&#39029;&#38754;&#20013;&#22686;&#21152;&#20854;&#20182;&#30340;&#25805;&#20316;&#65306;
        </p><pre class="programlisting">&lt;h1&gt;
    &lt;h:outputText rendered="#{!personHome.managed}" value="Create Person"/&gt;
    &lt;h:outputText rendered="#{personHome.managed}" value="Edit Person"/&gt;
&lt;/h1&gt;
&lt;h:form&gt;
    &lt;div&gt;First name: &lt;h:inputText value="#{person.firstName}"/&gt;&lt;/div&gt;
    &lt;div&gt;Last name: &lt;h:inputText value="#{person.lastName}"/&gt;&lt;/div&gt;
    &lt;div&gt;
        &lt;h:commandButton value="Create Person" action="#{personHome.persist}" rendered="#{!personHome.managed}"/&gt;
        &lt;h:commandButton value="Update Person" action="#{personHome.update}" rendered="#{personHome.managed}"/&gt;
        &lt;h:commandButton value="Delete Person" action="#{personHome.remove}" rendered="#{personHome.managed}"/&gt;
    &lt;/div&gt;
&lt;/h:form&gt;</pre><p>
            &#24403;&#25105;&#20204;&#27809;&#26377;&#24102;&#20219;&#20309;&#35831;&#27714;&#21442;&#25968;&#38142;&#25509;&#21040;&#35813;&#39029;&#38754;&#26102;&#65292;&#20250;&#26174;&#31034;"Create Person"&#39029;&#38754;&#65292;&#24403;&#25105;&#20204;&#20026; <tt class="literal">personId</tt> &#36825;&#20010;&#35831;&#27714;&#21442;&#25968;&#35774;&#23450;&#19968;&#20010;&#20540;&#26102;&#65292;&#20250;&#26174;&#31034;&#8220;Edit Person&#8221;&#39029;&#38754;&#12290;
        </p><p>
            &#20551;&#35774;&#25105;&#20204;&#38656;&#35201;&#21019;&#24314;&#19968;&#20123; <tt class="literal">Person</tt> &#23454;&#20307;&#65292;&#24182;&#19988;&#21021;&#22987;&#21270;&#36825;&#20123;&#20154;&#30340;&#22269;&#31821;&#12290;&#25105;&#20204;&#21487;&#20197;&#36890;&#36807;&#37197;&#32622;&#24456;&#36731;&#26494;&#22320;&#23436;&#25104;&#65306;
        </p><pre class="programlisting">&lt;factory name="person"
         value="#{personHome.instance}"/&gt;

&lt;framework:entity-home name="personHome"
                       entity-class="eg.Person"
                       new-instance="#{newPerson}"/&gt;

&lt;component name="newPerson"
           class="eg.Person"&gt;
    &lt;property name="nationality"&gt;#{country}&lt;/property&gt;
&lt;/component&gt;</pre><p>
             &#20063;&#21487;&#20197;&#36890;&#36807;&#25193;&#23637;&#31867;
         </p><pre class="programlisting">@Name("personHome")
public class PersonHome extends EntityHome&lt;Person&gt; {

    @In Country country;

    @Factory("person")
    public Person initPerson() { return getInstance(); }

    protected Person createInstance() {
        return new Person(country);
    }

}</pre><p>
            &#24403;&#28982;&#65292;<tt class="literal">Country</tt> &#26159;&#19968;&#20010;&#34987;&#20854;&#23427;&#30340;Home&#23545;&#35937;&#31649;&#29702;&#30340;&#23545;&#35937;&#65292;&#27604;&#22914;&#35828;&#65292;<tt class="literal">CountryHome</tt>&#12290;
        </p><p>
            &#20026;&#20102;&#22686;&#21152;&#26356;&#22810;&#22797;&#26434;&#30340;&#25805;&#20316;&#65288;&#32852;&#21512;&#31649;&#29702;&#31561;&#31561;&#65289;&#65292;&#25105;&#20204;&#21487;&#20197;&#21521; <tt class="literal">PersonHome</tt> &#20013;&#28155;&#21152;&#26041;&#27861;&#12290;
        </p><pre class="programlisting">@Name("personHome")
public class PersonHome extends EntityHome&lt;Person&gt; {

    @In Country country;

    @Factory("person")
    public Person initPerson() { return getInstance(); }

    protected Person createInstance() {
        return new Person(country);
    }

    public void migrate()
    {
        getInstance().setCountry(country);
        update();
    }

}</pre><p>
			&#24403;&#20107;&#21153;&#25104;&#21151;&#20043;&#21518;&#65288;&#35843;&#29992; <tt class="literal">persist()</tt>&#12289;<tt class="literal">update()</tt> &#25110; <tt class="literal">remove()</tt> &#25104;&#21151;&#21518;&#65289;&#65292;Home&#23545;&#35937;&#20250;&#21457;&#20986;&#19968;&#20010; <tt class="literal">org.jboss.seam.afterTransactionSuccess</tt> &#20107;&#20214;&#12290;
			&#36890;&#36807;&#30417;&#21548;&#36825;&#19968;&#20107;&#20214;&#65292;&#25105;&#20204;&#21487;&#20197;&#22312;&#24213;&#23618;&#23454;&#20307;&#25913;&#21464;&#21518;&#65292;&#21047;&#26032;&#26597;&#35810;&#12290;
			&#22914;&#26524;&#25105;&#20204;&#21482;&#38656;&#35201;&#22312;&#29305;&#23450;&#30340;&#23454;&#20307;&#20445;&#23384;&#12289;&#20462;&#25913;&#25110;&#21024;&#38500;&#21518;&#21047;&#26032;&#29305;&#23450;&#26597;&#35810;&#65292;&#25105;&#20204;&#21487;&#20197;&#30417;&#35270; <tt class="literal">org.jboss.seam.afterTransactionSuccess.&lt;name&gt;</tt> &#20107;&#20214;&#65288;<tt class="literal">&lt;name&gt;</tt> &#26159;&#23454;&#20307;&#30340;&#21517;&#23383;&#65289;&#12290;
		</p><p>
            &#24403;&#19968;&#20010;&#25805;&#20316;&#25104;&#21151;&#26102;&#65292;Home&#23545;&#35937;&#21487;&#20197;&#33258;&#21160;&#22320;&#26174;&#31034;Faces&#20449;&#24687;&#65292;&#25105;&#20204;&#21487;&#20197;&#20877;&#19968;&#27425;&#36890;&#36807;&#37197;&#32622;&#26469;&#23450;&#21046;&#20449;&#24687;&#12290;
        </p><pre class="programlisting">&lt;factory name="person"
         value="#{personHome.instance}"/&gt;

&lt;framework:entity-home name="personHome"
                       entity-class="eg.Person"
                       new-instance="#{newPerson}"&gt;
    &lt;framework:created-message&gt;New person #{person.firstName} #{person.lastName} created&lt;/framework:created-message&gt;
    &lt;framework:deleted-message&gt;Person #{person.firstName} #{person.lastName} deleted&lt;/framework:deleted-message&gt;
    &lt;framework:updated-message&gt;Person #{person.firstName} #{person.lastName} updated&lt;/framework:updated-message&gt;
&lt;/framework:entity-home&gt;

&lt;component name="newPerson"
           class="eg.Person"&gt;
    &lt;property name="nationality"&gt;#{country}&lt;/property&gt;
&lt;/component&gt;</pre><p>
             &#25110;&#32773;&#25193;&#23637;&#65306;
         </p><pre class="programlisting">@Name("personHome")
public class PersonHome extends EntityHome&lt;Person&gt; {

    @In Country country;

    @Factory("person")
    public Person initPerson() { return getInstance(); }

    protected Person createInstance() {
        return new Person(country);
    }

    protected String getCreatedMessage() { return "New person #{person.firstName} #{person.lastName} created"; }
    protected String getUpdatedMessage() { return "Person #{person.firstName} #{person.lastName} updated"; }
    protected String getDeletedMessage() { return "Person #{person.firstName} #{person.lastName} deleted"; }

}</pre><p>
            &#20294;&#26159;&#25351;&#23450;&#20449;&#24687;&#26368;&#22909;&#30340;&#26041;&#27861;&#26159;&#25226;&#20449;&#24687;&#32622;&#20110;Seam&#25152;&#30693;&#30340;resource bundle&#20013;&#65288;&#22312;&#40664;&#35748;&#24773;&#20917;&#19979;&#65292;&#36825;&#20010;bundle&#21483;&#20570; <tt class="literal">messages</tt> &#65289;&#12290;
        </p><pre class="programlisting">Person_created=New person #{person.firstName} #{person.lastName} created
Person_deleted=Person #{person.firstName} #{person.lastName} deleted
Person_updated=Person #{person.firstName} #{person.lastName} updated</pre><p>
			&#36825;&#26679;&#26041;&#20415;&#36827;&#34892;&#22269;&#38469;&#21270;&#65292;&#20174;&#34920;&#29616;&#23618;&#30340;&#35282;&#24230;&#32771;&#34385;&#20063;&#20445;&#25345;&#20102;&#20195;&#30721;&#21644;&#37197;&#32622;&#30340;&#25972;&#27905;&#12290;
        </p><p>
            &#26368;&#21518;&#19968;&#27493;&#26159;&#20351;&#29992; <tt class="literal">&lt;s:validateAll&gt;</tt> &#21644; <tt class="literal">&lt;s:decorate&gt;</tt> &#21521;&#39029;&#38754;&#20013;&#28155;&#21152;&#39564;&#35777;&#21151;&#33021;&#65292;&#25105;&#20250;&#25226;&#36825;&#20010;&#30041;&#32473;&#20320;&#20204;&#33258;&#24049;&#21435;&#23454;&#29616;&#12290;
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6900"></a>11.3.&nbsp;Query&#23545;&#35937;</h2></div></div><div></div></div><p>
            &#22914;&#26524;&#25105;&#20204;&#38656;&#35201;&#25968;&#25454;&#24211;&#20013;&#25152;&#26377; <tt class="literal">Person</tt> &#23454;&#20363;&#30340;&#21015;&#34920;&#65292;&#25105;&#20204;&#21487;&#20197;&#20351;&#29992;Query&#23545;&#35937;&#65292;&#20363;&#22914;&#65306;
        </p><pre class="programlisting">&lt;framework:entity-query name="people"
                        ejbql="select p from Person p"/&gt;</pre><p>
            &#25105;&#20204;&#21487;&#20197;&#20174;&#19968;&#20010;JSF&#39029;&#38754;&#20013;&#20351;&#29992;&#23427;&#65306;
        </p><pre class="programlisting">&lt;h1&gt;List of people&lt;/h1&gt;
&lt;h:dataTable value="#{people.resultList}" var="person"&gt;
    &lt;h:column&gt;
        &lt;s:link view="/editPerson.jsp" value="#{person.firstName} #{person.lastName}"&gt;
            &lt;f:param name="personId" value="#{person.id}"/&gt;
        &lt;/s:link&gt;
    &lt;/h:column&gt;
&lt;/h:dataTable&gt;</pre><p>
            &#25105;&#20204;&#21487;&#33021;&#38656;&#35201;&#25903;&#25345;&#20998;&#39029;&#65306;
        </p><pre class="programlisting">&lt;framework:entity-query name="people"
                        ejbql="select p from Person p"
                        order="lastName"
                        max-results="20"/&gt;</pre><p>
            &#25105;&#20204;&#21487;&#20197;&#20351;&#29992;page&#21442;&#25968;&#26469;&#20915;&#23450;&#34987;&#26174;&#31034;&#30340;&#39029;&#38754;
        </p><pre class="programlisting">&lt;pages&gt;
    &lt;page view-id="/searchPerson.jsp"&gt;
        &lt;param name="firstResult" value="#{people.firstResult}"/&gt;
    &lt;/page&gt;
&lt;/pages&gt;</pre><p>
            &#29992;&#20110;&#20998;&#39029;&#30340;JSF&#20195;&#30721;&#21487;&#33021;&#26377;&#28857;&#20887;&#38271;&#65292;&#20294;&#20173;&#28982;&#26159;&#20415;&#20110;&#31649;&#29702;&#30340;&#65306;
        </p><pre class="programlisting">&lt;h1&gt;Search for people&lt;/h1&gt;
&lt;h:dataTable value="#{people.resultList}" var="person"&gt;
    &lt;h:column&gt;
        &lt;s:link view="/editPerson.jsp" value="#{person.firstName} #{person.lastName}"&gt;
            &lt;f:param name="personId" value="#{person.id}"/&gt;
        &lt;/s:link&gt;
    &lt;/h:column&gt;
&lt;/h:dataTable&gt;

&lt;s:link view="/search.xhtml" rendered="#{people.previousExists}" value="First Page"&gt;
    &lt;f:param name="firstResult" value="0"/&gt;
&lt;/s:link&gt;

&lt;s:link view="/search.xhtml" rendered="#{people.previousExists}" value="Previous Page"&gt;
    &lt;f:param name="firstResult" value="#{people.previousFirstResult}"/&gt;
&lt;/s:link&gt;

&lt;s:link view="/search.xhtml" rendered="#{people.nextExists}" value="Next Page"&gt;
    &lt;f:param name="firstResult" value="#{people.nextFirstResult}"/&gt;
&lt;/s:link&gt;

&lt;s:link view="/search.xhtml" rendered="#{people.nextExists}" value="Last Page"&gt;
    &lt;f:param name="firstResult" value="#{people.lastFirstResult}"/&gt;
&lt;/s:link&gt;</pre><p>
            &#30495;&#23454;&#30340;&#25628;&#32034;&#30028;&#38754;&#33021;&#22815;&#36890;&#36807;&#35753;&#29992;&#25143;&#36755;&#20837;&#19968;&#31995;&#21015;&#30340;&#21487;&#36873;&#30340;&#25628;&#32034;&#26631;&#20934;&#26469;&#32553;&#23567;&#36820;&#22238;&#30340;&#32467;&#26524;&#21015;&#34920;&#12290;Query&#23545;&#35937;&#36890;&#36807;&#35753;&#20320;&#25351;&#23450;&#21487;&#36873;&#30340;&#8220;&#32422;&#26463;&#8221;&#26469;&#25903;&#25345;&#36825;&#20010;&#37325;&#35201;&#30340;&#29992;&#20363;&#12290;
        </p><pre class="programlisting">&lt;component name="examplePerson" class="Person"/&gt;

&lt;framework:entity-query name="people"
                        ejbql="select p from Person p"
                        order="lastName"
                        max-results="20"&gt;
    &lt;framework:restrictions&gt;
        &lt;value&gt;lower(firstName) like lower( concat(#{examplePerson.firstName},'%') )&lt;/value&gt;
        &lt;value&gt;lower(lastName) like lower( concat(#{examplePerson.lastName},'%') )&lt;/value&gt;
    &lt;/framework:restrictions&gt;
&lt;/framework:entity-query&gt;</pre><p>
            &#27880;&#24847;&#8220;example&#8221;&#23545;&#35937;&#30340;&#20351;&#29992;&#12290;
        </p><pre class="programlisting">&lt;h1&gt;Search for people&lt;/h1&gt;
&lt;h:form&gt;
    &lt;div&gt;First name: &lt;h:inputText value="#{examplePerson.firstName}"/&gt;&lt;/div&gt;
    &lt;div&gt;Last name: &lt;h:inputText value="#{examplePerson.lastName}"/&gt;&lt;/div&gt;
    &lt;div&gt;&lt;h:commandButton value="Search" action="/search.jsp"/&gt;&lt;/div&gt;
&lt;/h:form&gt;

&lt;h:dataTable value="#{people.resultList}" var="person"&gt;
    &lt;h:column&gt;
        &lt;s:link view="/editPerson.jsp" value="#{person.firstName} #{person.lastName}"&gt;
            &lt;f:param name="personId" value="#{person.id}"/&gt;
        &lt;/s:link&gt;
    &lt;/h:column&gt;
&lt;/h:dataTable&gt;</pre><p>
			&#22312;&#24213;&#23618;&#23454;&#20307;&#21457;&#29983;&#25913;&#21464;&#21518;&#65292;&#21487;&#20197;&#36890;&#36807;&#30417;&#21548; <tt class="literal">org.jboss.seam.afterTransactionSuccess</tt> &#20107;&#20214;&#26469;&#21047;&#26032;&#26597;&#35810;&#65306;
		</p><pre class="programlisting">&lt;event type="org.jboss.seam.afterTransactionSuccess"&gt;
    &lt;action execute="#{people.refresh}" /&gt;
&lt;/event&gt;</pre><p>
			&#25110;&#32773;&#65292;&#22312;&#21457;&#29983;&#25345;&#20037;&#21270;&#12289;&#26356;&#26032;&#25110;&#32773;&#21024;&#38500;&#26102;&#65292;&#36890;&#36807; <tt class="literal">PersonHome</tt> &#26469;&#21047;&#26032;&#26597;&#35810;&#65306;
		</p><pre class="programlisting">&lt;event type="org.jboss.seam.afterTransactionSuccess.Person"&gt;
    &lt;action execute="#{people.refresh}" /&gt;
&lt;/event&gt;</pre><p>
            &#36825;&#20010;&#37096;&#20998;&#25152;&#26377;&#30340;&#20363;&#23376;&#37117;&#26159;&#36890;&#36807;&#37197;&#32622;&#26469;&#20307;&#29616;&#37325;&#29992;&#30340;&#65292;&#20294;&#26159;&#65292;&#23545;Query&#23545;&#35937;&#36890;&#36807;&#25193;&#23637;&#26469;&#36827;&#34892;&#37325;&#29992;&#20063;&#26159;&#21487;&#34892;&#30340;&#12290;
        </p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e6950"></a>11.4.&nbsp;Controller&#23545;&#35937;</h2></div></div><div></div></div><p>
            <tt class="literal">Controller</tt> &#31867;&#20197;&#21450;&#23427;&#30340;&#23376;&#31867; <tt class="literal">EntityController</tt>&#65292;<tt class="literal">HibernateEntityController</tt> &#21644; <tt class="literal">BusinessProcessController</tt> &#26159;Seam Application Framework&#30340;&#21487;&#36873;&#37096;&#20998;&#12290;
            &#36825;&#20123;&#31867;&#21482;&#26159;&#25552;&#20379;&#20102;&#19968;&#20123;&#35775;&#38382;&#24120;&#29992;&#20869;&#32622;&#32452;&#20214;&#21450;&#36825;&#20123;&#32452;&#20214;&#26041;&#27861;&#30340;&#20415;&#21033;&#25163;&#27573;&#65292;&#23427;&#20204;&#33021;&#22815;&#20943;&#23569;&#19968;&#20123;&#38190;&#30424;&#36755;&#20837;&#37327;&#65292;&#20063;&#20026;&#25506;&#32034;Seam&#20869;&#32622;&#20016;&#23500;&#21151;&#33021;&#30340;&#21021;&#23398;&#32773;&#25552;&#20379;&#20102;&#19968;&#20010;&#38750;&#24120;&#22909;&#30340;&#36339;&#26495;&#12290;
        </p><p>
            &#20363;&#22914;&#65292;&#36825;&#23601;&#26159;Seam&#27880;&#20876;&#23454;&#20363;&#20013;&#30340; <tt class="literal">RegisterAction</tt>&#65306;
        </p><pre class="programlisting">@Stateless
@Name("register")
public class RegisterAction extends EntityController implements Register
{

   @In private User user;

   public String register()
   {
      List existing = createQuery("select u.username from User u where u.username=:username")
         .setParameter("username", user.getUsername())
         .getResultList();

      if ( existing.size()==0 )
      {
         persist(user);
         info("Registered new user #{user.username}");
         return "/registered.jspx";
      }
      else
      {
         addFacesMessage("User #{user.username} already exists");
         return null;
      }
   }

}</pre><p>
            &#27491;&#22914;&#20320;&#25152;&#30475;&#21040;&#30340;&#19968;&#26679;&#65292;&#36825;&#19981;&#26159;&#20160;&#20040;&#24778;&#19990;&#39559;&#20439;&#30340;&#25552;&#39640;...
        </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="groovy.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="drools.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;10.&nbsp;Groovy&#38598;&#25104;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;12.&nbsp;Seam&#21644;JBoss&#35268;&#21017;</td></tr></table></div></body></html>