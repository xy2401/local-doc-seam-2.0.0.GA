<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;13.&nbsp;&#23433;&#20840;</title><link rel="stylesheet" href="../shared/css/html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="Seam - &#35821;&#22659;&#30456;&#20851;&#30340;&#32452;&#20214; [&#28385;&#27743;&#32418;20080327]"><link rel="up" href="index.html" title="Seam - &#35821;&#22659;&#30456;&#20851;&#30340;&#32452;&#20214; [&#28385;&#27743;&#32418;20080327]"><link rel="previous" href="drools.html" title="Chapter&nbsp;12.&nbsp;Seam&#21644;JBoss&#35268;&#21017;"><link rel="next" href="i18n.html" title="Chapter&nbsp;14.&nbsp;&#22269;&#38469;&#21270;&#21644;&#20027;&#39064;"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;13.&nbsp;&#23433;&#20840;</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="drools.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="i18n.html">Next</a></td></tr></table><hr></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="security"></a>Chapter&nbsp;13.&nbsp;&#23433;&#20840;</h2></div></div><div></div></div><p>
	Seam Security API&#26159;&#20010;&#21487;&#36873;&#30340;Seam&#29305;&#24615;&#65292;&#23427;&#20026;&#20445;&#25252;&#24744;&#30340;Seam&#39033;&#30446;&#20013;&#30340;&#39046;&#22495;&#21644;&#39029;&#38754;&#36164;&#28304;&#25552;&#20379;&#39564;&#35777;&#21644;&#25480;&#26435;&#29305;&#24615;&#12290;
	</p><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7100"></a>13.1.&nbsp;&#27010;&#36848;</h2></div></div><div></div></div><p>
		Seam Security&#25552;&#20379;&#20004;&#31181;&#19981;&#21516;&#30340;&#25805;&#20316;&#27169;&#24335;&#65306;
		</p><div class="itemizedlist"><ul type="disc"><li><p>
					<span class="emphasis"><em>&#31616;&#21270;&#27169;&#24335;</em></span> - &#36825;&#20010;&#27169;&#24335;&#25903;&#25345;&#39564;&#35777;&#26381;&#21153;&#21644;&#31616;&#21333;&#30340;&#22522;&#20110;&#35282;&#33394;&#30340;&#23433;&#20840;&#24615;&#26816;&#26597;&#12290;
				</p></li><li><p>
					<span class="emphasis"><em>&#39640;&#32423;&#27169;&#24335;</em></span> - &#36825;&#20010;&#27169;&#24335;&#25903;&#25345;&#31616;&#21270;&#27169;&#24335;&#30340;&#25152;&#26377;&#29305;&#24615;&#65292;&#36824;&#21033;&#29992;JBoss Rules&#25552;&#20379;&#22522;&#20110;&#35268;&#21017;&#30340;&#23433;&#20840;&#24615;&#26816;&#26597;&#12290;
				</p></li></ul></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7118"></a>13.1.1.&nbsp;&#21738;&#31181;&#27169;&#24335;&#26356;&#36866;&#21512;&#25105;&#30340;&#24212;&#29992;&#31243;&#24207;&#21602;&#65311;</h3></div></div><div></div></div><p>
			&#36825;&#23436;&#20840;&#21462;&#20915;&#20110;&#24212;&#29992;&#31243;&#24207;&#30340;&#38656;&#27714;&#12290;
			&#22914;&#26524;&#20320;&#30340;&#23433;&#20840;&#24615;&#38656;&#27714;&#19981;&#39640;&#65292;&#20363;&#22914;&#65292;&#22914;&#26524;&#21482;&#24076;&#26395;&#23545;&#30331;&#24405;&#30340;&#29992;&#25143;&#25110;&#32773;&#23646;&#20110;&#26576;&#20010;&#29305;&#23450;&#35282;&#33394;&#30340;&#29992;&#25143;&#38480;&#21046;&#26576;&#20123;&#39029;&#38754;&#21644;&#21160;&#20316;&#65292;&#37027;&#20040;&#31616;&#21270;&#27169;&#24335;&#21487;&#33021;&#23601;&#36275;&#22815;&#20102;&#12290;
			&#36825;&#20010;&#27169;&#24335;&#30340;&#22909;&#22788;&#22312;&#20110;&#23427;&#26159;&#19968;&#31181;&#26356;&#31616;&#21270;&#30340;&#37197;&#32622;&#65292;&#35201;&#21253;&#25324;&#30340;&#24211;&#26126;&#26174;&#26356;&#23569;&#65292;&#21344;&#29992;&#30340;&#20869;&#23384;&#31354;&#38388;&#65288;memory footprint&#65289;&#20063;&#26356;&#23567;&#12290;
			</p><p>
			&#21478;&#19968;&#26041;&#38754;&#65292;&#22914;&#26524;&#24212;&#29992;&#31243;&#24207;&#38656;&#35201;&#26681;&#25454;&#19978;&#19979;&#25991;&#25110;&#32773;&#22797;&#26434;&#30340;&#19994;&#21153;&#35268;&#21017;&#36827;&#34892;&#23433;&#20840;&#24615;&#26816;&#26597;&#65292;&#37027;&#23601;&#38656;&#35201;&#39640;&#32423;&#27169;&#24335;&#25552;&#20379;&#30340;&#29305;&#24615;&#20102;&#12290;
			</p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7125"></a>13.2.&nbsp;&#38656;&#27714;</h2></div></div><div></div></div><p>
		&#22914;&#26524;&#20351;&#29992;Seam Security&#30340;&#39640;&#32423;&#27169;&#24335;&#29305;&#24615;&#65292;&#19979;&#21015;jar&#25991;&#20214;&#23601;&#35201;&#37197;&#32622;&#25104; <tt class="literal">application.xml</tt> &#20013;&#30340;&#27169;&#22359;&#12290;
		&#22914;&#26524;&#20320;&#27491;&#22312;&#31616;&#21270;&#27169;&#24335;&#19979;&#20351;&#29992;Seam Security&#65292;&#21017; <span class="emphasis"><em>&#19981;</em></span> &#38656;&#35201;&#36825;&#20123;&#20102;&#65306;
		</p><div class="itemizedlist"><ul type="disc"><li><p>drools-compiler-4.0.0.MR2.jar</p></li><li><p>drools-core-4.0.0.MR2.jar</p></li><li><p>janino-2.5.7.jar</p></li><li><p>antlr-runtime-3.0.jar</p></li><li><p>mvel14-1.2beta16.jar</p></li></ul></div><p>
		&#23545;&#20110;&#22522;&#20110;Web&#30340;&#23433;&#20840;&#24615;&#26469;&#35828;&#65292;<tt class="literal">jboss-seam-ui.jar</tt> &#20063;&#24517;&#39035;&#21253;&#25324;&#22312;&#24212;&#29992;&#31243;&#24207;&#30340;war&#25991;&#20214;&#20013;&#12290;
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7157"></a>13.3.&nbsp;&#21462;&#28040;&#23433;&#20840;</h2></div></div><div></div></div><p>
		&#22312;&#26576;&#20123;&#22330;&#26223;&#19979;&#65292;&#21487;&#33021;&#38656;&#35201;&#21462;&#28040;Seam Security&#65292;&#20363;&#22914;&#22312;&#21333;&#20803;&#27979;&#35797;&#30340;&#36807;&#31243;&#20013;&#12290;
		&#21487;&#20197;&#36890;&#36807;&#35843;&#29992;&#38745;&#24577;&#26041;&#27861; <tt class="literal">Identity.setSecurityEnabled(false)</tt> &#26469;&#21462;&#28040;&#23433;&#20840;&#26816;&#26597;&#12290;
		&#36825;&#26679;&#19968;&#26469;&#65292;&#23601;&#21487;&#20197;&#38459;&#27490;&#25191;&#34892;&#22914;&#19979;&#30340;&#20219;&#20309;&#23433;&#20840;&#26816;&#26597;&#65306;
		</p><div class="itemizedlist"><ul type="disc"><li><p>Entity Security</p></li><li><p>Hibernate Security Interceptor</p></li><li><p>Seam Security Interceptor</p></li><li><p>Page restrictions</p></li></ul></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7178"></a>13.4.&nbsp;&#39564;&#35777;</h2></div></div><div></div></div><p>
		Seam Security&#25552;&#20379;&#30340;&#39564;&#35777;&#29305;&#24615;&#24314;&#31435;&#22312;JAAS&#65288;Java Authentication&#21644;Authorization Service&#65289;&#20043;&#19978;&#65292;&#32473;&#22788;&#29702;&#29992;&#25143;&#39564;&#35777;&#25552;&#20379;&#31283;&#20581;&#30340;&#12289;&#38750;&#24120;&#23481;&#26131;&#37197;&#32622;&#30340;API&#12290;
		&#28982;&#32780;&#65292;&#23545;&#20110;&#24182;&#19981;&#22797;&#26434;&#30340;&#39564;&#35777;&#38656;&#27714;&#65292;Seam&#25552;&#20379;&#20102;&#19968;&#31181;&#26356;&#21152;&#31616;&#21270;&#30340;&#39564;&#35777;&#26041;&#27861;&#65292;&#38544;&#34255;&#20102;JAAS&#30340;&#22797;&#26434;&#24615;&#12290;
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7183"></a>13.4.1.&nbsp;&#37197;&#32622;</h3></div></div><div></div></div><p>
			&#31616;&#21270;&#30340;&#39564;&#35777;&#26041;&#27861;&#20351;&#29992;&#19968;&#31181;&#20869;&#32622;&#30340;JAAS&#30331;&#24405;&#27169;&#22359;&#65306;<tt class="literal">SeamLoginModule</tt>&#65292;&#25226;&#39564;&#35777;&#22996;&#25176;&#32473;&#20320;&#39033;&#30446;&#20013;&#30340;&#19968;&#20010;Seam&#32452;&#20214;&#12290;
			&#36825;&#20010;&#30331;&#24405;&#27169;&#22359;&#24050;&#32463;&#22312;Seam&#20869;&#37096;&#37197;&#32622;&#20026;&#40664;&#35748;&#30340;&#24212;&#29992;&#31574;&#30053;&#30340;&#19968;&#37096;&#20998;&#65292;&#22240;&#27492;&#19981;&#38656;&#35201;&#20219;&#20309;&#39069;&#22806;&#30340;&#37197;&#32622;&#25991;&#20214;&#12290;&#23427;&#20801;&#35768;&#20320;&#21033;&#29992;&#20320;&#33258;&#24049;&#30340;&#24212;&#29992;&#31243;&#24207;&#25552;&#20379;&#30340;&#23454;&#20307;&#31867;&#32534;&#20889;&#39564;&#35777;&#26041;&#27861;&#12290;
			&#37197;&#32622;&#36825;&#20010;&#31616;&#21270;&#30340;&#39564;&#35777;&#24418;&#24335;&#38656;&#35201;&#22312; <tt class="literal">components.xml</tt> &#20013;&#37197;&#32622; <tt class="literal">identity</tt> &#32452;&#20214;&#12290;
			</p><pre class="programlisting">&lt;components xmlns="http://jboss.com/products/seam/components"
            xmlns:core="http://jboss.com/products/seam/core"
            xmlns:security="http://jboss.com/products/seam/security"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation=
                "http://jboss.com/products/seam/components http://jboss.com/products/seam/components-2.0.xsd
                 http://jboss.com/products/seam/security http://jboss.com/products/seam/security-2.0.xsd"&gt;

    &lt;security:identity authenticate-method="#{authenticator.authenticate}"/&gt;

&lt;/components&gt;</pre><p>
			&#22914;&#26524;&#20320;&#24076;&#26395;&#20351;&#29992;&#39640;&#32423;&#30340;&#23433;&#20840;&#24615;&#29305;&#24615;&#65292;&#22914;&#22522;&#20110;&#35268;&#21017;&#30340;&#35768;&#21487;&#26816;&#26597;&#65292;&#20320;&#25152;&#35201;&#20570;&#30340;&#23601;&#26159;&#25226;Drools&#65288;JBoss Rules&#65289;jars&#21253;&#21547;&#22312;&#20320;&#30340;classpath&#20013;&#65292;&#24182;&#28155;&#21152;&#19968;&#20123;&#39069;&#22806;&#30340;&#37197;&#32622;&#65292;&#21518;&#38754;&#20250;&#35762;&#21040;&#12290;
			</p><p>
			EL&#34920;&#36798;&#24335; <tt class="literal">#{authenticator.authenticate}</tt> &#26159;&#19968;&#31181;&#26041;&#27861;&#32465;&#23450;&#65292;&#34920;&#31034; <tt class="literal">authenticator</tt> &#32452;&#20214;&#30340; <tt class="literal">authenticate</tt> &#26041;&#27861;&#23558;&#29992;&#26469;&#39564;&#35777;&#35813;&#29992;&#25143;&#12290;
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7212"></a>13.4.2.&nbsp;&#32534;&#20889;&#39564;&#35777;&#26041;&#27861;</h3></div></div><div></div></div><p>
			&#22312; <tt class="literal">components.xml</tt> &#20013;&#32473; <tt class="literal">identity</tt> &#25351;&#23450;&#30340; <tt class="literal">authenticate-method</tt> &#23646;&#24615;&#65292;&#35268;&#23450;&#20102;&#21738;&#31181;&#26041;&#27861;&#23558;&#34987;SeamLoginModule&#29992;&#26469;&#39564;&#35777;&#29992;&#25143;&#12290;
			&#36825;&#20010;&#26041;&#27861;&#27809;&#26377;&#21442;&#25968;&#65292;&#24182;&#23558;&#35201;&#36820;&#22238;&#19968;&#20010;&#24067;&#23572;&#20540;&#65292;&#34920;&#31034;&#39564;&#35777;&#26159;&#21542;&#25104;&#21151;&#12290;&#29992;&#25143;&#30340;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#21487;&#20197;&#20998;&#21035;&#22320;&#36890;&#36807; <tt class="literal">Identity.instance().getUsername()</tt> &#21644; <tt class="literal">Identity.instance().getPassword()</tt> &#33719;&#21462;&#65292;&#29992;&#25143;&#25152;&#23646;&#30340;&#20219;&#20309;&#35282;&#33394;&#37117;&#24212;&#35813;&#21033;&#29992; <tt class="literal">Identity.instance().addRole()</tt> &#20998;&#37197;&#12290;
			&#19979;&#38754;&#26159;JavaBean&#32452;&#20214;&#20869;&#37096;&#19968;&#20010;&#39564;&#35777;&#26041;&#27861;&#30340;&#23436;&#25972;&#23454;&#20363;&#65306;
			</p><pre class="programlisting">@Name("authenticator")
public class Authenticator {
   @In EntityManager entityManager;

   public boolean authenticate() {
      try
      {
         User user = (User) entityManager.createQuery(
            "from User where username = :username and password = :password")
            .setParameter("username", Identity.instance().getUsername())
            .setParameter("password", Identity.instance().getPassword())
            .getSingleResult();

         if (user.getRoles() != null)
         {
            for (UserRole mr : user.getRoles())
               Identity.instance().addRole(mr.getName());
         }

         return true;
      }
      catch (NoResultException ex)
      {
         return false;
      }

   }

}</pre><p>
			&#22312;&#19978;&#38754;&#30340;&#20363;&#23376;&#20013;&#65292;<tt class="literal">User</tt> &#21644; <tt class="literal">UserRole</tt> &#37117;&#26159;&#24212;&#29992;&#31243;&#24207;&#25351;&#23450;&#30340;&#23454;&#20307;Bean&#12290;
			<tt class="literal">roles</tt> &#21442;&#25968;&#20197;&#29992;&#25143;&#25152;&#23646;&#30340;&#35282;&#33394;&#22635;&#20805;&#65292;&#23427;&#24212;&#35813;&#28155;&#21152;&#21040; <tt class="literal">Set</tt> &#20316;&#20026;&#25991;&#23383;&#22411;&#23383;&#31526;&#20018;&#20540;&#65292;&#22914;&#8220;admin&#8221;&#12289;&#8220;user&#8221;&#12290;
			&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;&#22914;&#26524;&#27809;&#26377;&#25214;&#21040;&#29992;&#25143;&#35760;&#24405;&#65292;&#24182;&#25243;&#20986;&#19968;&#20010; <tt class="literal">NoResultException</tt>&#65292;&#39564;&#35777;&#26041;&#27861;&#23601;&#36820;&#22238;false&#65292;&#34920;&#31034;&#39564;&#35777;&#22833;&#36133;&#12290;
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7254"></a>13.4.2.1.&nbsp;Identity.addRole()</h4></div></div><div></div></div><p>
					<tt class="literal">Identity.addRole()</tt> &#26041;&#27861;&#34920;&#29616;&#30340;&#19981;&#21516;&#21462;&#20915;&#20110;&#24403;&#21069;&#20250;&#35805;&#26159;&#21542;&#24050;&#32463;&#39564;&#35777;&#36807;&#20102;&#12290;
				&#22914;&#26524;&#20250;&#35805;&#27809;&#26377;&#39564;&#35777;&#36807;&#65292;&#37027;&#20040; <tt class="literal">addRole()</tt> &#23601; <span class="emphasis"><em>&#21482;&#33021;</em></span> &#22312;&#39564;&#35777;&#30340;&#36807;&#31243;&#20013;&#34987;&#35843;&#29992;&#12290;
				&#24403;&#34987;&#35843;&#29992;&#21040;&#36825;&#37324;&#26102;&#65292;&#35282;&#33394;&#21517;&#31216;&#34987;&#25918;&#36827;&#19968;&#20010;&#39044;&#39564;&#35777;&#35282;&#33394;&#30340;&#20020;&#26102;&#21015;&#34920;&#20013;&#12290;
				&#19968;&#24403;&#39564;&#35777;&#25104;&#21151;&#65292;&#39044;&#39564;&#35777;&#35282;&#33394;&#23601;&#21464;&#25104;&#8220;&#30495;&#23454;&#30340;&#8221;&#35282;&#33394;&#20102;&#65292;&#24182;&#19988;&#35843;&#29992; <tt class="literal">Identity.hasRole()</tt> &#23601;&#21487;&#20197;&#36820;&#22238;true&#20102;&#12290;
				&#19979;&#38754;&#30340;&#24207;&#21015;&#22270;&#23637;&#31034;&#20102;&#39044;&#39564;&#35777;&#35282;&#33394;&#21015;&#34920;&#20316;&#20026;&#31532;&#19968;&#31867;&#23545;&#35937;&#65292;&#20197;&#26356;&#28165;&#26970;&#22320;&#34920;&#26126;&#23427;&#22914;&#20309;&#36866;&#24212;&#22312;&#25972;&#20010;&#39564;&#35777;&#36807;&#31243;&#12290;
				</p><div class="mediaobject" align="center"><img src="images/security-addrole.png" align="middle"></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7276"></a>13.4.3.&nbsp;&#32534;&#20889;&#30331;&#24405;&#34920;&#21333;</h3></div></div><div></div></div><p>
				<tt class="literal">Identity</tt> &#32452;&#20214;&#25552;&#20379; <tt class="literal">username</tt> &#21644; <tt class="literal">password</tt> &#23646;&#24615;&#65292;&#36866;&#21512;&#26368;&#24120;&#35265;&#30340;&#39564;&#35777;&#22330;&#26223;&#12290;
			&#36825;&#20123;&#23646;&#24615;&#21487;&#20197;&#30452;&#25509;&#32465;&#23450;&#21040;&#30331;&#24405;&#34920;&#21333;&#19978;&#30340;&#29992;&#25143;&#21517;&#21644;&#23494;&#30721;&#23383;&#27573;&#12290;&#19968;&#26086;&#35774;&#32622;&#20102;&#36825;&#20123;&#23646;&#24615;&#65292;&#35843;&#29992; <tt class="literal">identity.login()</tt> &#26041;&#27861;&#23601;&#21487;&#20197;&#39564;&#35777;&#20351;&#29992;&#25152;&#25552;&#20379;&#30340;&#35777;&#20070;&#30340;&#29992;&#25143;&#12290;
			&#19979;&#38754;&#26159;&#19968;&#20010;&#31616;&#21333;&#30340;&#30331;&#24405;&#34920;&#21333;&#30340;&#20363;&#23376;&#65306;
			</p><pre class="programlisting">&lt;div&gt;
    &lt;h:outputLabel for="name" value="Username"/&gt;
    &lt;h:inputText id="name" value="#{identity.username}"/&gt;
&lt;/div&gt;

&lt;div&gt;
    &lt;h:outputLabel for="password" value="Password"/&gt;
    &lt;h:inputSecret id="password" value="#{identity.password}"/&gt;
&lt;/div&gt;

&lt;div&gt;
    &lt;h:commandButton value="Login" action="#{identity.login}"/&gt;
&lt;/div&gt;</pre><p>
			&#31867;&#20284;&#22320;&#65292;&#27880;&#38144;&#29992;&#25143;&#36890;&#36807;&#35843;&#29992; <tt class="literal">#{identity.logout}</tt> &#26469;&#23436;&#25104;&#12290;&#35843;&#29992;&#36825;&#20010;&#21160;&#20316;&#23558;&#28165;&#38500;&#24403;&#21069;&#34987;&#39564;&#35777;&#29992;&#25143;&#30340;&#23433;&#20840;&#24615;&#29366;&#24577;&#12290;
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7300"></a>13.4.4.&nbsp;&#31616;&#21270;&#37197;&#32622; - &#27010;&#36848;</h3></div></div><div></div></div><p>
			&#22240;&#27492;&#24402;&#32467;&#36215;&#26469;&#65292;&#37197;&#32622;&#39564;&#35777;&#26377;&#19977;&#20010;&#31616;&#21333;&#30340;&#27493;&#39588;&#65306;
			</p><div class="itemizedlist"><ul type="disc"><li><p>
					&#22312; <tt class="literal">components.xml</tt> &#20013;&#37197;&#32622;&#19968;&#31181;&#39564;&#35777;&#26041;&#27861;&#12290;
					</p></li><li><p>
					&#32534;&#20889;&#19968;&#31181;&#39564;&#35777;&#26041;&#27861;&#12290;
					</p></li><li><p>
					&#32534;&#20889;&#19968;&#20010;&#30331;&#24405;&#34920;&#21333;&#65292;&#20197;&#20415;&#29992;&#25143;&#21487;&#20197;&#39564;&#35777;&#12290;
					</p></li></ul></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7318"></a>13.4.5.&nbsp;&#22788;&#29702;&#23433;&#20840;&#24322;&#24120;</h3></div></div><div></div></div><p>
			&#20026;&#20102;&#38450;&#27490;&#29992;&#25143;&#38543;&#23433;&#20840;&#38169;&#35823;&#32780;&#25910;&#21040;&#40664;&#35748;&#30340;&#38169;&#35823;&#39029;&#38754;&#65292;&#24314;&#35758; <tt class="literal">pages.xml</tt> &#37197;&#32622;&#20026;&#25226;&#23433;&#20840;&#38169;&#35823;&#37325;&#23450;&#21521;&#21040;&#19968;&#20010;&#26356;&#8220;&#28418;&#20142;&#8221;&#30340;&#39029;&#38754;&#12290;&#30001;Security API&#25243;&#20986;&#30340;&#20004;&#31181;&#20027;&#35201;&#30340;&#24322;&#24120;&#31867;&#22411;&#26159;&#65306;
			</p><div class="itemizedlist"><ul type="disc"><li><p>
						<tt class="literal">NotLoggedInException</tt> - &#22914;&#26524;&#29992;&#25143;&#35797;&#22270;&#22312;&#27809;&#26377;&#30331;&#24405;&#30340;&#24773;&#20917;&#19979;&#35775;&#38382;&#19968;&#20010;&#21463;&#38480;&#30340;&#21160;&#20316;&#25110;&#32773;&#39029;&#38754;&#65292;&#23601;&#20250;&#25243;&#20986;&#36825;&#20010;&#24322;&#24120;&#12290;
					</p></li><li><p>
						<tt class="literal">AuthorizationException</tt> - &#21482;&#26377;&#24403;&#29992;&#25143;&#24050;&#32463;&#30331;&#24405;&#65292;&#24182;&#19988;&#35797;&#22270;&#35775;&#38382;&#20182;&#20204;&#27809;&#26377;&#24517;&#35201;&#26435;&#38480;&#30340;&#21463;&#38480;&#21160;&#20316;&#25110;&#32773;&#39029;&#38754;&#26102;&#65292;&#25165;&#20250;&#25243;&#20986;&#36825;&#20010;&#24322;&#24120;&#12290;
					</p></li></ul></div><p>
			&#22312; <tt class="literal">NotLoggedInException</tt> &#25243;&#20986;&#30340;&#24773;&#20917;&#19979;&#65292;&#24314;&#35758;&#25226;&#29992;&#25143;&#38480;&#21046;&#21040;&#19968;&#20010;&#30331;&#24405;&#39029;&#38754;&#25110;&#32773;&#27880;&#20876;&#39029;&#38754;&#65292;&#20197;&#20415;&#30331;&#24405;&#12290;
			&#23545;&#20110; <tt class="literal">AuthorizationException</tt>&#65292;&#25226;&#29992;&#25143;&#37325;&#23450;&#21521;&#21040;&#19968;&#20010;&#38169;&#35823;&#39029;&#38754;&#21487;&#33021;&#26356;&#21512;&#36866;&#12290;
			&#20197;&#19979;&#26159; <tt class="literal">pages.xml</tt> &#25991;&#20214;&#30340;&#19968;&#20010;&#20363;&#23376;&#65292;&#23427;&#25226;&#36825;&#20004;&#31181;&#23433;&#20840;&#24322;&#24120;&#37117;&#22788;&#29702;&#20102;&#65306;
			</p><pre class="programlisting">&lt;pages&gt;

    ...

    &lt;exception class="org.jboss.seam.security.NotLoggedInException"&gt;
        &lt;redirect view-id="/login.xhtml"&gt;
            &lt;message&gt;You must be logged in to perform this action &#20320;&#24517;&#39035;&#30331;&#24405;&#25191;&#34892;&#36825;&#20010;&#21160;&#20316;&lt;/message&gt;
        &lt;/redirect&gt;
    &lt;/exception&gt;

    &lt;exception class="org.jboss.seam.security.AuthorizationException"&gt;
        &lt;end-conversation/&gt;
        &lt;redirect view-id="/security_error.xhtml"&gt;
            &lt;message&gt;You do not have the necessary security privileges to perform this action.&#20320;&#27809;&#26377;&#25191;&#34892;&#36825;&#20010;&#21160;&#20316;&#30340;&#24517;&#35201;&#26435;&#38480;&#12290;&lt;/message&gt;
        &lt;/redirect&gt;
    &lt;/exception&gt;

&lt;/pages&gt;</pre><p>
			&#22823;&#22810;&#25968;Web&#24212;&#29992;&#31243;&#24207;&#38656;&#35201;&#26356;&#22797;&#26434;&#30340;&#30331;&#24405;&#37325;&#23450;&#21521;&#22788;&#29702;&#65292;&#22240;&#27492;Seam&#21253;&#21547;&#20102;&#22788;&#29702;&#36825;&#20010;&#38382;&#39064;&#30340;&#19968;&#20123;&#29305;&#27530;&#21151;&#33021;&#12290;
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7354"></a>13.4.6.&nbsp;&#30331;&#24405;&#37325;&#23450;&#21521;</h3></div></div><div></div></div><p>
			&#24403;&#26410;&#34987;&#39564;&#35777;&#30340;&#29992;&#25143;&#35797;&#22270;&#35775;&#38382;&#26576;&#20010;&#29305;&#23450;&#30340;&#35270;&#22270;&#65288;&#25110;&#32773;&#36890;&#37197;&#31526;id&#65289;&#26102;&#65292;&#21487;&#20197;&#35753;Seam&#25226;&#29992;&#25143;&#37325;&#23450;&#21521;&#21040;&#19968;&#20010;&#30331;&#24405;&#39029;&#38754;&#65306;
			</p><pre class="programlisting">&lt;pages login-view-id="/login.xhtml"&gt;

    &lt;page view-id="/members/*" login-required="true"/&gt;

    ...

&lt;/pages&gt;</pre><p>
			&#65288;&#36825;&#20010;&#19981;&#20687;&#19978;&#36848;&#30340;&#24322;&#24120;&#22788;&#29702;&#22120;&#37027;&#20040;&#31616;&#27905;&#65292;&#20294;&#26159;&#21487;&#33021;&#35201;&#32467;&#21512;&#36215;&#26469;&#20351;&#29992;&#12290;&#65289;
			</p><p>
			&#29992;&#25143;&#30331;&#24405;&#20197;&#21518;&#65292;&#25105;&#20204;&#35201;&#33258;&#21160;&#36820;&#22238;&#21040;&#21407;&#26469;&#30340;&#22320;&#26041;&#65288;&#32593;&#22336;&#65289;&#65292;&#20197;&#20415;&#21487;&#20197;&#37325;&#35797;&#35201;&#27714;&#30331;&#24405;&#20043;&#21518;&#25165;&#33021;&#36827;&#34892;&#30340;&#25805;&#20316;&#12290;
			&#22914;&#26524;&#25226;&#19979;&#21015;&#20107;&#20214;&#30417;&#21548;&#22120;&#28155;&#21152;&#21040; <tt class="literal">components.xml</tt>&#65292;&#22914;&#26524;&#29992;&#25143;&#22312;&#27809;&#26377;&#30331;&#24405;&#30340;&#24773;&#20917;&#19979;&#21435;&#35775;&#38382;&#21463;&#38480;&#30340;&#39029;&#38754;&#65292;&#37027;&#20040;&#39029;&#38754;&#20449;&#24687;&#23601;&#20250;&#34987;&#35760;&#24405;&#19979;&#26469;&#12290;
			&#29992;&#25143;&#30331;&#24405;&#20043;&#21518;&#65292;&#23601;&#20250;&#34987;&#37325;&#23450;&#21521;&#21040;&#21018;&#25165;&#30340;&#21463;&#38480;&#39029;&#38754;&#65292;&#24182;&#19988;&#25226;&#21407;&#26469;&#30340;&#35831;&#27714;&#21442;&#25968;&#20063;&#19968;&#36215;&#20256;&#36807;&#21435;&#12290;
			</p><pre class="programlisting">&lt;event type="org.jboss.seam.notLoggedIn"&gt;
    &lt;action execute="#{redirect.captureCurrentView}"/&gt;
&lt;/event&gt;

&lt;event type="org.jboss.seam.postAuthenticate"&gt;
    &lt;action execute="#{redirect.returnToCapturedView}"/&gt;
&lt;/event&gt;</pre><p>
			&#27880;&#24847;&#30331;&#24405;&#37325;&#23450;&#21521;&#34987;&#23454;&#29616;&#20026;&#19968;&#31181;&#23545;&#35805;&#33539;&#22260;&#30340;&#26426;&#21046;&#65292;&#22240;&#27492;&#19981;&#35201;&#22312; <tt class="literal">authenticate()</tt> &#26041;&#27861;&#20013;&#32456;&#27490;&#23545;&#35805;&#12290;
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7375"></a>13.4.7.&nbsp;HTTP&#39564;&#35777;</h3></div></div><div></div></div><p>
			&#34429;&#28982;&#19981;&#24314;&#35758;&#20351;&#29992;&#65292;&#38500;&#38750;&#32477;&#23545;&#24517;&#35201;&#65292;Seam&#25552;&#20379;HTTP Basic&#25110;HTTP Digest&#65288;RFC 2617 &#65289;&#26041;&#27861;&#30340;&#39564;&#35777;&#12290;
			&#20026;&#20351;&#29992;&#34920;&#21333;&#30340;&#39564;&#35777;&#26041;&#24335;&#65292;<tt class="literal">authentication-filter</tt> &#32452;&#20214;&#24517;&#39035;&#33021;&#22815;&#22312;components.xml&#20013;&#28608;&#27963;&#65306;
			</p><pre class="programlisting">
  &lt;web:authentication-filter url-pattern="*.seam" auth-type="basic"/&gt;
      </pre><p>
			&#20026;&#20102;&#28608;&#27963;Basic&#39564;&#35777;&#30340;&#36807;&#28388;&#22120;&#65292;&#35774;&#32622; <tt class="literal">auth-type</tt> &#20026; <tt class="literal">basic</tt>
			&#25110;&#32773;&#23545;&#20110;Digest&#39564;&#35777; &#65292;&#35774;&#32622; <tt class="literal">auth-type</tt> &#20026; <tt class="literal">digest</tt>&#12290;
			&#22914;&#26524;&#26159;&#20351;&#29992;Digest&#39564;&#35777;&#65292;<tt class="literal">key</tt> &#21644; <tt class="literal">realm</tt> &#20063;&#24517;&#39035;&#36827;&#34892;&#35774;&#32622;&#65306;
			</p><pre class="programlisting">
  &lt;web:authentication-filter url-pattern="*.seam" auth-type="digest" key="AA3JK34aSDlkj" realm="My App"/&gt;
      </pre><p>
				<tt class="literal">key</tt> &#21487;&#20197;&#26159;&#20219;&#20309;&#23383;&#31526;&#20018;&#20540;&#12290;
			<tt class="literal">realm</tt> &#23601;&#26159;&#36827;&#34892;&#29992;&#25143;&#39564;&#35777;&#26102;&#25152;&#29992;&#30340;&#39564;&#35777;Realm&#30340;&#21517;&#31216;&#12290;
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7415"></a>13.4.7.1.&nbsp;&#32534;&#20889;Digest&#39564;&#35777;&#32773;</h4></div></div><div></div></div><p>
				&#22914;&#26524;&#26159;&#20351;&#29992;Digest&#35748;&#35777;&#65292;&#20320;&#30340;&#37492;&#23450;&#32773;&#31867;&#38656;&#35201;&#32487;&#25215;&#25277;&#35937;&#31867; <tt class="literal">org.jboss.seam.security.digest.digestauthenticator </tt> &#65292;&#24182;&#20351;&#29992;
				<tt class="literal">validatePassword()</tt> &#26041;&#27861;&#65292;&#20197;&#26681;&#25454;Digest&#30340;&#35201;&#27714;&#26469;&#39564;&#35777;&#29992;&#25143;&#30340;&#32431;&#25991;&#26412;&#23494;&#30721;&#12290;&#19979;&#38754;&#26159;&#19968;&#20010;&#20363;&#23376;&#65306;
				</p><pre class="programlisting">
   public boolean authenticate()
   {
      try
      {
         User user = (User) entityManager.createQuery(
            "from User where username = :username")
            .setParameter("username", identity.getUsername())
            .getSingleResult();

         return validatePassword(user.getPassword());
      }
      catch (NoResultException ex)
      {
         return false;
      }
   }
        </pre></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7428"></a>13.4.8.&nbsp;&#39640;&#32423;&#39564;&#35777;&#29305;&#24615;</h3></div></div><div></div></div><p>
			&#26412;&#33410;&#25506;&#35752;Security API&#25552;&#20379;&#30340;&#37096;&#20998;&#39640;&#32423;&#29305;&#24615;&#65292;&#29992;&#26469;&#28385;&#36275;&#26356;&#22797;&#26434;&#30340;&#23433;&#20840;&#38656;&#27714;&#12290;
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7433"></a>13.4.8.1.&nbsp;&#20351;&#29992;&#23481;&#22120;&#30340;JAAS&#37197;&#32622;</h4></div></div><div></div></div><p>
				&#22914;&#26524;&#20320;&#23425;&#21487;&#19981;&#29992;Seam Security API&#25552;&#20379;&#30340;&#31616;&#21270;&#30340;JAAS&#37197;&#32622;&#65292;&#21487;&#20197;&#22996;&#25176;&#32473;&#40664;&#35748;&#30340;&#31995;&#32479;JAAS&#37197;&#32622;&#65292;&#35813;&#37197;&#32622;&#26159;&#22312; <tt class="literal">components.xml</tt> &#20013;&#25552;&#20379;&#30340;&#19968;&#20010; <tt class="literal">jaasConfigName</tt>&#12290;
				&#20363;&#22914;&#65292;&#22914;&#26524;&#20320;&#27491;&#22312;&#20351;&#29992;JBoss AS&#65292;&#24182;&#24076;&#26395;&#20351;&#29992; <tt class="literal">&#20854;&#23427;</tt> &#31574;&#30053;&#65288;&#20351;&#29992;JBoss AS&#25552;&#20379;&#30340; <tt class="literal">UsersRolesLoginModule</tt> &#30331;&#24405;&#27169;&#22359;&#65289;&#65292;&#37027;&#20040; <tt class="literal">components.xml</tt> &#20013;&#30340;&#39033;&#30475;&#36215;&#26469;&#23601;&#20687;&#36825;&#26679;&#65306;
				</p><pre class="programlisting">&lt;security:identity authenticate-method="#{authenticator.authenticate}"
                      jaas-config-name="other"/&gt;</pre></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7455"></a>13.5.&nbsp;&#38169;&#35823;&#28040;&#24687;</h2></div></div><div></div></div><p>
		Security API&#32473;&#21508;&#31181;&#23433;&#20840;&#30456;&#20851;&#30340;&#20107;&#20214;&#29983;&#25104;&#35768;&#22810;&#40664;&#35748;&#30340;&#23637;&#29616;&#28040;&#24687;&#12290;&#19979;&#34920;&#21015;&#20986;&#20102;&#21487;&#20197;&#29992;&#26469;&#35206;&#30422;&#36825;&#20123;&#28040;&#24687;&#30340;Key&#65292;&#23427;&#20204;&#22312; <tt class="literal">message.properties</tt> &#36164;&#28304;&#25991;&#20214;&#20013;&#25351;&#23450;&#12290;&#20026;&#20102;&#31105;&#27490;&#28040;&#24687;&#65292;&#21482;&#35201;&#22312;&#36164;&#28304;&#25991;&#20214;&#37324;&#32473;&#30456;&#24212;&#30340;Key&#36171;&#20104;&#31354;&#20540;&#23601;&#34892;&#20102;&#12290;
		</p><div class="table"><a name="d0e7463"></a><p class="title"><b>Table&nbsp;13.1.&nbsp;&#23433;&#20840;&#28040;&#24687;Key</b></p><table summary="&#23433;&#20840;&#28040;&#24687;Key" border="1"><colgroup><col><col></colgroup><tbody><tr><td><p>
								<tt class="literal">org.jboss.seam.loginSuccessful</tt>
							</p></td><td><p>
							&#36825;&#20010;&#28040;&#24687;&#22312;&#29992;&#25143;&#36890;&#36807;Security API&#25104;&#21151;&#30331;&#24405;&#26102;&#29983;&#25104;&#12290;
							</p></td></tr><tr><td><p>
								<tt class="literal">org.jboss.seam.loginFailed</tt>
							</p></td><td><p>
							&#36825;&#20010;&#28040;&#24687;&#22312;&#30331;&#24405;&#36807;&#31243;&#22833;&#36133;&#26102;&#29983;&#25104;&#12290;&#22833;&#36133;&#26159;&#30001;&#20110;&#29992;&#25143;&#25552;&#20379;&#20102;&#38169;&#35823;&#30340;&#29992;&#25143;&#21517;&#25110;&#32773;&#23494;&#30721;&#65292;&#25110;&#32773;&#30001;&#20110;&#20854;&#20182;&#38382;&#39064;&#36896;&#25104;&#30340;&#12290;
							</p></td></tr><tr><td><p>
								<tt class="literal">org.jboss.seam.NotLoggedIn</tt>
							</p></td><td><p>
							&#36825;&#20010;&#28040;&#24687;&#22312;&#29992;&#25143;&#35797;&#22270;&#25191;&#34892;&#19968;&#20010;&#21160;&#20316;&#65292;&#25110;&#32773;&#35775;&#38382;&#19968;&#20010;&#38656;&#35201;&#23433;&#20840;&#26816;&#26597;&#30340;&#39029;&#38754;&#65292;&#24182;&#19988;&#29992;&#25143;&#30446;&#21069;&#26410;&#34987;&#39564;&#35777;&#26102;&#29983;&#25104;&#12290;
							</p></td></tr></tbody></table></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7500"></a>13.6.&nbsp;&#25480;&#26435;</h2></div></div><div></div></div><p>
		Seam Security API&#25552;&#20379;&#20102;&#22823;&#37327;&#25480;&#26435;&#29305;&#24615;&#65292;&#29992;&#26469;&#20445;&#25252;&#23545;&#32452;&#20214;&#12289;&#32452;&#20214;&#26041;&#27861;&#21644;&#39029;&#38754;&#30340;&#35775;&#38382;&#12290;&#26412;&#33410;&#38416;&#36848;&#36825;&#27599;&#19968;&#31181;&#25480;&#26435;&#29305;&#24615;&#12290;
		&#35201;&#27880;&#24847;&#30340;&#19968;&#20214;&#37325;&#35201;&#30340;&#20107;&#26159;&#65292;&#22914;&#26524;&#20320;&#24076;&#26395;&#20351;&#29992;&#20219;&#20309;&#39640;&#32423;&#29305;&#24615;&#65288;&#22914;&#22522;&#20110;&#35268;&#21017;&#30340;&#35768;&#21487;&#65289;&#65292;&#37027;&#20040;&#20320;&#30340; <tt class="literal">components.xml</tt> &#25991;&#20214;&#23601;&#24517;&#39035;&#37197;&#32622;&#25104;&#25903;&#25345;&#35813;&#29305;&#24615; - &#35831;&#35265;&#21069;&#38754;&#30340;&#37197;&#32622;&#23567;&#33410;&#12290;
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7508"></a>13.6.1.&nbsp;&#26680;&#24515;&#27010;&#24565;</h3></div></div><div></div></div><p>
			Seam Security API&#25552;&#20379;&#30340;&#27599;&#31181;&#25480;&#26435;&#26426;&#21046;&#65292;&#37117;&#26500;&#24314;&#22312;&#29992;&#25143;&#34987;&#25480;&#19982;&#20102;&#35282;&#33394;&#21644;&#65295;&#25110;&#35768;&#21487;&#30340;&#27010;&#24565;&#20043;&#19978;&#12290;
			&#35282;&#33394;&#26159;&#29992;&#25143;&#30340;&#19968;&#20010; <span class="emphasis"><em>&#32676;&#32452;</em></span>&#65292;&#25110;&#32773;&#19968;&#31181; <span class="emphasis"><em>&#31867;&#22411;</em></span>&#65292;&#35813;&#29992;&#25143;&#21487;&#33021;&#24050;&#32463;&#34987;&#25480;&#19982;&#26576;&#31181;&#29305;&#26435;&#65292;&#29992;&#26469;&#22312;&#24212;&#29992;&#31243;&#24207;&#20869;&#37096;&#25191;&#34892;&#19968;&#20010;&#25110;&#32773;&#26356;&#22810;&#30340;&#29305;&#23450;&#25805;&#20316;&#12290;
			&#35768;&#21487;&#26159;&#25191;&#34892;&#21333;&#20010;&#25351;&#23450;&#21160;&#20316;&#30340;&#19968;&#31181;&#65288;&#26377;&#26102;&#26159;&#19968;&#27425;&#24615;&#30340;&#65289;&#29305;&#26435;&#12290;
			&#21482;&#29992;&#35768;&#21487;&#32780;&#19981;&#29992;&#20854;&#23427;&#20219;&#20309;&#19996;&#35199;&#26469;&#26500;&#24314;&#24212;&#29992;&#31243;&#24207;&#26159;&#23436;&#20840;&#21487;&#33021;&#30340;&#65292;&#28982;&#32780;&#35282;&#33394;&#22312;&#25480;&#19982;&#29992;&#25143;&#32676;&#32452;&#29305;&#26435;&#26102;&#26356;&#28789;&#27963;&#26041;&#20415;&#12290;
		</p><p>
			&#35282;&#33394;&#24456;&#31616;&#21333;&#65292;&#21482;&#30001;&#19968;&#20010;&#21517;&#31216;&#32452;&#25104;&#65292;&#22914;&#8220;admin&#8221;&#12289;&#8220;user&#8221;&#12289;&#8220;customer&#8221;&#31561;&#31561;&#12290;&#35768;&#21487;&#30001;&#19968;&#20010;&#21517;&#31216;&#21644;&#19968;&#20010;&#21160;&#20316;&#32452;&#25104;&#65292;&#22312;&#36825;&#20010;&#25991;&#26723;&#20013;&#20197; <tt class="literal">name:action</tt> &#30340;&#24418;&#24335;&#34920;&#31034;&#65292;&#20363;&#22914; <tt class="literal">customer:delete</tt>&#65292;&#25110;&#32773; <tt class="literal">customer:insert</tt>&#12290;
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7530"></a>13.6.2.&nbsp;&#20445;&#25252;&#32452;&#20214;</h3></div></div><div></div></div><p>
			&#25105;&#20204;&#20174;&#26816;&#39564;&#25480;&#26435;&#30340;&#26368;&#31616;&#21333;&#30340;&#24418;&#24335;&#24320;&#22987;&#65306;&#32452;&#20214;&#23433;&#20840;&#65292;&#20174; <tt class="literal">@Restrict</tt> &#27880;&#35299;&#24320;&#22987;&#12290;
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7538"></a>13.6.2.1.&nbsp;@Restrict&#27880;&#35299;</h4></div></div><div></div></div><p>
				Seam&#32452;&#20214;&#21487;&#20197;&#21033;&#29992; <tt class="literal">@Restrict</tt> &#27880;&#35299;&#22312;&#26041;&#27861;&#25110;&#32773;&#31867;&#32423;&#19978;&#24471;&#21040;&#20445;&#25252;&#12290;
				&#22914;&#26524;&#26041;&#27861;&#21644;&#22768;&#26126;&#23427;&#30340;&#31867;&#37117;&#36890;&#36807; <tt class="literal">@Restrict</tt> &#27880;&#35299;&#65292;&#26041;&#27861;&#38480;&#21046;&#23558;&#20248;&#20808;&#65288;&#31867;&#38480;&#21046;&#26159;&#19981;&#36215;&#20316;&#29992;&#65289;&#12290;
				&#22914;&#26524;&#26041;&#27861;&#35843;&#29992;&#22312;&#23433;&#20840;&#26816;&#26597;&#20013;&#22833;&#36133;&#65292;&#37027;&#20040;&#26681;&#25454;&#23545; <tt class="literal">Identity.checkRestriction()</tt> &#30340;&#32422;&#23450;&#23601;&#20250;&#25243;&#20986;&#19968;&#20010;&#24322;&#24120;&#65288;&#35831;&#35265;&#34892;&#20869;&#38480;&#21046;&#65289;&#12290;
				&#32452;&#20214;&#31867;&#33258;&#36523;&#19978;&#30340; <tt class="literal">@Restrict</tt> &#30456;&#24403;&#20110;&#25226; <tt class="literal">@Restrict</tt> &#28155;&#21152;&#21040;&#20102;&#23427;&#30340;&#27599;&#19968;&#20010;&#26041;&#27861;&#19978;&#12290;
				</p><p>
				&#31354;&#30340; <tt class="literal">@Restrict</tt> &#24847;&#21619;&#30528; <tt class="literal">componentName:methodName</tt> &#30340;&#19968;&#20010;&#35768;&#21487;&#26816;&#26597;&#12290;&#20197;&#19979;&#38754;&#30340;&#32452;&#20214;&#26041;&#27861;&#20026;&#20363;&#65306;
				</p><pre class="programlisting">@Name("account")
public class AccountAction {
    @Restrict public void delete() {
      ...
    }
}</pre><p>
				&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;&#35843;&#29992; <tt class="literal">delete()</tt> &#26041;&#27861;&#38656;&#35201;&#30340;&#38544;&#21547;&#35768;&#21487;&#26159; <tt class="literal">account:delete</tt>&#12290;
				&#36824;&#26377;&#19968;&#31181;&#26041;&#24335;&#65292;&#23601;&#26159;&#20889; <tt class="literal">@Restrict("#{s:hasPermission('account','delete',null)}")</tt>&#12290;
				&#29616;&#22312;&#26469;&#30475;&#21478;&#19968;&#20010;&#20363;&#23376;&#65306;
				</p><pre class="programlisting">@Restrict @Name("account")
public class AccountAction {
    public void insert() {
      ...
    }
    @Restrict("#{s:hasRole('admin')}")
    public void delete() {
      ...
    }
}</pre><p>
				&#36825;&#19968;&#27425;&#65292;&#32452;&#20214;&#31867;&#26412;&#36523;&#36890;&#36807; <tt class="literal">@Restrict</tt> &#27880;&#35299;&#12290;&#36825;&#24847;&#21619;&#30528;&#20219;&#20309;&#27809;&#26377;&#35206;&#30422; <tt class="literal">@Restrict</tt> &#27880;&#35299;&#30340;&#26041;&#27861;&#37117;&#38656;&#35201;&#19968;&#20010;&#38544;&#24335;&#30340;&#35768;&#21487;&#26816;&#26597;&#12290;&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;<tt class="literal">insert()</tt> &#26041;&#27861;&#38656;&#35201; <tt class="literal">account:insert</tt> &#30340;&#19968;&#20010;&#35768;&#21487;&#65292;&#32780; <tt class="literal">delete()</tt> &#26041;&#27861;&#21017;&#35201;&#27714;&#29992;&#25143;&#24517;&#39035;&#26159; <tt class="literal">admin</tt> &#35282;&#33394;&#30340;&#19968;&#21592;&#12290;
				</p><p>
				&#22312;&#36827;&#19968;&#27493;&#25506;&#35752;&#20043;&#21069;&#65292;&#20808;&#30475;&#30475;&#22312;&#21069;&#38754;&#30340;&#20363;&#23376;&#20013;&#35265;&#36807;&#30340; <tt class="literal">#{s:hasRole()}</tt> &#34920;&#36798;&#24335;&#12290;
				<tt class="literal">s:hasRole</tt> &#21644; <tt class="literal">s:hasPermission</tt> &#37117;&#26159;EL&#26041;&#27861;&#65292;&#23427;&#20204;&#22996;&#25176;&#32473; <tt class="literal">Identity</tt> &#31867;&#30456;&#24212;&#30340;&#20855;&#21517;&#26041;&#27861;&#12290;
				&#36825;&#20123;&#20989;&#25968;&#21487;&#20197;&#22312;&#25152;&#26377;Security API&#30340;&#20219;&#20309;EL&#34920;&#36798;&#24335;&#20013;&#20351;&#29992;&#12290;
				</p><p>
				&#20316;&#20026;&#19968;&#20010;EL&#34920;&#36798;&#24335;&#65292;<tt class="literal">@Restrict</tt> &#27880;&#35299;&#30340;&#20540;&#21487;&#20197;&#24341;&#29992;Seam&#19978;&#19979;&#25991;&#20013;&#23384;&#22312;&#30340;&#20219;&#20309;&#23545;&#35937;&#12290;
				&#36825;&#22312;&#32473;&#29305;&#23450;&#30340;&#23545;&#35937;&#23454;&#20363;&#25191;&#34892;&#35768;&#21487;&#26816;&#26597;&#26102;&#26497;&#20026;&#26377;&#29992;&#12290;&#30475;&#30475;&#36825;&#20010;&#20363;&#23376;&#65306;
				</p><pre class="programlisting">@Name("account")
public class AccountAction {
    @In Account selectedAccount;
    @Restrict("#{s:hasPermission('account','modify',selectedAccount)}")
    public void modify() {
        selectedAccount.modify();
    }
}</pre><p>
				&#36825;&#20010;&#20363;&#23376;&#20013;&#26368;&#20540;&#24471;&#20851;&#27880;&#30340;&#19996;&#35199;&#26159;&#65292;&#23545;&#22312; <tt class="literal">hasPermission()</tt> &#20989;&#25968;&#35843;&#29992;&#20013;&#35265;&#21040;&#30340; <tt class="literal">selectedAccount</tt> &#30340;&#24341;&#29992;&#12290;
				&#36825;&#20010;&#21464;&#37327;&#30340;&#20540;&#23558;&#20174;Seam&#19978;&#19979;&#25991;&#20869;&#37096;&#26597;&#25214;&#65292;&#24182;&#20256;&#36882;&#21040; <tt class="literal">Identity</tt> &#20013;&#30340; <tt class="literal">hasPermission()</tt> &#26041;&#27861;&#65292;
				&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;&#23427;&#38543;&#21518;&#21487;&#20197;&#30830;&#23450;&#29992;&#25143;&#26159;&#21542;&#20855;&#26377;&#20462;&#25913;&#25351;&#23450; <tt class="literal">Account</tt> &#23545;&#35937;&#25152;&#38656;&#30340;&#35768;&#21487;&#12290;
				</p></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7639"></a>13.6.2.2.&nbsp;&#34892;&#20869;&#38480;&#21046;</h4></div></div><div></div></div><p>
				&#26377;&#26102;&#20505;&#65292;&#21487;&#33021;&#24076;&#26395;&#22312;&#20195;&#30721;&#20013;&#25191;&#34892;&#23433;&#20840;&#26816;&#26597;&#65292;&#32780;&#19981;&#29992; <tt class="literal">@Restrict</tt> &#27880;&#35299;&#12290;&#22312;&#36825;&#31181;&#24773;&#20917;&#19979;&#65292;&#21482;&#35201;&#29992; <tt class="literal">Identity.checkRestriction()</tt> &#26469;&#35745;&#31639;&#23433;&#20840;&#34920;&#36798;&#24335;&#65292;&#20687;&#36825;&#26679;&#65306;
				</p><pre class="programlisting">public void deleteCustomer() {
    Identity.instance().checkRestriction("#{s:hasPermission('customer','delete',selectedCustomer)}");
}</pre><p>
				&#22914;&#26524;&#25351;&#23450;&#30340;&#34920;&#36798;&#24335;&#27809;&#26377;&#21462;&#20540;&#20026; <tt class="literal">true</tt>&#65292;&#25110;&#32773;
				</p><div class="itemizedlist"><ul type="disc"><li><p>
						&#22914;&#26524;&#29992;&#25143;&#27809;&#26377;&#30331;&#24405;&#65292;&#23601;&#25243;&#20986; <tt class="literal">NotLoggedInException</tt> &#24322;&#24120;&#65292;&#25110;&#32773;
						</p></li><li><p>
						&#22914;&#26524;&#29992;&#25143;&#30331;&#24405;&#20102;&#65292;&#23601;&#25243;&#20986; <tt class="literal">AuthorizationException</tt> &#24322;&#24120;&#12290;
						</p></li></ul></div><p>
				&#30452;&#25509;&#22312;Java&#20195;&#30721;&#20013;&#35843;&#29992; <tt class="literal">hasRole()</tt> &#21644; <tt class="literal">hasPermission()</tt> &#26041;&#27861;&#20063;&#26159;&#21487;&#33021;&#30340;&#65306;
				</p><pre class="programlisting">if (!Identity.instance().hasRole("admin"))
     throw new AuthorizationException("Must be admin to perform this action");

if (!Identity.instance().hasPermission("customer", "create", null))
     throw new AuthorizationException("You may not create new customers");</pre></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7680"></a>13.6.3.&nbsp;&#29992;&#25143;&#30028;&#38754;&#20013;&#30340;&#23433;&#20840;</h3></div></div><div></div></div><p>
			&#35774;&#35745;&#20248;&#33391;&#30340;&#29992;&#25143;&#30028;&#38754;&#30340;&#19968;&#31181;&#34920;&#29616;&#26159;&#65292;&#19981;&#20250;&#21521;&#29992;&#25143;&#23637;&#29616;&#20182;&#20204;&#27809;&#26377;&#24517;&#35201;&#30340;&#26435;&#38480;&#36827;&#34892;&#20351;&#29992;&#30340;&#36873;&#39033;&#12290;Seam Security&#20801;&#35768;&#26465;&#20214;&#24615;&#30340;&#28210;&#26579;&#65306;
			1&#65289;&#19968;&#20010;&#39029;&#38754;&#30340;&#20960;&#20010;&#37096;&#20998;&#65292;&#25110;&#32773;2&#65289;&#29420;&#31435;&#30340;&#25511;&#21046;&#65292;&#26681;&#25454;&#29992;&#25143;&#30340;&#26435;&#38480;&#65292;&#20351;&#29992;&#19982;&#29992;&#32473;&#32452;&#20214;&#23433;&#20840;&#30340;&#23436;&#20840;&#30456;&#21516;&#30340;EL&#34920;&#36798;&#24335;&#12290;
			</p><p>
			&#25105;&#20204;&#26469;&#30475;&#30475;&#30028;&#38754;&#23433;&#20840;&#30340;&#19968;&#20123;&#20363;&#23376;&#12290;&#39318;&#20808;&#65292;&#25105;&#20204;&#20551;&#35774;&#26377;&#19968;&#20010;&#30331;&#24405;&#34920;&#21333;&#65292;&#23427;&#24212;&#35813;&#21482;&#22312;&#29992;&#25143;&#36824;&#27809;&#26377;&#30331;&#24405;&#30340;&#24773;&#20917;&#19979;&#25165;&#34987;&#28210;&#26579;&#12290;
			&#25105;&#20204;&#21487;&#20197;&#21033;&#29992; <tt class="literal">identity.isLoggedIn()</tt> &#23646;&#24615;&#20687;&#36825;&#26679;&#32534;&#20889;&#65306;
			</p><pre class="programlisting">&lt;h:form class="loginForm" rendered="#{not identity.loggedIn}"&gt;</pre><p>
			&#22914;&#26524;&#29992;&#25143;&#27809;&#26377;&#30331;&#24405;&#65292;&#30331;&#24405;&#34920;&#21333;&#23601;&#28210;&#26579; - &#30446;&#21069;&#20026;&#27490;&#36825;&#36824;&#26159;&#38750;&#24120;&#30452;&#30333;&#26131;&#25026;&#12290;
			&#29616;&#22312;&#20551;&#35774;&#39029;&#38754;&#19978;&#26377;&#19968;&#20010;&#33756;&#21333;&#65292;&#21253;&#21547;&#19968;&#20123;&#24212;&#35813;&#21482;&#23545; <tt class="literal">manager</tt> &#35282;&#33394;&#20013;&#30340;&#29992;&#25143;&#21487;&#29992;&#30340;&#25805;&#20316;&#12290;&#19979;&#38754;&#26159;&#19968;&#31181;&#32534;&#20889;&#26041;&#24335;&#65306;
			</p><pre class="programlisting">&lt;h:outputLink action="#{reports.listManagerReports}" rendered="#{s:hasRole('manager')}"&gt;
    Manager Reports
&lt;/h:outputLink&gt;</pre><p>
			&#36825;&#20063;&#24456;&#23481;&#26131;&#29702;&#35299;&#12290;&#22914;&#26524;&#29992;&#25143;&#19981;&#26159; <tt class="literal">manager</tt> &#35282;&#33394;&#30340;&#19968;&#21592;&#65292;&#37027;&#20040;outputLink&#23601;&#19981;&#28210;&#26579;&#12290;
			<tt class="literal">rendered</tt> &#23646;&#24615;&#26412;&#36523;&#19968;&#33324;&#26469;&#35828;&#21487;&#20197;&#29992;&#22312;&#25511;&#21046;&#65292;&#25110;&#32773;&#21608;&#22260;&#30340; <tt class="literal">&lt;s:div&gt;</tt> &#25110;&#32773; <tt class="literal">&lt;s:span&gt;</tt> &#25511;&#21046;&#19978;&#12290;
			</p><p>
			&#29616;&#22312;&#25506;&#35752;&#19968;&#20123;&#26356;&#22797;&#26434;&#30340;&#19996;&#35199;&#12290;&#25105;&#20204;&#20551;&#35774;&#20320;&#22312;&#39029;&#38754;&#19978;&#26377;&#19968;&#20010; <tt class="literal">h:dataTable</tt> &#25511;&#21046;&#65292;&#35813;&#39029;&#38754;&#32599;&#21015;&#20102;&#21487;&#33021;&#24076;&#26395;&#25110;&#32773;&#19981;&#24076;&#26395;&#26681;&#25454;&#29992;&#25143;&#30340;&#26435;&#38480;&#65292;&#23545;&#20854;&#28210;&#26579;&#21160;&#20316;&#38142;&#25509;&#30340;&#35760;&#24405;&#12290;
			<tt class="literal">s:hasPermission</tt> EL&#20989;&#25968;&#20801;&#35768;&#25105;&#20204;&#20256;&#36827;&#19968;&#20010;&#23545;&#35937;&#21442;&#25968;&#65292;&#23427;&#21487;&#20197;&#29992;&#26469;&#30830;&#23450;&#29992;&#25143;&#26159;&#21542;&#20855;&#26377;&#23545;&#35813;&#23545;&#35937;&#30340;&#24517;&#35201;&#35768;&#21487;&#12290;
			&#19979;&#38754;&#23637;&#29616;&#20102;&#24102;&#26377;&#21463;&#20445;&#25252;&#30340;&#38142;&#25509;&#30340;dataTable&#21487;&#33021;&#26159;&#20160;&#20040;&#26679;&#23376;&#65306;
      </p><pre class="programlisting">&lt;h:dataTable value="#{clients}" var="cl"&gt;
    &lt;h:column&gt;
        &lt;f:facet name="header"&gt;Name&lt;/f:facet&gt;
        #{cl.name}
    &lt;/h:column&gt;
    &lt;h:column&gt;
        &lt;f:facet name="header"&gt;City&lt;/f:facet&gt;
        #{cl.city}
    &lt;/h:column&gt;
    &lt;h:column&gt;
        &lt;f:facet name="header"&gt;Action&lt;/f:facet&gt;
        &lt;s:link value="Modify Client" action="#{clientAction.modify}"
                rendered="#{s:hasPermission('client','modify',cl)"/&gt;
        &lt;s:link value="Delete Client" action="#{clientAction.delete}"
                rendered="#{s:hasPermission('client','delete',cl)"/&gt;
    &lt;/h:column&gt;
&lt;/h:dataTable&gt;</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7723"></a>13.6.4.&nbsp;&#20445;&#25252;&#39029;&#38754;</h3></div></div><div></div></div><p>
			&#39029;&#38754;&#23433;&#20840;&#35201;&#27714;&#24212;&#29992;&#31243;&#24207;&#20351;&#29992; <tt class="literal">pages.xml</tt> &#25991;&#20214;&#65292;&#20294;&#26159;&#37197;&#32622;&#26497;&#20026;&#31616;&#21333;&#12290;
			&#21482;&#35201;&#22312;&#20320;&#24076;&#26395;&#20445;&#25252;&#30340; <tt class="literal">page</tt> &#20803;&#32032;&#20869;&#37096;&#21253;&#25324;&#19968;&#20010; <tt class="literal">&lt;restrict/&gt;</tt> &#20803;&#32032;&#12290;
			&#22914;&#26524;&#27809;&#26377;&#36890;&#36807; <tt class="literal">restrict</tt> &#20803;&#32032;&#25351;&#23450;&#26126;&#30830;&#30340;&#38480;&#21046;&#65292;&#24403;&#32593;&#39029;&#36890;&#36807;non-faces&#65288;GET&#65289;&#30340;&#35831;&#27714;&#34987;&#35775;&#38382;&#26102;&#65292;
			<tt class="literal">/viewId.xhtml:render</tt> &#38544;&#21547;&#30340;&#35768;&#21487;&#23558;&#34987;&#26816;&#26597;&#65292;
			&#24182;&#19988;&#24403;&#32593;&#39029;&#19978;&#20219;&#20309;&#30340;JSF postback&#65288;&#34920;&#21333;&#25552;&#20132;&#65289;&#37117;&#38656;&#35201; <tt class="literal">/viewId.xhtml:restore</tt> &#35768;&#21487;&#12290;
			&#21542;&#21017;&#65292;&#29305;&#23450;&#30340;&#32422;&#26463;&#23558;&#20316;&#20026;&#19968;&#20010;&#26631;&#20934;&#30340;&#23433;&#20840;&#34920;&#36798;&#24335;&#36827;&#34892;&#21462;&#20540;&#12290;&#19979;&#38754;&#26377;&#20960;&#20010;&#20363;&#23376;&#65306;
			</p><pre class="programlisting">&lt;page view-id="/settings.xhtml"&gt;
    &lt;restrict/&gt;
&lt;/page&gt;</pre><p>
			&#26412;&#39029;&#38754;&#24050;&#32463;&#38544;&#21547;&#20102; <tt class="literal">/settings.xhtml:render</tt> &#25152;&#38656;&#30340;non-faces&#35831;&#27714;&#30340;&#35768;&#21487;&#65292;
			&#24182;&#38544;&#21547;&#20102; <tt class="literal">/settings.xhtml:restore</tt> &#25152;&#38656;&#30340;faces&#35831;&#27714;&#30340;&#35768;&#21487;&#12290;
			</p><pre class="programlisting">&lt;page view-id="/reports.xhtml"&gt;
    &lt;restrict&gt;#{s:hasRole('admin')}&lt;/restrict&gt;
&lt;/page&gt;</pre><p>
			&#36825;&#20010;&#39029;&#38754;&#30340;faces&#21644;non-faces&#35831;&#27714;&#65292;&#37117;&#38656;&#35201;&#29992;&#25143;&#26159; <tt class="literal">admin</tt> &#35282;&#33394;&#30340;&#19968;&#20010;&#25104;&#21592;&#12290;
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7763"></a>13.6.5.&nbsp;&#20445;&#25252;&#23454;&#20307;</h3></div></div><div></div></div><p>
			Seam Security&#20063;&#20351;&#24471;&#23545;&#23454;&#20307;&#30340;&#35835;&#21462;&#12289;&#25554;&#20837;&#12289;&#26356;&#26032;&#21644;&#21024;&#38500;&#21160;&#20316;&#24212;&#29992;&#23433;&#20840;&#38480;&#21046;&#25104;&#20026;&#21487;&#33021;&#12290;
			</p><p>
			&#20026;&#20102;&#20445;&#25252;&#19968;&#20010;&#23454;&#20307;&#31867;&#30340;&#25152;&#26377;&#21160;&#20316;&#65292;&#22312;&#31867;&#33258;&#36523;&#19978;&#28155;&#21152;&#19968;&#20010; <tt class="literal">@Restrict</tt> &#27880;&#35299;&#65306;
			</p><pre class="programlisting">@Entity
@Name("customer")
@Restrict
public class Customer {
  ...
}</pre><p>
			&#22914;&#26524;&#27809;&#26377;&#22312; <tt class="literal">@Restrict</tt> &#27880;&#35299;&#20013;&#25351;&#23450;&#20219;&#20309;&#34920;&#36798;&#24335;&#65292;&#25191;&#34892;&#30340;&#40664;&#35748;&#23433;&#20840;&#26816;&#26597;&#23601;&#26159; <tt class="literal">entityName:action</tt> &#30340;&#35768;&#21487;&#26816;&#26597;&#65292;
			&#22312;&#36825;&#37324;&#65292;<tt class="literal">entityName</tt> &#26159;&#23454;&#20307;&#30340;Seam&#32452;&#20214;&#21517;&#65288;&#25110;&#32773;&#22914;&#26524;&#25351;&#23450;&#20102;@Name&#65292;&#21017;&#26159;&#23436;&#20840;&#21305;&#37197;&#30340;&#31867;&#21517;&#65289;&#65292;&#24182;&#19988; <tt class="literal">action</tt> &#21487;&#20197;&#26159; <tt class="literal">read</tt>&#12289;<tt class="literal">insert</tt>&#12289;<tt class="literal">update</tt> &#25110;&#32773; <tt class="literal">delete</tt>&#12290;
			</p><p>
			&#20063;&#21487;&#33021;&#36890;&#36807;&#25226;<tt class="literal">@Restrict</tt>&#27880;&#35299;&#25918;&#22312;&#30456;&#20851;&#30340;&#23454;&#20307;&#29983;&#21629;&#21608;&#26399;&#30340;&#26041;&#27861;&#19978;&#65288;&#34987;&#27880;&#35299;&#22914;&#19979;&#65289;&#65292;&#32780;&#21482;&#38480;&#21046;&#26576;&#20123;&#21160;&#20316;&#65306;
			</p><div class="itemizedlist"><ul type="disc"><li><p>
						<tt class="literal">@PostLoad</tt> - &#22312;&#23454;&#20307;&#23454;&#20363;&#20174;&#25968;&#25454;&#24211;&#20013;&#21152;&#36733;&#20043;&#21518;&#35843;&#29992;&#12290;&#29992;&#36825;&#20010;&#26041;&#27861;&#37197;&#32622;&#19968;&#20010; <tt class="literal">read</tt> &#35768;&#21487;&#12290;
					</p></li><li><p>
						<tt class="literal">@PrePersist</tt> - &#22312;&#25554;&#20837;&#23454;&#20307;&#30340;&#19968;&#20010;&#26032;&#23454;&#20363;&#20043;&#21069;&#35843;&#29992;&#12290;&#29992;&#36825;&#20010;&#26041;&#27861;&#37197;&#32622;&#19968;&#20010; <tt class="literal">insert</tt> &#35768;&#21487;&#12290;
					</p></li><li><p>
						<tt class="literal">@PreUpdate</tt> - &#22312;&#23454;&#20307;&#26356;&#26032;&#20043;&#21069;&#35843;&#29992;&#12290;&#29992;&#36825;&#20010;&#26041;&#27861;&#37197;&#32622;&#19968;&#20010; <tt class="literal">update</tt> &#35768;&#21487;&#12290;
					</p></li><li><p>
						<tt class="literal">@PreRemove</tt> - &#22312;&#23454;&#20307;&#21024;&#38500;&#20043;&#21069;&#35843;&#29992;&#12290;&#29992;&#36825;&#20010;&#26041;&#27861;&#37197;&#32622;&#19968;&#20010;<tt class="literal">delete</tt>&#35768;&#21487;&#12290;
					</p></li></ul></div><p>
			&#36825;&#37324;&#26377;&#19968;&#20010;&#20363;&#23376;&#65292;&#35828;&#26126;&#23454;&#20307;&#26041;&#27861;&#22914;&#20309;&#37197;&#32622;&#25104;&#32473;&#20219;&#20309; <tt class="literal">insert</tt> &#25805;&#20316;&#25191;&#34892;&#23433;&#20840;&#26816;&#26597;&#12290;
			&#35831;&#27880;&#24847;&#19981;&#38656;&#35201;&#26041;&#27861;&#21435;&#20570;&#20219;&#20309;&#20107;&#24773;&#65292;&#26377;&#20851;&#23433;&#20840;&#30340;&#21807;&#19968;&#37325;&#35201;&#30340;&#19996;&#35199;&#26159;&#23427;&#22914;&#20309;&#34987;&#27880;&#35299;&#65306;
			</p><pre class="programlisting">
  @PrePersist @Restrict
  public void prePersist() {}
   </pre><p>
			&#36825;&#37324;&#36824;&#26377;&#19968;&#20010;&#20363;&#23376;&#65292;&#35828;&#26126;&#23454;&#20307;&#35768;&#21487;&#35268;&#21017;&#26816;&#26597;&#34987;&#39564;&#35777;&#30340;&#29992;&#25143;&#26159;&#21542;&#34987;&#20801;&#35768;&#65288;&#20174;seamspace&#20363;&#23376;&#20013;&#65289;&#25554;&#20837;&#26032;&#30340; <tt class="literal">MemberBlog</tt> &#35760;&#24405;&#12290;
			&#27491;&#22312;&#36827;&#34892;&#23433;&#20840;&#26816;&#26597;&#30340;&#23454;&#20307;&#65292;&#34987;&#33258;&#21160;&#26029;&#35328;&#21040;&#24037;&#20316;&#20869;&#23384;&#20013;&#65288;&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#26159; <tt class="literal">MemberBlog</tt>&#65289;&#65306;
			</p><pre class="programlisting">rule InsertMemberBlog
  no-loop
  activation-group "permissions"
when
  check: PermissionCheck(name == "memberBlog", action == "insert", granted == false)
  Principal(principalName : name)
  MemberBlog(member : member -&gt; (member.getUsername().equals(principalName)))
then
  check.grant();
end;</pre><p>
			&#36825;&#20010;&#35268;&#21017;&#23558;&#25480;&#19982;&#35768;&#21487; <tt class="literal">memberBlog:insert</tt>&#65292;&#22914;&#26524;&#24403;&#21069;&#34987;&#39564;&#35777;&#30340;&#29992;&#25143;&#65288;&#30001; <tt class="literal">Principal</tt> fact&#34920;&#26126;&#65289;&#26377;&#30528;&#19982;&#27491;&#22312;&#20026;&#20854;&#21019;&#24314;Blog&#39033;&#30340;&#19968;&#26679;&#30340;&#25104;&#21592;&#12290;
			&#21487;&#20197;&#22312; <tt class="literal">Principal</tt> fact&#65288;&#21644;&#20854;&#23427;&#22320;&#26041;&#65289;&#20013;&#35265;&#21040;&#30340;&#8220;<tt class="literal">name : name</tt>&#8221;&#32467;&#26500;&#26159;&#19968;&#20010;&#21464;&#37327;&#32465;&#23450; - &#23427;&#25226; <tt class="literal">Principal</tt>&#30340; <tt class="literal">name</tt> &#23646;&#24615;&#32465;&#23450;&#21040;&#19968;&#20010;&#20855;&#21517; <tt class="literal">name</tt> &#30340;&#21464;&#37327;&#19978;&#12290;
			&#21464;&#37327;&#32465;&#23450;&#20801;&#35768;&#20540;&#22312;&#20854;&#23427;&#22320;&#26041;&#34987;&#24341;&#29992;&#65292;&#20363;&#22914;&#19979;&#38754;&#30340;&#34892;&#25226;&#25104;&#21592;&#30340;&#29992;&#25143;&#21517;&#19982; <tt class="literal">Principal</tt> &#21517;&#31216;&#36827;&#34892;&#27604;&#36739;&#12290;
			&#24819;&#20102;&#35299;&#26356;&#22810;&#32454;&#33410;&#65292;&#35831;&#21442;&#32771;JBoss Rules&#25991;&#26723;&#12290;
			</p><p>
			&#26368;&#21518;&#65292;&#38656;&#35201;&#23433;&#35013;&#19968;&#20010;&#30417;&#21548;&#22120;&#31867;&#65292;&#25226;Seam Security&#19982;&#20320;&#30340;JPA&#25552;&#20379;&#32773;&#25972;&#21512;&#36215;&#26469;&#12290;
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7888"></a>13.6.5.1.&nbsp;&#20351;&#29992;JPA&#30340;&#23454;&#20307;&#23433;&#20840;</h4></div></div><div></div></div><p>
				&#23545;EJB3&#23454;&#20307;Bean&#30340;&#23433;&#20840;&#26816;&#26597;&#36890;&#36807;&#19968;&#20010; <tt class="literal">EntityListener</tt> &#25191;&#34892;&#26469;&#23436;&#25104;&#30340;&#12290;
				&#20320;&#21487;&#20197;&#21033;&#29992;&#19979;&#21015; <tt class="literal">META-INF/orm.xml</tt> &#25991;&#20214;&#23433;&#35013;&#36825;&#20010;&#30417;&#21548;&#22120;&#65306;
				</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;entity-mappings xmlns="http://java.sun.com/xml/ns/persistence/orm"
                 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                 xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm http://java.sun.com/xml/ns/persistence/orm_1_0.xsd"
                 version="1.0"&gt;

    &lt;persistence-unit-metadata&gt;
        &lt;persistence-unit-defaults&gt;
            &lt;entity-listeners&gt;
                &lt;entity-listener class="org.jboss.seam.security.EntitySecurityListener"/&gt;
            &lt;/entity-listeners&gt;
        &lt;/persistence-unit-defaults&gt;
    &lt;/persistence-unit-metadata&gt;

&lt;/entity-mappings&gt;</pre></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e7901"></a>13.6.5.2.&nbsp;&#20351;&#29992;Hibernate&#30340;&#23454;&#20307;&#23433;&#20840;</h4></div></div><div></div></div><p>
				&#22914;&#26524;&#20320;&#27491;&#22312;&#20351;&#29992;&#19968;&#20010;&#32463;&#30001;Seam&#37197;&#32622;&#30340;Hibernate <tt class="literal">SessionFactory</tt>&#65292;&#20351;&#29992;&#23454;&#20307;&#23433;&#20840;&#23601;&#19981;&#38656;&#35201;&#20570;&#20219;&#20309;&#29305;&#21035;&#30340;&#20107;&#24773;&#12290;
				</p></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e7909"></a>13.7.&nbsp;&#32534;&#20889;&#23433;&#20840;&#35268;&#21017;</h2></div></div><div></div></div><p>
		&#36804;&#20170;&#20026;&#27490;&#65292;&#25105;&#20204;&#24050;&#32463;&#25552;&#21040;&#20102;&#35768;&#22810;&#35768;&#21487;&#65292;&#20294;&#26159;&#27809;&#26377;&#25552;&#21450;&#35768;&#21487;&#20107;&#23454;&#19978;&#22914;&#20309;&#23450;&#20041;&#25110;&#32773;&#25480;&#19982;&#12290;
		&#26412;&#33410;&#23558;&#23545;&#27492;&#36827;&#34892;&#38416;&#36848;&#65292;&#35299;&#37322;&#35768;&#21487;&#26816;&#26597;&#22914;&#20309;&#36827;&#34892;&#65292;&#20197;&#21450;&#22914;&#20309;&#32473;&#19968;&#20010;Seam&#24212;&#29992;&#31243;&#24207;&#23454;&#29616;&#35768;&#21487;&#26816;&#26597;&#12290;
		</p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7914"></a>13.7.1.&nbsp;&#35768;&#21487;&#27010;&#36848;</h3></div></div><div></div></div><p>
			Security API&#22914;&#20309;&#30693;&#36947;&#29992;&#25143;&#26159;&#21542;&#20855;&#26377;&#23545;&#19968;&#20010;&#29305;&#23450;&#23458;&#25143;&#30340; <tt class="literal">customer:modify</tt> &#35768;&#21487;&#65311;
			Seam Security&#25552;&#20379;&#19968;&#31181;&#26032;&#22855;&#30340;&#26041;&#27861;&#65292;&#26681;&#25454;JBoss Rules&#30830;&#23450;&#29992;&#25143;&#35768;&#21487;&#12290;
			&#20351;&#29992;&#35268;&#21017;&#24341;&#25806;&#30340;&#20004;&#20010;&#22909;&#22788;&#22312;&#20110;&#65306;1&#65289;&#23427;&#26159;&#27599;&#20010;&#29992;&#25143;&#35768;&#21487;&#32972;&#21518;&#30340;&#19994;&#21153;&#36923;&#36753;&#30340;&#19968;&#20010;&#38598;&#20013;&#20301;&#32622;&#65292;
			2&#65289;&#36895;&#24230; - JBoss Rules&#20351;&#29992;&#38750;&#24120;&#26377;&#25928;&#30340;&#31639;&#27861;&#65292;&#29992;&#26469;&#32473;&#28041;&#21450;&#22810;&#20010;&#26465;&#20214;&#30340;&#22823;&#37327;&#22797;&#26434;&#35268;&#21017;&#21462;&#20540;&#12290;
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7922"></a>13.7.2.&nbsp;&#37197;&#32622;&#35268;&#21017;&#25991;&#20214;</h3></div></div><div></div></div><p>
			Seam Security&#24076;&#26395;&#25214;&#21040;&#19968;&#20010;&#31216;&#20316; <tt class="literal">securityRules</tt> &#30340; <tt class="literal">RuleBase</tt> &#32452;&#20214;&#65292;Seam Security&#29992;&#23427;&#26469;&#32473;&#35768;&#21487;&#26816;&#26597;&#21462;&#20540;&#12290;
			&#36825;&#22312; <tt class="literal">components.xml</tt> &#20013;&#37197;&#32622;&#22914;&#19979;&#65306;
			</p><pre class="programlisting">&lt;components xmlns="http://jboss.com/products/seam/components"
            xmlns:core="http://jboss.com/products/seam/core"
            xmlns:security="http://jboss.com/products/seam/security"
            xmlns:drools="http://jboss.com/products/seam/drools"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            xsi:schemaLocation=
                "http://jboss.com/products/seam/core http://jboss.com/products/seam/core-2.0.xsd
                 http://jboss.com/products/seam/components http://jboss.com/products/seam/components-2.0.xsd
                 http://jboss.com/products/seam/drools http://jboss.com/products/seam/drools-2.0.xsd"
                 http://jboss.com/products/seam/security http://jboss.com/products/seam/security-2.0.xsd"&gt;

   &lt;drools:rule-base name="securityRules"&gt;
       &lt;drools:rule-files&gt;
           &lt;value&gt;/META-INF/security.drl&lt;/value&gt;
       &lt;/drools:rule-files&gt;
   &lt;/drools:rule-base&gt;

&lt;/components&gt;</pre><p>
			&#19968;&#26086;&#37197;&#32622;&#20102; <tt class="literal">RuleBase</tt> &#32452;&#20214;&#65292;&#23601;&#21487;&#20197;&#32534;&#20889;&#23433;&#20840;&#35268;&#21017;&#20102;&#12290;
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e7943"></a>13.7.3.&nbsp;&#21019;&#24314;&#23433;&#20840;&#35268;&#21017;&#25991;&#20214;</h3></div></div><div></div></div><p>
			&#23545;&#20110;&#36825;&#20010;&#27493;&#39588;&#65292;&#35201;&#22312;&#24212;&#29992;&#31243;&#24207;&#30340;jar&#25991;&#20214;&#30340; <tt class="literal">/META-INF</tt> &#30446;&#24405;&#20013;&#21019;&#24314;&#19968;&#20010;&#21517;&#20026; <tt class="literal">security.drl</tt> &#30340;&#25991;&#20214;&#12290;
			&#20107;&#23454;&#19978;&#65292;&#36825;&#20010;&#25991;&#20214;&#21487;&#20197;&#21629;&#21517;&#20026;&#20320;&#21916;&#27426;&#30340;&#20219;&#20309;&#21517;&#23383;&#65292;&#24182;&#23384;&#22312;&#20110;&#20219;&#20309;&#20301;&#32622;&#65292;&#21482;&#35201;&#23427;&#22312; <tt class="literal">components.xml</tt> &#20013;&#36827;&#34892;&#20102;&#36866;&#24403;&#30340;&#37197;&#32622;&#12290;
			</p><p>
			&#37027;&#20040;&#23433;&#20840;&#35268;&#21017;&#25991;&#20214;&#24212;&#35813;&#21253;&#21547;&#20160;&#20040;&#21602;&#65311;&#30446;&#21069;&#65292;&#33267;&#23569;&#27983;&#35272;&#19968;&#19979;JBoss Rules&#25991;&#26723;&#21487;&#33021;&#26159;&#20010;&#22909;&#20027;&#24847;&#65292;&#20294;&#26159;&#36825;&#37324;&#20171;&#32461;&#30340;&#26159;&#19968;&#20010;&#26497;&#20026;&#31616;&#21333;&#30340;&#20363;&#23376;&#65306;
			</p><pre class="programlisting">package MyApplicationPermissions;

import org.jboss.seam.security.PermissionCheck;
import org.jboss.seam.security.Role;

rule CanUserDeleteCustomers
when
  c: PermissionCheck(name == "customer", action == "delete")
  Role(name == "admin")
then
  c.grant();
end;</pre><p>
			&#25105;&#20204;&#26469;&#20998;&#35299;&#19968;&#19979;&#12290;&#25105;&#20204;&#35265;&#21040;&#30340;&#31532;&#19968;&#20010;&#19996;&#35199;&#26159;&#21253;&#22768;&#26126;&#12290;&#21253;&#22312;JBoss Rules&#20013;&#22522;&#26412;&#19978;&#26159;&#19968;&#20010;&#35268;&#21017;&#30340;&#38598;&#21512;&#12290;
			&#21253;&#21517;&#21487;&#20197;&#26159;&#20320;&#21916;&#27426;&#30340;&#20219;&#20309;&#21517;&#31216; &#65293; &#23427;&#19981;&#24433;&#21709;&#35268;&#21017;&#22522;&#30784;&#33539;&#22260;&#20043;&#22806;&#30340;&#20219;&#20309;&#20854;&#23427;&#19996;&#35199;&#12290;
			</p><p>
			&#28982;&#21518;&#65292;&#25105;&#20204;&#21487;&#33021;&#27880;&#24847;&#21040;&#20108;&#20010;&#23545; <tt class="literal">PermissionCheck</tt> &#21644; <tt class="literal">Role</tt> &#31867;&#30340;&#23548;&#20837;&#35821;&#21477;&#12290;
			&#36825;&#20123;&#23548;&#20837;&#36890;&#30693;&#35268;&#21017;&#24341;&#25806;&#25105;&#20204;&#23558;&#22312;&#35268;&#21017;&#20013;&#24341;&#29992;&#36825;&#20123;&#31867;&#12290;
			</p><p>
			&#26368;&#21518;&#26159;&#35268;&#21017;&#30340;&#20195;&#30721;&#12290;&#21253;&#20013;&#30340;&#27599;&#19968;&#20010;&#35268;&#21017;&#37117;&#24212;&#35813;&#26377;&#19968;&#20010;&#21807;&#19968;&#30340;&#21517;&#31216;&#65288;&#19968;&#33324;&#25551;&#36848;&#35268;&#21017;&#30340;&#30446;&#30340;&#65289;&#12290;
			&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#65292;&#25105;&#20204;&#30340;&#35268;&#21017;&#31216;&#20316; <tt class="literal">CanUserDeleteCustomers</tt>&#65292;&#29992;&#26469;&#26816;&#26597;&#29992;&#25143;&#26159;&#21542;&#34987;&#20801;&#35768;&#21024;&#38500;&#19968;&#20010;&#23458;&#25143;&#35760;&#24405;&#12290;
			</p><p>
			&#30475;&#30475;&#35268;&#21017;&#23450;&#20041;&#30340;&#20027;&#20307;&#65292;&#21487;&#20197;&#21457;&#29616;&#20004;&#20010;&#29420;&#29305;&#30340;&#37096;&#20998;&#12290;&#35268;&#21017;&#26377;&#31216;&#20026;LHS(&#24038;&#25163;&#36793;&#65289;&#21644;RHS&#65288;&#21491;&#25163;&#36793;&#65289;&#30340;&#19996;&#35199;&#12290;
			LHS&#30001;&#35268;&#21017;&#30340;&#26465;&#20214;&#37096;&#20998;&#32452;&#25104;&#65292;&#22914;&#24517;&#39035;&#28385;&#36275;&#35268;&#21017;&#20197;&#20415;&#35302;&#21457;&#30340;&#19968;&#31995;&#21015;&#26465;&#20214;&#12290;
			LHS&#30001; <tt class="literal">when</tt> &#37096;&#20998;&#34920;&#31034;&#12290;RHS&#26159;&#32467;&#26524;&#65292;&#25110;&#32773;&#26159;&#35268;&#21017;&#30340;&#21160;&#20316;&#37096;&#20998;&#65292;&#35813;&#35268;&#21017;&#21482;&#22312;&#28385;&#36275;LHS&#30340;&#25152;&#26377;&#26465;&#20214;&#26102;&#25165;&#35302;&#21457;&#12290;
			RHS&#30001; <tt class="literal">then</tt> &#37096;&#20998;&#32452;&#25104;&#12290;&#35268;&#21017;&#30340;&#26411;&#31471;&#29992; <tt class="literal">end;</tt> &#32447;&#34920;&#31034;&#12290;
			</p><p>
			&#22914;&#26524;&#30475;&#30475;&#35268;&#21017;&#30340;LHS&#65292;&#23601;&#21487;&#35265;&#21040;&#37027;&#37324;&#21015;&#20986;&#20102;&#20004;&#20010;&#26465;&#20214;&#12290;&#25105;&#20204;&#20808;&#26469;&#26816;&#39564;&#31532;&#19968;&#20010;&#26465;&#20214;&#65306;
			</p><pre class="programlisting">c: PermissionCheck(name == "customer", action == "delete")</pre><p>
			&#35828;&#24471;&#36890;&#20439;&#20123;&#65292;&#36825;&#20010;&#26465;&#20214;&#22768;&#26126;&#24037;&#20316;&#20869;&#23384;&#20013;&#24517;&#39035;&#23384;&#22312;&#19968;&#20010; <tt class="literal">PermissionCheck</tt> &#23545;&#35937;&#65292;&#23427;&#20855;&#26377;&#19982;"customer"&#30456;&#24403;&#30340; <tt class="literal">name</tt> &#23646;&#24615;&#65292;&#20197;&#21450;&#19982;"delete"&#30456;&#24403;&#30340; <tt class="literal">action</tt> &#23646;&#24615;&#12290;
			&#20160;&#20040;&#26159;&#24037;&#20316;&#20869;&#23384;&#65311;&#23427;&#26159;&#20010;&#20250;&#35805;&#33539;&#22260;&#30340;&#23545;&#35937;&#65292;&#21253;&#21547;&#35268;&#21017;&#24341;&#25806;&#36827;&#34892;&#26377;&#20851;&#35768;&#21487;&#26816;&#26597;&#20915;&#31574;&#26102;&#25152;&#38656;&#30340;&#19978;&#19979;&#25991;&#20449;&#24687;&#12290;
			&#27599;&#27425;&#35843;&#29992; <tt class="literal">hasPermission()</tt> &#26041;&#27861;&#26102;&#65292;&#19968;&#20010;&#20020;&#26102;&#30340; <tt class="literal">PermissionCheck</tt> &#23545;&#35937;&#25110;&#32773; <span class="emphasis"><em>Fact</em></span> &#23601;&#34987;&#26029;&#35328;&#21040;&#24037;&#20316;&#20869;&#23384;&#20013;&#12290;
			&#36825;&#20010; <tt class="literal">PermissionCheck</tt> &#27491;&#22909;&#23545;&#24212;&#20110;&#27491;&#34987;&#26816;&#26597;&#30340;&#35768;&#21487;&#65292;&#22240;&#27492;&#65292;&#20363;&#22914;&#22914;&#26524;&#35843;&#29992; <tt class="literal">hasPermission("account", "create", null)</tt>&#65292;&#37027;&#20040;&#24102;&#26377;&#30456;&#24403;&#20110;"account"&#30340; <tt class="literal">name</tt> &#21644;&#30456;&#24403;&#20110;"create"&#30340; <tt class="literal">action</tt> &#30340; <tt class="literal">PermissionCheck</tt> &#23545;&#35937;&#65292;&#23601;&#23558;&#22312;&#35768;&#21487;&#26816;&#26597;&#25345;&#32493;&#26399;&#38388;&#34987;&#26029;&#35328;&#21040;&#24037;&#20316;&#20869;&#23384;&#12290;
			</p><p>
			&#24037;&#20316;&#20869;&#23384;&#20013;&#36824;&#26377;&#20160;&#20040;&#20854;&#23427;&#30340;&#19996;&#35199;&#65311;
			&#38500;&#20102;&#22312;&#35768;&#21487;&#26816;&#26597;&#26399;&#38388;&#26029;&#35328;&#30340;&#30701;&#26399;&#20020;&#26102;fact&#34987;&#25554;&#20837;&#20043;&#22806;&#65292;&#24037;&#20316;&#20869;&#23384;&#20013;&#36824;&#26377;&#19968;&#20123;&#38271;&#26399;&#30340;&#23545;&#35937;&#65292;&#22312;&#29992;&#25143;&#39564;&#35777;&#30340;&#25972;&#20010;&#25345;&#32493;&#26399;&#38388;&#37117;&#20445;&#30041;&#22312;&#37027;&#12290;
			&#36825;&#20123;&#21253;&#25324;&#20316;&#20026;&#39564;&#35777;&#36807;&#31243;&#19968;&#37096;&#20998;&#32780;&#21019;&#24314;&#30340;&#20219;&#20309; <tt class="literal">java.security.Principal</tt> &#23545;&#35937;&#65292;
			&#36824;&#21253;&#25324;&#29992;&#25143;&#25152;&#23646;&#35282;&#33394;&#20013;&#30340;&#27599;&#19968;&#20010;&#35282;&#33394;&#30340; <tt class="literal">org.jboss.seam.security.Role</tt>&#12290;
			&#36890;&#36807;&#35843;&#29992; <tt class="literal">((RuleBasedIdentity) RuleBasedIdentity.instance()).getSecurityContext().insert()</tt>&#65292;
			&#20063;&#21487;&#33021;&#26029;&#35328;&#39069;&#22806;&#30340;&#38271;&#26399;fact&#21040;&#24037;&#20316;&#20869;&#23384;&#20013;&#65292;&#25226;&#23545;&#35937;&#24403;&#20316;&#21442;&#25968;&#20256;&#36882;&#12290;
			</p><p>
			&#22238;&#21040;&#25105;&#20204;&#30340;&#31616;&#21333;&#20363;&#23376;&#19978;&#26469;&#65292;&#20063;&#20250;&#27880;&#24847;&#21040;&#25105;&#20204;LHS&#30340;&#31532;&#19968;&#34892;&#21152;&#19978;&#20102; <tt class="literal">c:</tt> &#30340;&#21069;&#32512;&#12290;
			&#36825;&#26159;&#20010;&#21464;&#37327;&#32465;&#23450;&#65292;&#29992;&#26469;&#25351;&#22238;&#21040;&#31526;&#21512;&#26465;&#20214;&#30340;&#23545;&#35937;&#12290;&#31227;&#21040;LHS&#30340;&#31532;&#20108;&#34892;&#65292;&#20250;&#30475;&#21040;&#65306;
			</p><pre class="programlisting">Role(name == "admin")</pre><p>
			&#36825;&#20010;&#26465;&#20214;&#21482;&#22768;&#26126;&#24037;&#20316;&#20869;&#23384;&#20013;&#24517;&#39035;&#26377; <tt class="literal">Role</tt> &#23545;&#35937;&#24102;&#26377;"admin"&#30340; <tt class="literal">name</tt>&#12290;
			&#22914;&#21069;&#25152;&#36848;&#65292;&#29992;&#25143;&#35282;&#33394;&#34987;&#20316;&#20026;&#38271;&#26399;fact&#26029;&#35328;&#21040;&#24037;&#20316;&#20869;&#23384;&#20013;&#12290;
			&#22240;&#27492;&#65292;&#25226;&#20004;&#20010;&#26465;&#20214;&#25918;&#22312;&#19968;&#36215;&#65292;&#36825;&#20010;&#35268;&#21017;&#22522;&#26412;&#19978;&#31561;&#20110;&#22312;&#35828;&#65306;
			&#8220;&#22914;&#26524;&#20320;&#26816;&#26597; <tt class="literal">customer:delete</tt> &#35768;&#21487;&#65292;&#24182;&#19988;&#29992;&#25143;&#26159; <tt class="literal">admin</tt> &#35282;&#33394;&#30340;&#19968;&#21592;&#26102;&#65292;&#25105;&#23558;&#20250;&#35302;&#21457;&#12290;&#8221;
			</p><p>
			&#37027;&#20040;&#35268;&#21017;&#35302;&#21457;&#30340;&#32467;&#26524;&#20250;&#24590;&#26679;&#65311;&#25105;&#20204;&#26469;&#30475;&#30475;&#35268;&#21017;&#30340;RHS&#65306;
			</p><pre class="programlisting">c.grant()</pre><p>
			RHS&#30001;Java&#20195;&#30721;&#32452;&#25104;&#65292;&#22312;&#36825;&#20010;&#20363;&#23376;&#20013;&#26159;&#35843;&#29992; <tt class="literal">c</tt> &#23545;&#35937;&#30340; <tt class="literal">grant()</tt> &#26041;&#27861;&#65292;
			&#22914;&#21069;&#38754;&#25552;&#21040;&#36807;&#30340;&#65292;&#23427;&#26159;&#20010;&#23545; <tt class="literal">PermissionCheck</tt> &#23545;&#35937;&#30340;&#21464;&#37327;&#32465;&#23450;&#12290;
			&#38500;&#20102; <tt class="literal">PermissionCheck</tt> &#23545;&#35937;&#30340; <tt class="literal">name</tt> &#21644; <tt class="literal">action</tt> &#23646;&#24615;&#20043;&#22806;&#65292;
			&#20063;&#26377;&#19968;&#20010; <tt class="literal">granted</tt> &#23646;&#24615;&#65292;&#23427;&#30340;&#21021;&#22987;&#20540;&#35774;&#32622;&#20026; <tt class="literal">false</tt>&#12290;
			&#22312; <tt class="literal">PermissionCheck</tt> &#19978;&#35843;&#29992; <tt class="literal">grant()</tt> &#26041;&#27861;&#65292;
			&#35774;&#32622; <tt class="literal">granted</tt> &#23646;&#24615;&#20026; <tt class="literal">true</tt>&#65292;&#36825;&#24847;&#21619;&#30528;&#35768;&#21487;&#26816;&#26597;&#25104;&#21151;&#20102;&#65292;&#20801;&#35768;&#29992;&#25143;&#25191;&#34892;&#35768;&#21487;&#26816;&#26597;&#39044;&#23450;&#30340;&#20219;&#20309;&#21160;&#20316;&#12290;
			</p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e8100"></a>13.7.3.1.&nbsp;&#36890;&#37197;&#31526;&#35768;&#21487;&#26816;&#26597;</h4></div></div><div></div></div><p>
				&#36890;&#36807;&#22312;&#35268;&#21017;&#20013;&#32473; <tt class="literal">PermissionCheck</tt> &#21024;&#38500; <tt class="literal">action</tt> &#32422;&#26463;&#65292;
				&#21487;&#33021;&#23454;&#29616;&#36890;&#37197;&#31526;&#35768;&#21487;&#26816;&#26597;&#65288;&#23545;&#19968;&#20010;&#25351;&#23450;&#30340;&#35768;&#21487;&#21517;&#31216;&#20801;&#35768;&#25152;&#26377;&#21160;&#20316;&#65289;&#65292;&#20687;&#36825;&#26679;&#65306;
				</p><pre class="programlisting">rule CanDoAnythingToCustomersIfYouAreAnAdmin
when
  c: PermissionCheck(name == "customer")
  Role(name == "admin")
then
  c.grant();
end;
        </pre><p>
				&#36825;&#20010;&#35268;&#21017;&#20801;&#35768;&#24102;&#26377; <tt class="literal">admin</tt> &#35282;&#33394;&#30340;&#29992;&#25143;&#23545;&#20219;&#20309; <tt class="literal">customer</tt> &#35768;&#21487;&#26816;&#26597;&#25191;&#34892;&#20219;&#20309;&#25805;&#20316;&#12290;
				</p></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8121"></a>13.8.&nbsp;SSL&#23433;&#20840;</h2></div></div><div></div></div><p>
		Seam&#21253;&#25324;&#23545;&#36890;&#36807;HTTPS&#21327;&#35758;&#25552;&#20379;&#25935;&#24863;&#30340;&#39029;&#38754;&#30340;&#22522;&#26412;&#25903;&#25345;&#12290;
		&#36825;&#24456;&#23481;&#26131;&#36890;&#36807;&#22312; <tt class="literal">pages.xml</tt> &#20013;&#32473;&#39029;&#38754;&#25351;&#23450; <tt class="literal">scheme</tt> &#32780;&#37197;&#32622;&#12290;
		&#19979;&#21015;&#20363;&#23376;&#35828;&#26126;&#35270;&#22270; <tt class="literal">/login.xhtml</tt> &#22914;&#20309;&#37197;&#32622;&#20026;&#20351;&#29992;HTTPS&#65306;
		</p><pre class="programlisting">&lt;page view-id="/login.xhtml" scheme="https"&gt;</pre><p>
		&#36825;&#20010;&#37197;&#32622;&#33258;&#21160;&#25193;&#23637;&#20026; <tt class="literal">s:link</tt> &#21644; <tt class="literal">s:button</tt> JSF&#25511;&#21046;&#65292;&#23427;&#65288;&#22312;&#25351;&#23450; <tt class="literal">view</tt> &#26102;&#65289;&#36824;&#23558;&#28210;&#26579;&#20351;&#29992;&#20102;&#27491;&#30830;&#21327;&#35758;&#30340;&#38142;&#25509;&#12290;&#22312;&#21069;&#19968;&#20010;&#20363;&#23376;&#30340;&#22522;&#30784;&#19978;&#65292;&#19979;&#21015;&#38142;&#25509;&#23558;&#20351;&#29992;HTTPS&#21327;&#35758;&#65292;&#22240;&#20026; <tt class="literal">/login.xhtml</tt> &#37197;&#32622;&#20026;&#20351;&#29992;HTTPS&#65306;
		</p><pre class="programlisting">&lt;s:link view="/login.xhtml" value="Login"/&gt;</pre><p>
		&#20351;&#29992; <span class="emphasis"><em>&#38169;&#35823;</em></span> &#21327;&#35758;&#26102;&#65292;&#30452;&#25509;&#27983;&#35272;&#35270;&#22270;&#23558;&#23548;&#33268;&#37325;&#23450;&#21521;&#21040;&#19982;&#20351;&#29992; <span class="emphasis"><em>&#27491;&#30830;</em></span> &#21327;&#35758;&#19968;&#26679;&#30340;&#35270;&#22270;&#12290;
		&#20363;&#22914;&#65292;&#27983;&#35272;&#19968;&#20010;&#35753; <tt class="literal">scheme="https"</tt> &#20351;&#29992;HTTP&#30340;&#39029;&#38754;&#26102;&#65292;&#23558;&#37325;&#23450;&#21521;&#21040;&#19982;&#20351;&#29992;HTTPS&#19968;&#26679;&#30340;&#39029;&#38754;&#12290;
		</p><p>
		&#20063;&#21487;&#33021;&#32473;&#25152;&#26377;&#39029;&#38754;&#37197;&#32622;&#19968;&#20010; <tt class="literal">&#40664;&#35748;&#30340;scheme</tt>&#12290;&#36825;&#20107;&#23454;&#19978;&#30456;&#24403;&#37325;&#35201;&#65292;&#23601;&#20687;&#20320;&#21487;&#33021;&#21482;&#24076;&#26395;&#32473;&#19968;&#20123;&#39029;&#38754;&#20351;&#29992;HTTPS&#19968;&#26679;&#12290;
		&#22914;&#26524;&#27809;&#26377;&#25351;&#23450;&#40664;&#35748;&#30340;scheme&#65292;&#37027;&#20040;&#40664;&#35748;&#30340;&#34892;&#20026;&#23601;&#26159;&#32487;&#32493;&#20351;&#29992;&#24403;&#21069;&#30340;scheme&#12290;
		&#36825;&#24847;&#21619;&#30528;&#19968;&#26086;&#20320;&#36890;&#36807;HTTPS&#36827;&#20837;&#20102;&#19968;&#20010;&#39029;&#38754;&#65292;HTTPS&#23601;&#23558;&#25345;&#32493;&#20351;&#29992;&#65292;&#21363;&#20351;&#20320;&#23548;&#33322;&#21040;&#20102;&#21478;&#19968;&#20010;&#38750;HTTPS&#30340;&#39029;&#38754;&#65288;&#31967;&#31957;&#30340;&#20107;&#65281;&#65289;&#12290;
		&#22240;&#27492;&#24378;&#28872;&#24314;&#35758;&#21253;&#25324;&#19968;&#20010;&#40664;&#35748;&#30340; <tt class="literal">scheme</tt>&#65292;&#36890;&#36807;&#22312;&#40664;&#35748;&#30340; <tt class="literal">"*"</tt> &#35270;&#22270;&#19978;&#37197;&#32622;&#23427;&#65306;
		</p><pre class="programlisting">&lt;page view-id="*" scheme="http" /&gt;</pre><p>
		&#24403;&#28982;&#65292;&#22914;&#26524;&#20320;&#30340;&#24212;&#29992;&#31243;&#24207;&#20013; <span class="emphasis"><em>&#27809;&#26377;</em></span> &#20219;&#20309;&#39029;&#38754;&#20351;&#29992;HTTPS&#65292;&#37027;&#23601;&#19981;&#38656;&#35201;&#25351;&#23450;&#40664;&#35748;&#30340;scheme&#12290;
		</p><p>
		&#20320;&#21487;&#20197;&#37197;&#32622;Seam&#26469;&#33258;&#21160;&#22320;&#22312;&#27599;&#27425;scheme&#25913;&#21464;&#26102;&#20351;&#24403;&#21069;&#30340;HTTP&#20250;&#35805;&#22833;&#25928;&#12290;&#21482;&#35201;&#22312; <tt class="literal">components.xml</tt> &#25991;&#20214;&#20013;&#21152;&#20837;&#36825;&#19968;&#34892;&#65306;
		</p><pre class="programlisting">&lt;core:servlet-session invalidate-on-scheme-change="true"/&gt;</pre><p>
		&#36825;&#20010;&#36873;&#39033;&#21487;&#20197;&#35753;&#20320;&#30340;&#31995;&#32479;&#20943;&#23569;&#34987;&#21957;&#25506;&#21040;Session ID&#25110;&#32773;&#22240;&#20026;&#39029;&#38754;&#20174;&#20351;&#29992;HTTPS&#36716;&#21040;HTTP&#26102;&#23548;&#33268;&#25935;&#24863;&#25968;&#25454;&#30340;&#27844;&#38706;&#12290;
		</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e8191"></a>13.9.&nbsp;&#23454;&#29616;Captcha&#27979;&#35797;</h2></div></div><div></div></div><p>
		&#34429;&#28982;&#20005;&#26684;&#26469;&#35828;&#23427;&#19981;&#26159;Security API&#30340;&#19968;&#37096;&#20998;&#65292;&#20294;&#26159;&#23427;&#22312;&#26576;&#20123;&#29615;&#22659;&#19979;&#65288;&#20363;&#22914;&#26032;&#29992;&#25143;&#27880;&#20876;&#65292;&#21457;&#24067;&#21040;&#19968;&#20010;&#20844;&#20849;&#30340;blog&#25110;&#32773;&#35770;&#22363;&#65289;&#65292;
		&#21487;&#20197;&#29992;&#26469;&#23454;&#29616;Captcha&#65288;<span class="emphasis"><em>C</em></span>ompletely <span class="emphasis"><em>A</em></span>utomated <span class="emphasis"><em>P</em></span>ublic <span class="emphasis"><em>T</em></span>uring test to tell <span class="emphasis"><em>C</em></span>omputers and <span class="emphasis"><em>H</em></span>umans <span class="emphasis"><em>A</em></span>part&#65289;&#65292;&#20197;&#38450;&#27490;&#33258;&#21160;&#30340;&#26426;&#22120;&#20154;&#19982;&#24212;&#29992;&#31243;&#24207;&#36827;&#34892;&#20132;&#20114;&#12290;
		Seam&#25552;&#20379;&#19982;JCaptcha&#30340;&#26080;&#32541;&#25972;&#21512;&#65292;&#26159;&#20135;&#29983;Captcha challenge&#30340;&#19968;&#20010;&#26497;&#22909;&#30340;&#24211;&#12290;&#22914;&#26524;&#20320;&#24076;&#26395;&#22312;&#24212;&#29992;&#31243;&#24207;&#20013;&#20351;&#29992;Captcha&#29305;&#24615;&#65292;&#23601;&#35201;&#25226;&#26469;&#33258;Seam lib&#30446;&#24405;&#30340;jcaptcha-* jar&#25991;&#20214;&#21253;&#25324;&#22312;&#39033;&#30446;&#20013;&#65292;&#24182;&#22312; <tt class="literal">application.xml</tt> &#20013;&#25226;&#23427;&#27880;&#20876;&#20026;&#19968;&#20010;Java&#27169;&#22359;&#12290;
    </p><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8220"></a>13.9.1.&nbsp;&#37197;&#32622;Captcha Servlet</h3></div></div><div></div></div><p>
			&#20026;&#20102;&#24314;&#31435;&#24182;&#36816;&#34892;&#36215;&#26469;&#65292;&#38656;&#35201;&#37197;&#32622;Seam Resource Servlet&#65292;&#36825;&#23558;&#32473;&#20320;&#30340;&#39029;&#38754;&#25552;&#20379;Captcha challenge&#26144;&#23556;&#12290;&#36825;&#22312; <tt class="literal">web.xml</tt> &#20013;&#38656;&#35201;&#19979;&#21015;&#39033;&#65306;
			</p><pre class="programlisting">&lt;servlet&gt;
    &lt;servlet-name&gt;Seam Resource Servlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.jboss.seam.servlet.SeamResourceServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;

&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;Seam Resource Servlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/seam/resource/*&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8230"></a>13.9.2.&nbsp;&#28155;&#21152;Captcha&#21040;&#39029;&#38754;</h3></div></div><div></div></div><p>
			&#28155;&#21152;&#19968;&#20010;Captcha challenge&#21040;&#39029;&#38754;&#26497;&#20026;&#23481;&#26131;&#12290;
			Seam&#25552;&#20379;&#19968;&#20010;page-scoped&#32452;&#20214;&#65292;<tt class="literal">captcha</tt>&#65292;&#23427;&#25552;&#20379;&#23427;&#25152;&#38656;&#35201;&#30340;&#19968;&#20999;&#65292;&#21253;&#25324;&#20869;&#32622;&#30340;captcha&#26657;&#39564;&#12290;&#36825;&#37324;&#26377;&#20010;&#20363;&#23376;&#65306;
			</p><pre class="programlisting">&lt;div&gt;
    &lt;h:graphicImage value="/seam/resource/captcha?#{captcha.id}"/&gt;
&lt;/div&gt;

&lt;div&gt;
    &lt;h:outputLabel for="verifyCaptcha"&gt;Enter the above letters&lt;/h:outputLabel&gt;
    &lt;h:inputText id="verifyCaptcha" value="#{captcha.response}" required="true"&gt;
      &lt;s:validate /&gt;
    &lt;/h:inputText&gt;
    &lt;div class="validationError"&gt;&lt;h:message for="verifyCaptcha"/&gt;&lt;/div&gt;
&lt;/div&gt;

&lt;div&gt;
    &lt;h:commandButton action="#{register.next}" value="Register"/&gt;
&lt;/div&gt;</pre><p>
			&#36825;&#23601;&#26159;&#20851;&#20110;&#23427;&#30340;&#25152;&#26377;&#20449;&#24687;&#12290;<tt class="literal">graphicImage</tt> &#25511;&#21046;&#26174;&#31034;Captcha challenge&#65292;<tt class="literal">inputText</tt> &#25509;&#25910;&#29992;&#25143;&#30340;&#21709;&#24212;&#12290;
			&#24403;&#34920;&#21333;&#34987;&#25552;&#20132;&#26102;&#36825;&#20010;&#21709;&#24212;&#20250;&#26681;&#25454;Captcha&#34987;&#33258;&#21160;&#22320;&#26657;&#39564;&#12290;
			</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e8248"></a>13.9.3.&nbsp;&#23450;&#21046;Captcha&#22270;&#29255;</h3></div></div><div></div></div><p>
			Captcha&#22270;&#29255;&#26412;&#36523;&#21487;&#20197;&#36890;&#36807; <tt class="literal">ImageCaptchaService</tt> &#21644;&#40664;&#35748;&#30340;&#65288;<tt class="literal">DefaultManageableImageCaptchaService</tt>&#65289;&#36827;&#34892;&#23450;&#21046;&#12290;
			&#35201;&#37197;&#32622;&#19981;&#21516;&#30340; <tt class="literal">ImageCaptchaService</tt>&#65292;&#22312; <tt class="literal">components.xml</tt> &#25991;&#20214;&#20013;&#28155;&#21152;&#20197;&#19979;&#26465;&#30446;&#65306;
			</p><pre class="programlisting">  &lt;component name="org.jboss.seam.captcha.captchaImage" service="#{customCaptcha.service}"/&gt;</pre><p>
				<tt class="literal">service</tt> &#23646;&#24615;&#25351;&#26126; <tt class="literal">ImageCaptchaService</tt> &#23454;&#20363;&#29992;&#26469;&#29983;&#25104;Captcha&#22270;&#29255;&#12290;
			&#26356;&#22810;&#20851;&#20110;&#37197;&#32622;&#19968;&#20010; <tt class="literal">ImageCaptchaService</tt> &#30340;&#20449;&#24687;&#65292;&#35831;&#21442;&#35265;JCaptcha&#25991;&#26723;&#12290;
			&#36825;&#37324;&#26377;&#19968;&#20010;&#23450;&#21046;&#22270;&#29255;&#29983;&#25104;&#22120;&#30340;&#20363;&#23376;&#65288;&#21487;&#20197;&#22312;seamspace&#20363;&#23376;&#37324;&#25214;&#21040;&#65289;&#65306;
			</p><pre class="programlisting">@Name("customCaptcha")
public class CustomCaptcha
{
   public ImageCaptchaService getService()
   {
      BasicGimpyEngine customCaptcha = new BasicGimpyEngine();
      GimpyFactory factory = new GimpyFactory(
            new RandomWordGenerator("ABCDEFGHIJKLMNOPQRSTUVWXYZ23456789"),
            new ComposedWordToImage(new RandomFontGenerator(new Integer(15),
                  new Integer(15)), new UniColorBackgroundGenerator(new Integer(150),
                        new Integer(30)), new RandomTextPaster(new Integer(4),
                              new Integer(7), Color.BLACK)));
      GimpyFactory[] factories = {factory};
      customCaptcha.setFactories(factories);

      return new DefaultManageableImageCaptchaService(
                   new FastHashMapCaptchaStore(),
                   customCaptcha,
                   180,
                   120000,
                   75000);
   }
}</pre></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="drools.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="index.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="i18n.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;12.&nbsp;Seam&#21644;JBoss&#35268;&#21017;&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;14.&nbsp;&#22269;&#38469;&#21270;&#21644;&#20027;&#39064;</td></tr></table></div></body></html>